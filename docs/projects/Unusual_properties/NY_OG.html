<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Website - Unsupervised anomaly detection (fraud) algorithm</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Website</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../visualization.html"> 
<span class="menu-text">Visualization</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#remove-some-properties-that-we-arent-interested-in" id="toc-remove-some-properties-that-we-arent-interested-in" class="nav-link active" data-scroll-target="#remove-some-properties-that-we-arent-interested-in">Remove some properties that we aren’t interested in</a></li>
  <li><a href="#fill-in-missing-zip" id="toc-fill-in-missing-zip" class="nav-link" data-scroll-target="#fill-in-missing-zip">Fill in missing ZIP</a>
  <ul class="collapse">
  <li><a href="#fullval-avland-avtot" id="toc-fullval-avland-avtot" class="nav-link" data-scroll-target="#fullval-avland-avtot">FULLVAL, AVLAND, AVTOT</a></li>
  </ul></li>
  <li><a href="#fill-in-the-missing-stories" id="toc-fill-in-the-missing-stories" class="nav-link" data-scroll-target="#fill-in-the-missing-stories">Fill in the missing STORIES</a></li>
  <li><a href="#fill-in-ltfront-ltdepth-blddepth-bldfront-with-averages-by-taxclass" id="toc-fill-in-ltfront-ltdepth-blddepth-bldfront-with-averages-by-taxclass" class="nav-link" data-scroll-target="#fill-in-ltfront-ltdepth-blddepth-bldfront-with-averages-by-taxclass">Fill in LTFRONT, LTDEPTH, BLDDEPTH, BLDFRONT with averages by TAXCLASS</a>
  <ul class="collapse">
  <li><a href="#now-build-variables-that-try-to-find-properties-that-are-unusual-in-ways-were-interested-in" id="toc-now-build-variables-that-try-to-find-properties-that-are-unusual-in-ways-were-interested-in" class="nav-link" data-scroll-target="#now-build-variables-that-try-to-find-properties-that-are-unusual-in-ways-were-interested-in">Now build variables that try to find properties that are unusual in ways we’re interested in</a></li>
  </ul></li>
  <li><a href="#now-calculate-two-unsupervised-fraud-scores" id="toc-now-calculate-two-unsupervised-fraud-scores" class="nav-link" data-scroll-target="#now-calculate-two-unsupervised-fraud-scores">Now calculate two unsupervised fraud scores</a>
  <ul class="collapse">
  <li><a href="#calculate-score-1" id="toc-calculate-score-1" class="nav-link" data-scroll-target="#calculate-score-1">Calculate score 1</a></li>
  <li><a href="#autoencoder-for-score-2" id="toc-autoencoder-for-score-2" class="nav-link" data-scroll-target="#autoencoder-for-score-2">Autoencoder for score 2</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Unsupervised anomaly detection (fraud) algorithm</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This project has good example algorithms to do a forensic-type analysis, looking for anomalies in a dataset. We first do some data cleaning (exclusions, imputation, don’t remove outliers - that’s what we’re looking for), then build variables that are designed to look for the kinds of anomalies we are interested in, in this case, unusual property valuations.</p>
<p>After we build the variables we know we have lots of correlations and too high dimensionality so we need to remove correlations and reduce dimensionality. Since we don’t have a dependent variable the easiest useful thing to do is PCA. We z scale (always z scale before a PCA), do PCA, keep the top few PCs, then z scale again in order to make each retained PC equally important (optional step; only do this if you keep just a few PCs.).</p>
<p>We use two different anomaly detection (fraud) algorithms. The first just looks for outliers in the final scaled PC space using a Minkowski distance from the origin. The second method makes a simple autoencoder and the fraud score is then the reproduction error. It’s important to note that each/either of these two methods would be a fine fraud score by itself.</p>
<p>Since we have two score and we don’t really know which one is better we just average the two scores. To do this we replace the score with its rank order and then average the rank-ordered scores for our final score.</p>
<p>Finally we sort all the records by this final score and explore the top n records. To help the investigation we show which of the variables are driving these top scoring records with a heat map of the variable zscores, which can point the investigators to what’s making the high score for these top scoring records.</p>
<p>This problem is an invented problem to demonstrate the process of building unsupervised fraud models. The data set is real and the invented problem is realistic. What’s lacking the most is the ability to interact with domain experts in order to do proper exclusions and design good/appropriate variables.</p>
<p>The data can be found here: https://data.cityofnewyork.us/Housing-Development/Property-Valuation-and-Assessment-Data/rgy2-tti8</p>
<p><object data="project2.pdf" type="application/pdf" width="100%" height="800"><a href="project2.pdf" download="">Download PDF file.</a></object></p>
<div id="729b53e9" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th">BBLE</th>
<th data-quarto-table-cell-role="th">BORO</th>
<th data-quarto-table-cell-role="th">BLOCK</th>
<th data-quarto-table-cell-role="th">LOT</th>
<th data-quarto-table-cell-role="th">EASEMENT</th>
<th data-quarto-table-cell-role="th">OWNER</th>
<th data-quarto-table-cell-role="th">BLDGCL</th>
<th data-quarto-table-cell-role="th">TAXCLASS</th>
<th data-quarto-table-cell-role="th">LTFRONT</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">BLDFRONT</th>
<th data-quarto-table-cell-role="th">BLDDEPTH</th>
<th data-quarto-table-cell-role="th">AVLAND2</th>
<th data-quarto-table-cell-role="th">AVTOT2</th>
<th data-quarto-table-cell-role="th">EXLAND2</th>
<th data-quarto-table-cell-role="th">EXTOT2</th>
<th data-quarto-table-cell-role="th">EXCD2</th>
<th data-quarto-table-cell-role="th">PERIOD</th>
<th data-quarto-table-cell-role="th">YEAR</th>
<th data-quarto-table-cell-role="th">VALTYPE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>1000010101</td>
<td>1</td>
<td>1</td>
<td>101</td>
<td>NaN</td>
<td>U S GOVT LAND &amp; BLDGS</td>
<td>P7</td>
<td>4</td>
<td>500</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>3775500.0</td>
<td>8613000.0</td>
<td>3775500.0</td>
<td>8613000.0</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>1000010201</td>
<td>1</td>
<td>1</td>
<td>201</td>
<td>NaN</td>
<td>U S GOVT LAND &amp; BLDGS</td>
<td>Z9</td>
<td>4</td>
<td>27</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>11111400.0</td>
<td>80690400.0</td>
<td>11111400.0</td>
<td>80690400.0</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>1000020001</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>NaN</td>
<td>DEPT OF GENERAL SERVI</td>
<td>Y7</td>
<td>4</td>
<td>709</td>
<td>...</td>
<td>709</td>
<td>564</td>
<td>32321790.0</td>
<td>40179510.0</td>
<td>32321790.0</td>
<td>40179510.0</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>1000020023</td>
<td>1</td>
<td>2</td>
<td>23</td>
<td>NaN</td>
<td>DEPARTMENT OF BUSINES</td>
<td>T2</td>
<td>4</td>
<td>793</td>
<td>...</td>
<td>85</td>
<td>551</td>
<td>13644000.0</td>
<td>15750000.0</td>
<td>13644000.0</td>
<td>15750000.0</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>1000030001</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>NaN</td>
<td>PARKS AND RECREATION</td>
<td>Q1</td>
<td>4</td>
<td>323</td>
<td>...</td>
<td>89</td>
<td>57</td>
<td>106348680.0</td>
<td>107758350.0</td>
<td>106348680.0</td>
<td>107758350.0</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
</tbody>
</table>

<p>5 rows × 32 columns</p>
</div>
</div>
</div>
</div>
<section id="remove-some-properties-that-we-arent-interested-in" class="level2">
<h2 class="anchored" data-anchor-id="remove-some-properties-that-we-arent-interested-in">Remove some properties that we aren’t interested in</h2>
<div id="fa0d3841" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>numrecords_orig <span class="op">=</span> <span class="bu">len</span>(data)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>numrecords <span class="op">=</span> numrecords_orig</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>numrecords</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>1070994</code></pre>
</div>
</div>
<div id="b4fe703a" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove the records with easement type as goverment </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[data[<span class="st">"EASEMENT"</span>] <span class="op">!=</span> <span class="st">"U"</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>numremoved <span class="op">=</span> numrecords <span class="op">-</span> <span class="bu">len</span>(data)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'# records removed:'</span>, numremoved)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># records removed: 1</code></pre>
</div>
</div>
<div id="61baf087" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create some words for the owner name that might be goverment or a cemetery</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>gov_list <span class="op">=</span> [<span class="st">'DEPT '</span>, <span class="st">'DEPARTMENT'</span>, <span class="st">'UNITED STATES'</span>,<span class="st">'GOVERNMENT'</span>,<span class="st">' GOVT '</span>, <span class="st">'CEMETERY'</span>]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># owner = list(set(data['OWNER'].to_list()))</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># owner.pop(0) #remove the nan</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>owner1 <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(data[<span class="st">'OWNER'</span>].to_list()))</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>owner <span class="op">=</span> [item <span class="cf">for</span> item <span class="kw">in</span> owner1 <span class="cf">if</span> <span class="bu">str</span>(item) <span class="op">!=</span> <span class="st">'nan'</span>] <span class="co"># remove any nan's</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>remove_list <span class="op">=</span> []</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Total owner number before removing is "</span>, <span class="bu">len</span>(owner))</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> owner:</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> g <span class="kw">in</span> gov_list:</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> g <span class="kw">in</span> i <span class="kw">and</span> <span class="st">'STORES'</span> <span class="kw">not</span> <span class="kw">in</span> i:</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        remove_list.append(i)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total owner number before removing is  863347</code></pre>
</div>
</div>
<div id="b83b9629" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at the most frequent owners. This might show some other properties we aren't interested in.</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>remove_list2 <span class="op">=</span> data[<span class="st">'OWNER'</span>].value_counts().head(<span class="dv">20</span>).index.tolist()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>remove_list2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>['PARKCHESTER PRESERVAT',
 'PARKS AND RECREATION',
 'DCAS',
 'HOUSING PRESERVATION',
 'CITY OF NEW YORK',
 'DEPT OF ENVIRONMENTAL',
 'BOARD OF EDUCATION',
 'NEW YORK CITY HOUSING',
 'CNY/NYCTA',
 'NYC HOUSING PARTNERSH',
 'YORKVILLE TOWERS ASSO',
 'DEPARTMENT OF BUSINES',
 'DEPT OF TRANSPORTATIO',
 'MTA/LIRR',
 'PARCKHESTER PRESERVAT',
 'MH RESIDENTIAL 1, LLC',
 '434 M LLC',
 'LINCOLN PLAZA ASSOCIA',
 'DEUTSCHE BANK NATIONA',
 '561 11TH AVENUE TMG L']</code></pre>
</div>
</div>
<div id="61abc4d0" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add some others to also be removed</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'THE CITY OF NEW YORK'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'NYS URBAN DEVELOPMENT'</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'CULTURAL AFFAIRS'</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'NY STATE PUBLIC WORKS'</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">"NYC DEP'T OF HIGHWAYS"</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'CITY WIDE ADMINISTRAT'</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'NEW YORK CITY'</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'THE PORT OFNY &amp; NJ'</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'NEW YORK STATE DEPART'</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'CITY AND NON-CITY OWN'</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'SANITATION'</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'NYS DOT'</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'NEW YORK CITY TRANSIT'</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'PORT AUTHORITY OF NY'</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'NEW YORK STATE OWNED'</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'NYC PARK DEPT'</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'PORT OF NEW YORK AUTH'</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'NYC PARK DEPT'</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'LIRR'</span>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'NY STATE PUBLIC SERV'</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'STATE OF NEW YORK'</span>)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>remove_list2.append(<span class="st">'NYC HIGHWAY DEPT'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cda08f73" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> remove_list2:</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="kw">not</span> <span class="kw">in</span> remove_list:</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        remove_list.append(i)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(i)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DEPT OF ENVIRONMENTAL
DEPARTMENT OF BUSINES
DEPT OF TRANSPORTATIO
NYC PARK DEPT</code></pre>
</div>
</div>
<div id="c9133f6e" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rremove some of the removes...</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>remove_list.remove(<span class="st">'YORKVILLE TOWERS ASSO'</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>remove_list.remove(<span class="st">'434 M LLC'</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>remove_list.remove(<span class="st">'DEUTSCHE BANK NATIONA'</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>remove_list.remove(<span class="st">'561 11TH AVENUE TMG L'</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>remove_list.remove(<span class="st">'MH RESIDENTIAL 1, LLC'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="ef1ca863" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(remove_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>263</code></pre>
</div>
</div>
<div id="7eb87288" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>numrecords <span class="op">=</span> <span class="bu">len</span>(data)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>removed <span class="op">=</span> data[data[<span class="st">'OWNER'</span>].isin(remove_list)].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[<span class="op">~</span>data[<span class="st">'OWNER'</span>].isin(remove_list)].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>numremoved <span class="op">=</span> numrecords <span class="op">-</span> <span class="bu">len</span>(data)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'# records removed:'</span>, numremoved)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># records removed: 26500</code></pre>
</div>
</div>
<div id="d8674246" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>removed.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>(26500, 32)</code></pre>
</div>
</div>
<div id="61b51aa4" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># any on this list that we shouldn't remove?</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.rcParams.update({'figure.figsize':(6,14)})</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">14</span>))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>plt.xscale(<span class="st">'log'</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>removed[<span class="st">'OWNER'</span>].value_counts().head(<span class="dv">50</span>).sort_values().plot(kind<span class="op">=</span><span class="st">'barh'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NY_OG_files/figure-html/cell-15-output-1.png" width="673" height="1078" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="9a3b6036" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>(1044493, 32)</code></pre>
</div>
</div>
<div id="2f90e78d" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this is how many records we removed</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>numrecords_orig <span class="op">-</span> <span class="bu">len</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>26501</code></pre>
</div>
</div>
<div id="cb5badd0" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>data.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th">BBLE</th>
<th data-quarto-table-cell-role="th">BORO</th>
<th data-quarto-table-cell-role="th">BLOCK</th>
<th data-quarto-table-cell-role="th">LOT</th>
<th data-quarto-table-cell-role="th">EASEMENT</th>
<th data-quarto-table-cell-role="th">OWNER</th>
<th data-quarto-table-cell-role="th">BLDGCL</th>
<th data-quarto-table-cell-role="th">TAXCLASS</th>
<th data-quarto-table-cell-role="th">LTFRONT</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">BLDFRONT</th>
<th data-quarto-table-cell-role="th">BLDDEPTH</th>
<th data-quarto-table-cell-role="th">AVLAND2</th>
<th data-quarto-table-cell-role="th">AVTOT2</th>
<th data-quarto-table-cell-role="th">EXLAND2</th>
<th data-quarto-table-cell-role="th">EXTOT2</th>
<th data-quarto-table-cell-role="th">EXCD2</th>
<th data-quarto-table-cell-role="th">PERIOD</th>
<th data-quarto-table-cell-role="th">YEAR</th>
<th data-quarto-table-cell-role="th">VALTYPE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>9</td>
<td>1000041001</td>
<td>1</td>
<td>4</td>
<td>1001</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>636093.0</td>
<td>2049290.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>10</td>
<td>1000041002</td>
<td>1</td>
<td>4</td>
<td>1002</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>919276.0</td>
<td>2961617.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>11</td>
<td>1000041003</td>
<td>1</td>
<td>4</td>
<td>1003</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>967500.0</td>
<td>5483912.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>12</td>
<td>1000041004</td>
<td>1</td>
<td>4</td>
<td>1004</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>163174.0</td>
<td>525692.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>13</td>
<td>1000041005</td>
<td>1</td>
<td>4</td>
<td>1005</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>373783.0</td>
<td>1204211.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>14</td>
<td>1000041006</td>
<td>1</td>
<td>4</td>
<td>1006</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>353383.0</td>
<td>1138493.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>15</td>
<td>1000041007</td>
<td>1</td>
<td>4</td>
<td>1007</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>1246572.0</td>
<td>4016063.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>16</td>
<td>1000041008</td>
<td>1</td>
<td>4</td>
<td>1008</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>1213369.0</td>
<td>3909089.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>17</td>
<td>1000041009</td>
<td>1</td>
<td>4</td>
<td>1009</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>1213369.0</td>
<td>3909089.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>18</td>
<td>1000041010</td>
<td>1</td>
<td>4</td>
<td>1010</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>1213369.0</td>
<td>3909089.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
</tbody>
</table>

<p>10 rows × 32 columns</p>
</div>
</div>
</div>
</div>
</section>
<section id="fill-in-missing-zip" class="level2">
<h2 class="anchored" data-anchor-id="fill-in-missing-zip">Fill in missing ZIP</h2>
<div id="25bb8987" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># How many zips are missing? Replace NAN with 0 and count them.</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>missing_zips <span class="op">=</span> np.where(pd.isnull(data[<span class="st">'ZIP'</span>]))[<span class="dv">0</span>]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>num_missing_zips_orig <span class="op">=</span> <span class="bu">len</span>(missing_zips)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>num_missing_zips_orig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>20431</code></pre>
</div>
</div>
<div id="07928179" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>(data[<span class="st">'BORO'</span>].isna())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>0</code></pre>
</div>
</div>
<div id="d38dfca2" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="bu">sum</span>(data[<span class="st">'STADDR'</span>].isna())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>364</code></pre>
</div>
</div>
<div id="2f71b40e" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># concatenate the 'staddr' and 'boro' columns into a new 'staddr_boro' column </span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'staddr_boro'</span>] <span class="op">=</span> data[data[<span class="st">'STADDR'</span>].notnull()][<span class="st">'STADDR'</span>] <span class="op">+</span> <span class="st">'_'</span> <span class="op">+</span> data[data[<span class="st">'BORO'</span>].notnull()][<span class="st">'BORO'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'staddr_boro'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>0              1 WATER STREET_1
1              1 WATER STREET_1
2              1 WATER STREET_1
3              1 WATER STREET_1
4              1 WATER STREET_1
                   ...         
1044488    142 BENTLEY STREET_5
1044489    146 BENTLEY STREET_5
1044490    150 BENTLEY STREET_5
1044491    156 BENTLEY STREET_5
1044492    162 BENTLEY STREET_5
Name: staddr_boro, Length: 1044493, dtype: object</code></pre>
</div>
</div>
<div id="05408d07" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>staddr_boro_zip <span class="op">=</span> {}</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, staddrboro <span class="kw">in</span> data[<span class="st">'staddr_boro'</span>].items():</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> staddrboro <span class="kw">not</span> <span class="kw">in</span> staddr_boro_zip :</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>        staddr_boro_zip [staddrboro] <span class="op">=</span> data.loc[index, <span class="st">'ZIP'</span>]</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># fill in by mapping with street addrees boroughs</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'ZIP'</span>] <span class="op">=</span> data[<span class="st">'ZIP'</span>].fillna(data[<span class="st">'staddr_boro'</span>].<span class="bu">map</span>(staddr_boro_zip))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e2407c7c" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how many missing zips did we fill in with this last step?</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>num_filled_in <span class="op">=</span> num_missing_zips_orig <span class="op">-</span> <span class="bu">len</span>(np.where(pd.isnull(data[<span class="st">'ZIP'</span>]))[<span class="dv">0</span>])</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>num_filled_in</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>2832</code></pre>
</div>
</div>
<div id="953eb3e0" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># How many are still left to fill in?</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>missing_zips <span class="op">=</span> np.where(pd.isnull(data[<span class="st">'ZIP'</span>]))[<span class="dv">0</span>]</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(missing_zips)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>17599</code></pre>
</div>
</div>
<div id="d8930061" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume the data is already sorted by zip. If a zip is missing, </span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and the before and after zips are the same, fill in the zip with that value</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(missing_zips)):</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(data.loc[missing_zips[i]<span class="op">+</span><span class="dv">1</span>,<span class="st">'ZIP'</span>] <span class="op">==</span> data.loc[missing_zips[i]<span class="op">-</span><span class="dv">1</span>,<span class="st">'ZIP'</span>]):</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>        data.loc[missing_zips[i],<span class="st">'ZIP'</span>] <span class="op">=</span> data.loc[missing_zips[i]<span class="op">-</span><span class="dv">1</span>,<span class="st">'ZIP'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="71115649" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how many mnissing zips did we fill in with this last step?</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>num_filled_in <span class="op">=</span> <span class="bu">len</span>(missing_zips) <span class="op">-</span> <span class="bu">len</span>(np.where(pd.isnull(data[<span class="st">'ZIP'</span>]))[<span class="dv">0</span>])</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>num_filled_in</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>9491</code></pre>
</div>
</div>
<div id="06095b23" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># How many are still left to fill in?</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>missing_zips <span class="op">=</span> np.where(pd.isnull(data[<span class="st">'ZIP'</span>]))[<span class="dv">0</span>]</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(missing_zips)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>8108</code></pre>
</div>
</div>
<div id="b91985ba" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For the remaining missing zips, just fill in with the previous record's zip.</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># another slow loop that should be improved...</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(missing_zips)):</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    data.loc[missing_zips[i],<span class="st">'ZIP'</span>] <span class="op">=</span> data.loc[missing_zips[i]<span class="op">-</span><span class="dv">1</span>,<span class="st">'ZIP'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 484 ms, sys: 3.4 ms, total: 487 ms
Wall time: 492 ms</code></pre>
</div>
</div>
<div id="62b6e3eb" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>missing_zips <span class="op">=</span> np.where(pd.isnull(data[<span class="st">'ZIP'</span>]))[<span class="dv">0</span>]</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(missing_zips)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>0</code></pre>
</div>
</div>
<div id="e82b8af5" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.drop(<span class="st">'staddr_boro'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="fullval-avland-avtot" class="level3">
<h3 class="anchored" data-anchor-id="fullval-avland-avtot">FULLVAL, AVLAND, AVTOT</h3>
<section id="fullval" class="level4">
<h4 class="anchored" data-anchor-id="fullval">FULLVAL</h4>
<div id="9166b986" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(data[data[<span class="st">'FULLVAL'</span>]<span class="op">==</span><span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>10025</code></pre>
</div>
</div>
<div id="9e1f5512" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'FULLVAL'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>0</code></pre>
</div>
</div>
<div id="51302396" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'FULLVAL'</span>].replace(<span class="dv">0</span>, np.nan, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'FULLVAL'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>10025</code></pre>
</div>
</div>
<div id="c3ffd5b1" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"FULLVAL"</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>,<span class="st">'BORO'</span>,<span class="st">'BLDGCL'</span>])[<span class="st">'FULLVAL'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'FULLVAL'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>7307</code></pre>
</div>
</div>
<div id="fc69136a" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"FULLVAL"</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>,<span class="st">'BORO'</span>])[<span class="st">'FULLVAL'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'FULLVAL'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>386</code></pre>
</div>
</div>
<div id="154ef1a9" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"FULLVAL"</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>])[<span class="st">'FULLVAL'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'FULLVAL'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>0</code></pre>
</div>
</div>
</section>
<section id="avland" class="level4">
<h4 class="anchored" data-anchor-id="avland">AVLAND</h4>
<div id="09b52e35" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(data[data[<span class="st">'AVLAND'</span>]<span class="op">==</span><span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>10027</code></pre>
</div>
</div>
<div id="29dc47aa" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'AVLAND'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>0</code></pre>
</div>
</div>
<div id="c4c040de" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'AVLAND'</span>].replace(<span class="dv">0</span>, np.nan, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'AVLAND'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>10027</code></pre>
</div>
</div>
<div id="4c12c652" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"AVLAND"</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>,<span class="st">'BORO'</span>,<span class="st">'BLDGCL'</span>])[<span class="st">'AVLAND'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'AVLAND'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>7307</code></pre>
</div>
</div>
<div id="47edb981" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"AVLAND"</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>,<span class="st">'BORO'</span>])[<span class="st">'AVLAND'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'AVLAND'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>386</code></pre>
</div>
</div>
<div id="be44862e" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"AVLAND"</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>])[<span class="st">'AVLAND'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'AVLAND'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>0</code></pre>
</div>
</div>
</section>
<section id="avtot" class="level4">
<h4 class="anchored" data-anchor-id="avtot">AVTOT</h4>
<div id="1d518928" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(data[data[<span class="st">'AVTOT'</span>]<span class="op">==</span><span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>10025</code></pre>
</div>
</div>
<div id="65ef0bc4" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'AVTOT'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>0</code></pre>
</div>
</div>
<div id="3f6c7938" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'AVTOT'</span>].replace(<span class="dv">0</span>, np.nan, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'AVTOT'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>10025</code></pre>
</div>
</div>
<div id="1c328d2e" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"AVTOT"</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>,<span class="st">'BORO'</span>,<span class="st">'BLDGCL'</span>])[<span class="st">'AVTOT'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'AVTOT'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>7307</code></pre>
</div>
</div>
<div id="6c4f900e" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"AVTOT"</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>,<span class="st">'BORO'</span>])[<span class="st">'AVTOT'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'AVTOT'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>386</code></pre>
</div>
</div>
<div id="9e783808" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"AVTOT"</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>])[<span class="st">'AVTOT'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'AVTOT'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>0</code></pre>
</div>
</div>
<div id="1a71f0e5" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>data.head().transpose()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">RECORD</td>
<td>9</td>
<td>10</td>
<td>11</td>
<td>12</td>
<td>13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">BBLE</td>
<td>1000041001</td>
<td>1000041002</td>
<td>1000041003</td>
<td>1000041004</td>
<td>1000041005</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">BORO</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">BLOCK</td>
<td>4</td>
<td>4</td>
<td>4</td>
<td>4</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">LOT</td>
<td>1001</td>
<td>1002</td>
<td>1003</td>
<td>1004</td>
<td>1005</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">EASEMENT</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">OWNER</td>
<td>TRZ HOLDINGS, LLC</td>
<td>TRZ HOLDINGS, LLC</td>
<td>TRZ HOLDINGS, LLC</td>
<td>TRZ HOLDINGS, LLC</td>
<td>TRZ HOLDINGS, LLC</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">BLDGCL</td>
<td>R5</td>
<td>R5</td>
<td>R5</td>
<td>R5</td>
<td>R5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">TAXCLASS</td>
<td>4</td>
<td>4</td>
<td>4</td>
<td>4</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">LTFRONT</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">LTDEPTH</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">EXT</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">STORIES</td>
<td>50.0</td>
<td>50.0</td>
<td>50.0</td>
<td>50.0</td>
<td>50.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">FULLVAL</td>
<td>3944762.0</td>
<td>5700930.0</td>
<td>10600000.0</td>
<td>1011928.0</td>
<td>2318026.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AVLAND</td>
<td>636093.0</td>
<td>919276.0</td>
<td>967500.0</td>
<td>163174.0</td>
<td>373783.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AVTOT</td>
<td>1775143.0</td>
<td>2565419.0</td>
<td>4770000.0</td>
<td>455368.0</td>
<td>1043112.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">EXLAND</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">EXTOT</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">EXCD1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">STADDR</td>
<td>1 WATER STREET</td>
<td>1 WATER STREET</td>
<td>1 WATER STREET</td>
<td>1 WATER STREET</td>
<td>1 WATER STREET</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ZIP</td>
<td>10004.0</td>
<td>10004.0</td>
<td>10004.0</td>
<td>10004.0</td>
<td>10004.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">EXMPTCL</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">BLDFRONT</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">BLDDEPTH</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AVLAND2</td>
<td>636093.0</td>
<td>919276.0</td>
<td>967500.0</td>
<td>163174.0</td>
<td>373783.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AVTOT2</td>
<td>2049290.0</td>
<td>2961617.0</td>
<td>5483912.0</td>
<td>525692.0</td>
<td>1204211.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">EXLAND2</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">EXTOT2</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">EXCD2</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">PERIOD</td>
<td>FINAL</td>
<td>FINAL</td>
<td>FINAL</td>
<td>FINAL</td>
<td>FINAL</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">YEAR</td>
<td>2010/11</td>
<td>2010/11</td>
<td>2010/11</td>
<td>2010/11</td>
<td>2010/11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">VALTYPE</td>
<td>AC-TR</td>
<td>AC-TR</td>
<td>AC-TR</td>
<td>AC-TR</td>
<td>AC-TR</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="fill-in-the-missing-stories" class="level2">
<h2 class="anchored" data-anchor-id="fill-in-the-missing-stories">Fill in the missing STORIES</h2>
<div id="b0b8260e" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'STORIES'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>42030</code></pre>
</div>
</div>
<div id="403c9fb7" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>modes <span class="op">=</span> data.groupby([<span class="st">'BORO'</span>, <span class="st">'BLDGCL'</span>])[<span class="st">'STORIES'</span>] <span class="op">\</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>         .transform(<span class="kw">lambda</span> x: x.mode(dropna<span class="op">=</span><span class="va">False</span>).iloc[<span class="dv">0</span>])</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'STORIES'</span>] <span class="op">=</span> data[<span class="st">'STORIES'</span>].fillna(modes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="34793cec" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'STORIES'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>37922</code></pre>
</div>
</div>
<div id="a375ae16" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"STORIES"</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>])[<span class="st">'STORIES'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="054e6492" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'STORIES'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>0</code></pre>
</div>
</div>
<div id="a55673c2" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>data.head().transpose()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">RECORD</td>
<td>9</td>
<td>10</td>
<td>11</td>
<td>12</td>
<td>13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">BBLE</td>
<td>1000041001</td>
<td>1000041002</td>
<td>1000041003</td>
<td>1000041004</td>
<td>1000041005</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">BORO</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">BLOCK</td>
<td>4</td>
<td>4</td>
<td>4</td>
<td>4</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">LOT</td>
<td>1001</td>
<td>1002</td>
<td>1003</td>
<td>1004</td>
<td>1005</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">EASEMENT</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">OWNER</td>
<td>TRZ HOLDINGS, LLC</td>
<td>TRZ HOLDINGS, LLC</td>
<td>TRZ HOLDINGS, LLC</td>
<td>TRZ HOLDINGS, LLC</td>
<td>TRZ HOLDINGS, LLC</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">BLDGCL</td>
<td>R5</td>
<td>R5</td>
<td>R5</td>
<td>R5</td>
<td>R5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">TAXCLASS</td>
<td>4</td>
<td>4</td>
<td>4</td>
<td>4</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">LTFRONT</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">LTDEPTH</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">EXT</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">STORIES</td>
<td>50.0</td>
<td>50.0</td>
<td>50.0</td>
<td>50.0</td>
<td>50.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">FULLVAL</td>
<td>3944762.0</td>
<td>5700930.0</td>
<td>10600000.0</td>
<td>1011928.0</td>
<td>2318026.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AVLAND</td>
<td>636093.0</td>
<td>919276.0</td>
<td>967500.0</td>
<td>163174.0</td>
<td>373783.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AVTOT</td>
<td>1775143.0</td>
<td>2565419.0</td>
<td>4770000.0</td>
<td>455368.0</td>
<td>1043112.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">EXLAND</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">EXTOT</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">EXCD1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">STADDR</td>
<td>1 WATER STREET</td>
<td>1 WATER STREET</td>
<td>1 WATER STREET</td>
<td>1 WATER STREET</td>
<td>1 WATER STREET</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ZIP</td>
<td>10004.0</td>
<td>10004.0</td>
<td>10004.0</td>
<td>10004.0</td>
<td>10004.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">EXMPTCL</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">BLDFRONT</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">BLDDEPTH</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AVLAND2</td>
<td>636093.0</td>
<td>919276.0</td>
<td>967500.0</td>
<td>163174.0</td>
<td>373783.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AVTOT2</td>
<td>2049290.0</td>
<td>2961617.0</td>
<td>5483912.0</td>
<td>525692.0</td>
<td>1204211.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">EXLAND2</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">EXTOT2</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">EXCD2</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">PERIOD</td>
<td>FINAL</td>
<td>FINAL</td>
<td>FINAL</td>
<td>FINAL</td>
<td>FINAL</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">YEAR</td>
<td>2010/11</td>
<td>2010/11</td>
<td>2010/11</td>
<td>2010/11</td>
<td>2010/11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">VALTYPE</td>
<td>AC-TR</td>
<td>AC-TR</td>
<td>AC-TR</td>
<td>AC-TR</td>
<td>AC-TR</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="fill-in-ltfront-ltdepth-blddepth-bldfront-with-averages-by-taxclass" class="level2">
<h2 class="anchored" data-anchor-id="fill-in-ltfront-ltdepth-blddepth-bldfront-with-averages-by-taxclass">Fill in LTFRONT, LTDEPTH, BLDDEPTH, BLDFRONT with averages by TAXCLASS</h2>
<div id="6bb16f11" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Because these 4 fields do not have NAs, we just need to replace 0s. </span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We think zero and 1 are invalid values for these fields, so replace them with NA.</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate groupwise average. Replace 0 and 1's by NAs so they are not counted in calculating mean.</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>data.loc[data[<span class="st">'LTFRONT'</span>]<span class="op">==</span><span class="dv">0</span>,<span class="st">'LTFRONT'</span>]<span class="op">=</span>np.nan</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>data.loc[data[<span class="st">'LTDEPTH'</span>]<span class="op">==</span><span class="dv">0</span>,<span class="st">'LTDEPTH'</span>]<span class="op">=</span>np.nan</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>data.loc[data[<span class="st">'BLDFRONT'</span>]<span class="op">==</span><span class="dv">0</span>,<span class="st">'BLDFRONT'</span>]<span class="op">=</span>np.nan</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>data.loc[data[<span class="st">'BLDDEPTH'</span>]<span class="op">==</span><span class="dv">0</span>,<span class="st">'BLDDEPTH'</span>]<span class="op">=</span>np.nan</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>data.loc[data[<span class="st">'LTFRONT'</span>]<span class="op">==</span><span class="dv">1</span>,<span class="st">'LTFRONT'</span>]<span class="op">=</span>np.nan</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>data.loc[data[<span class="st">'LTDEPTH'</span>]<span class="op">==</span><span class="dv">1</span>,<span class="st">'LTDEPTH'</span>]<span class="op">=</span>np.nan</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>data.loc[data[<span class="st">'BLDFRONT'</span>]<span class="op">==</span><span class="dv">1</span>,<span class="st">'BLDFRONT'</span>]<span class="op">=</span>np.nan</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>data.loc[data[<span class="st">'BLDDEPTH'</span>]<span class="op">==</span><span class="dv">1</span>,<span class="st">'BLDDEPTH'</span>]<span class="op">=</span>np.nan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="f14412d8" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th">BBLE</th>
<th data-quarto-table-cell-role="th">BORO</th>
<th data-quarto-table-cell-role="th">BLOCK</th>
<th data-quarto-table-cell-role="th">LOT</th>
<th data-quarto-table-cell-role="th">EASEMENT</th>
<th data-quarto-table-cell-role="th">OWNER</th>
<th data-quarto-table-cell-role="th">BLDGCL</th>
<th data-quarto-table-cell-role="th">TAXCLASS</th>
<th data-quarto-table-cell-role="th">LTFRONT</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">BLDFRONT</th>
<th data-quarto-table-cell-role="th">BLDDEPTH</th>
<th data-quarto-table-cell-role="th">AVLAND2</th>
<th data-quarto-table-cell-role="th">AVTOT2</th>
<th data-quarto-table-cell-role="th">EXLAND2</th>
<th data-quarto-table-cell-role="th">EXTOT2</th>
<th data-quarto-table-cell-role="th">EXCD2</th>
<th data-quarto-table-cell-role="th">PERIOD</th>
<th data-quarto-table-cell-role="th">YEAR</th>
<th data-quarto-table-cell-role="th">VALTYPE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>9</td>
<td>1000041001</td>
<td>1</td>
<td>4</td>
<td>1001</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>636093.0</td>
<td>2049290.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>10</td>
<td>1000041002</td>
<td>1</td>
<td>4</td>
<td>1002</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>919276.0</td>
<td>2961617.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>11</td>
<td>1000041003</td>
<td>1</td>
<td>4</td>
<td>1003</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>967500.0</td>
<td>5483912.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>12</td>
<td>1000041004</td>
<td>1</td>
<td>4</td>
<td>1004</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>163174.0</td>
<td>525692.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>13</td>
<td>1000041005</td>
<td>1</td>
<td>4</td>
<td>1005</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>373783.0</td>
<td>1204211.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
</tbody>
</table>

<p>5 rows × 32 columns</p>
</div>
</div>
</div>
</div>
<section id="ltfront" class="level4">
<h4 class="anchored" data-anchor-id="ltfront">LTFRONT</h4>
<div id="0dd0dfaa" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'LTFRONT'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>161133</code></pre>
</div>
</div>
<div id="0c200800" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"LTFRONT"</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>,<span class="st">'BORO'</span>])[<span class="st">'LTFRONT'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>data[data[<span class="st">'LTFRONT'</span>].isnull()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th">BBLE</th>
<th data-quarto-table-cell-role="th">BORO</th>
<th data-quarto-table-cell-role="th">BLOCK</th>
<th data-quarto-table-cell-role="th">LOT</th>
<th data-quarto-table-cell-role="th">EASEMENT</th>
<th data-quarto-table-cell-role="th">OWNER</th>
<th data-quarto-table-cell-role="th">BLDGCL</th>
<th data-quarto-table-cell-role="th">TAXCLASS</th>
<th data-quarto-table-cell-role="th">LTFRONT</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">BLDFRONT</th>
<th data-quarto-table-cell-role="th">BLDDEPTH</th>
<th data-quarto-table-cell-role="th">AVLAND2</th>
<th data-quarto-table-cell-role="th">AVTOT2</th>
<th data-quarto-table-cell-role="th">EXLAND2</th>
<th data-quarto-table-cell-role="th">EXTOT2</th>
<th data-quarto-table-cell-role="th">EXCD2</th>
<th data-quarto-table-cell-role="th">PERIOD</th>
<th data-quarto-table-cell-role="th">YEAR</th>
<th data-quarto-table-cell-role="th">VALTYPE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">126002</td>
<td>127752</td>
<td>1018259034</td>
<td>1</td>
<td>1825</td>
<td>9034</td>
<td>NaN</td>
<td>NaN</td>
<td>V0</td>
<td>1B</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">126003</td>
<td>127753</td>
<td>1018259036</td>
<td>1</td>
<td>1825</td>
<td>9036</td>
<td>NaN</td>
<td>NaN</td>
<td>V0</td>
<td>1B</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
</tbody>
</table>

<p>2 rows × 32 columns</p>
</div>
</div>
</div>
</div>
<div id="cf787488" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"LTFRONT"</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>])[<span class="st">'LTFRONT'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'LTFRONT'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>0</code></pre>
</div>
</div>
</section>
<section id="ltdepth" class="level4">
<h4 class="anchored" data-anchor-id="ltdepth">LTDEPTH</h4>
<div id="5bd1d484" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'LTDEPTH'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>161715</code></pre>
</div>
</div>
<div id="4e9a073b" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"LTDEPTH"</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>,<span class="st">'BORO'</span>])[<span class="st">'LTDEPTH'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>data[data[<span class="st">'LTDEPTH'</span>].isnull()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th">BBLE</th>
<th data-quarto-table-cell-role="th">BORO</th>
<th data-quarto-table-cell-role="th">BLOCK</th>
<th data-quarto-table-cell-role="th">LOT</th>
<th data-quarto-table-cell-role="th">EASEMENT</th>
<th data-quarto-table-cell-role="th">OWNER</th>
<th data-quarto-table-cell-role="th">BLDGCL</th>
<th data-quarto-table-cell-role="th">TAXCLASS</th>
<th data-quarto-table-cell-role="th">LTFRONT</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">BLDFRONT</th>
<th data-quarto-table-cell-role="th">BLDDEPTH</th>
<th data-quarto-table-cell-role="th">AVLAND2</th>
<th data-quarto-table-cell-role="th">AVTOT2</th>
<th data-quarto-table-cell-role="th">EXLAND2</th>
<th data-quarto-table-cell-role="th">EXTOT2</th>
<th data-quarto-table-cell-role="th">EXCD2</th>
<th data-quarto-table-cell-role="th">PERIOD</th>
<th data-quarto-table-cell-role="th">YEAR</th>
<th data-quarto-table-cell-role="th">VALTYPE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">126002</td>
<td>127752</td>
<td>1018259034</td>
<td>1</td>
<td>1825</td>
<td>9034</td>
<td>NaN</td>
<td>NaN</td>
<td>V0</td>
<td>1B</td>
<td>45.465048</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">126003</td>
<td>127753</td>
<td>1018259036</td>
<td>1</td>
<td>1825</td>
<td>9036</td>
<td>NaN</td>
<td>NaN</td>
<td>V0</td>
<td>1B</td>
<td>45.465048</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
</tr>
</tbody>
</table>

<p>2 rows × 32 columns</p>
</div>
</div>
</div>
</div>
<div id="23a8be75" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"LTDEPTH"</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>])[<span class="st">'LTDEPTH'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'LTDEPTH'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>0</code></pre>
</div>
</div>
</section>
<section id="bldfront" class="level4">
<h4 class="anchored" data-anchor-id="bldfront">BLDFRONT</h4>
<div id="ff0445e1" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'BLDFRONT'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>206926</code></pre>
</div>
</div>
<div id="0a461a13" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'BLDFRONT'</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>,<span class="st">'BORO'</span>,<span class="st">'BLDGCL'</span>])[<span class="st">'BLDFRONT'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'BLDFRONT'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<pre><code>18672</code></pre>
</div>
</div>
<div id="d94181ec" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'BLDFRONT'</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>,<span class="st">'BORO'</span>])[<span class="st">'BLDFRONT'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'BLDFRONT'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<pre><code>15718</code></pre>
</div>
</div>
<div id="09918514" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'BLDFRONT'</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>])[<span class="st">'BLDFRONT'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'BLDFRONT'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>0</code></pre>
</div>
</div>
</section>
<section id="bldepth" class="level4">
<h4 class="anchored" data-anchor-id="bldepth">BLDEPTH</h4>
<div id="c2c840c0" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'BLDDEPTH'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<pre><code>206944</code></pre>
</div>
</div>
<div id="9451d4f1" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'BLDDEPTH'</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>,<span class="st">'BORO'</span>,<span class="st">'BLDGCL'</span>])[<span class="st">'BLDDEPTH'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'BLDDEPTH'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<pre><code>15804</code></pre>
</div>
</div>
<div id="983dc470" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'BLDDEPTH'</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>,<span class="st">'BORO'</span>])[<span class="st">'BLDDEPTH'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'BLDDEPTH'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<pre><code>12830</code></pre>
</div>
</div>
<div id="e9c6fc2e" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'BLDDEPTH'</span>] <span class="op">=</span> data.<span class="op">\</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>                        groupby([<span class="st">'TAXCLASS'</span>])[<span class="st">'BLDDEPTH'</span>].transform(<span class="kw">lambda</span> x: x.fillna(x.mean()))</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'BLDDEPTH'</span>].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<pre><code>0</code></pre>
</div>
</div>
<div id="1640ecf0" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>data.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<pre><code>RECORD        int64
BBLE         object
BORO          int64
BLOCK         int64
LOT           int64
EASEMENT     object
OWNER        object
BLDGCL       object
TAXCLASS     object
LTFRONT     float64
LTDEPTH     float64
EXT          object
STORIES     float64
FULLVAL     float64
AVLAND      float64
AVTOT       float64
EXLAND      float64
EXTOT       float64
EXCD1       float64
STADDR       object
ZIP         float64
EXMPTCL      object
BLDFRONT    float64
BLDDEPTH    float64
AVLAND2     float64
AVTOT2      float64
EXLAND2     float64
EXTOT2      float64
EXCD2       float64
PERIOD       object
YEAR         object
VALTYPE      object
dtype: object</code></pre>
</div>
</div>
<div id="41fa56f4" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert ZIP to a string rather than a float</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We call the first three digits of the zip zip3</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'ZIP'</span>] <span class="op">=</span> data[<span class="st">'ZIP'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'zip3'</span>] <span class="op">=</span> data[<span class="st">'ZIP'</span>].<span class="bu">str</span>[:<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="f315670c" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> data.columns</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index(['RECORD', 'BBLE', 'BORO', 'BLOCK', 'LOT', 'EASEMENT', 'OWNER', 'BLDGCL',
       'TAXCLASS', 'LTFRONT', 'LTDEPTH', 'EXT', 'STORIES', 'FULLVAL', 'AVLAND',
       'AVTOT', 'EXLAND', 'EXTOT', 'EXCD1', 'STADDR', 'ZIP', 'EXMPTCL',
       'BLDFRONT', 'BLDDEPTH', 'AVLAND2', 'AVTOT2', 'EXLAND2', 'EXTOT2',
       'EXCD2', 'PERIOD', 'YEAR', 'VALTYPE', 'zip3'],
      dtype='object')</code></pre>
</div>
</div>
</section>
<section id="now-build-variables-that-try-to-find-properties-that-are-unusual-in-ways-were-interested-in" class="level3">
<h3 class="anchored" data-anchor-id="now-build-variables-that-try-to-find-properties-that-are-unusual-in-ways-were-interested-in">Now build variables that try to find properties that are unusual in ways we’re interested in</h3>
<div id="9f8ab72c" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># epsilon is an arbitrary small number to make sure we don't divide by zero</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>epsilon <span class="op">=</span> <span class="fl">.0001</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'ltsize'</span>] <span class="op">=</span> data[<span class="st">'LTFRONT'</span>] <span class="op">*</span> data[<span class="st">'LTDEPTH'</span>] <span class="op">+</span> epsilon</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'bldsize'</span>] <span class="op">=</span> data[<span class="st">'BLDFRONT'</span>] <span class="op">*</span> data[<span class="st">'BLDDEPTH'</span>] <span class="op">+</span> epsilon</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'bldvol'</span>] <span class="op">=</span> data[<span class="st">'bldsize'</span>] <span class="op">*</span> data[<span class="st">'STORIES'</span>] <span class="op">+</span> epsilon</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="219df689" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'r1'</span>] <span class="op">=</span> data[<span class="st">'FULLVAL'</span>] <span class="op">/</span> data[<span class="st">'ltsize'</span>]</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'r2'</span>] <span class="op">=</span> data[<span class="st">'FULLVAL'</span>] <span class="op">/</span> data[<span class="st">'bldsize'</span>]</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'r3'</span>] <span class="op">=</span> data[<span class="st">'FULLVAL'</span>] <span class="op">/</span> data[<span class="st">'bldvol'</span>]</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'r4'</span>] <span class="op">=</span> data[<span class="st">'AVLAND'</span>] <span class="op">/</span> data[<span class="st">'ltsize'</span>]</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'r5'</span>] <span class="op">=</span> data[<span class="st">'AVLAND'</span>] <span class="op">/</span> data[<span class="st">'bldsize'</span>]</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'r6'</span>] <span class="op">=</span> data[<span class="st">'AVLAND'</span>] <span class="op">/</span> data[<span class="st">'bldvol'</span>]</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'r7'</span>] <span class="op">=</span> data[<span class="st">'AVTOT'</span>] <span class="op">/</span> data[<span class="st">'ltsize'</span>]</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'r8'</span>] <span class="op">=</span> data[<span class="st">'AVTOT'</span>] <span class="op">/</span> data[<span class="st">'bldsize'</span>]</span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'r9'</span>] <span class="op">=</span> data[<span class="st">'AVTOT'</span>] <span class="op">/</span> data[<span class="st">'bldvol'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="7ae7c1d8" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>data.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="77">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th">BORO</th>
<th data-quarto-table-cell-role="th">BLOCK</th>
<th data-quarto-table-cell-role="th">LOT</th>
<th data-quarto-table-cell-role="th">LTFRONT</th>
<th data-quarto-table-cell-role="th">LTDEPTH</th>
<th data-quarto-table-cell-role="th">STORIES</th>
<th data-quarto-table-cell-role="th">FULLVAL</th>
<th data-quarto-table-cell-role="th">AVLAND</th>
<th data-quarto-table-cell-role="th">AVTOT</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">bldvol</th>
<th data-quarto-table-cell-role="th">r1</th>
<th data-quarto-table-cell-role="th">r2</th>
<th data-quarto-table-cell-role="th">r3</th>
<th data-quarto-table-cell-role="th">r4</th>
<th data-quarto-table-cell-role="th">r5</th>
<th data-quarto-table-cell-role="th">r6</th>
<th data-quarto-table-cell-role="th">r7</th>
<th data-quarto-table-cell-role="th">r8</th>
<th data-quarto-table-cell-role="th">r9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>...</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>5.368069e+05</td>
<td>3.220281e+00</td>
<td>4.756777e+03</td>
<td>3.509013e+02</td>
<td>5.045457e+01</td>
<td>1.073812e+02</td>
<td>4.969850e+00</td>
<td>8.166002e+05</td>
<td>6.654802e+04</td>
<td>1.999379e+05</td>
<td>...</td>
<td>6.143487e+04</td>
<td>2.107194e+02</td>
<td>5.350157e+02</td>
<td>2.451426e+02</td>
<td>9.965350e+00</td>
<td>2.336084e+01</td>
<td>1.025281e+01</td>
<td>2.534315e+01</td>
<td>4.970893e+01</td>
<td>1.930086e+01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>3.080025e+05</td>
<td>1.199074e+00</td>
<td>3.677416e+03</td>
<td>8.267095e+02</td>
<td>5.999584e+01</td>
<td>5.153451e+01</td>
<td>8.225039e+00</td>
<td>6.399805e+06</td>
<td>2.012308e+06</td>
<td>5.392440e+06</td>
<td>...</td>
<td>2.325184e+06</td>
<td>4.571358e+02</td>
<td>9.277953e+02</td>
<td>4.564148e+02</td>
<td>6.515434e+01</td>
<td>3.670539e+02</td>
<td>1.592434e+02</td>
<td>1.593337e+02</td>
<td>9.083669e+02</td>
<td>3.132694e+02</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>9.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>2.000000e+00</td>
<td>2.000000e+00</td>
<td>1.000000e+00</td>
<td>4.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>...</td>
<td>8.000200e+00</td>
<td>3.614764e-04</td>
<td>8.696149e-04</td>
<td>6.269316e-05</td>
<td>8.333333e-06</td>
<td>9.662388e-05</td>
<td>7.432606e-06</td>
<td>8.333333e-06</td>
<td>2.000000e-04</td>
<td>3.716303e-05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>2.729100e+05</td>
<td>3.000000e+00</td>
<td>1.542000e+03</td>
<td>2.300000e+01</td>
<td>2.100000e+01</td>
<td>1.000000e+02</td>
<td>2.000000e+00</td>
<td>3.181550e+05</td>
<td>9.679000e+03</td>
<td>1.892600e+04</td>
<td>...</td>
<td>1.408000e+03</td>
<td>7.566667e+01</td>
<td>2.064777e+02</td>
<td>8.013468e+01</td>
<td>2.370750e+00</td>
<td>5.980342e+00</td>
<td>2.170500e+00</td>
<td>5.378469e+00</td>
<td>1.736622e+01</td>
<td>7.240779e+00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>5.387720e+05</td>
<td>3.000000e+00</td>
<td>4.078000e+03</td>
<td>4.900000e+01</td>
<td>3.000000e+01</td>
<td>1.000000e+02</td>
<td>2.000000e+00</td>
<td>4.540000e+05</td>
<td>1.387800e+04</td>
<td>2.579100e+04</td>
<td>...</td>
<td>2.210000e+03</td>
<td>1.533719e+02</td>
<td>5.000000e+02</td>
<td>2.391826e+02</td>
<td>4.590250e+00</td>
<td>1.504083e+01</td>
<td>7.180850e+00</td>
<td>8.619412e+00</td>
<td>2.700291e+01</td>
<td>1.272639e+01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>8.022750e+05</td>
<td>4.000000e+00</td>
<td>6.920000e+03</td>
<td>1.400000e+02</td>
<td>6.000000e+01</td>
<td>1.120598e+02</td>
<td>4.000000e+00</td>
<td>6.240000e+05</td>
<td>1.998000e+04</td>
<td>4.724400e+04</td>
<td>...</td>
<td>7.035000e+03</td>
<td>2.430000e+02</td>
<td>6.853332e+02</td>
<td>3.364317e+02</td>
<td>7.215789e+00</td>
<td>2.035416e+01</td>
<td>1.006597e+01</td>
<td>1.352434e+01</td>
<td>3.602222e+01</td>
<td>1.759953e+01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>1.070994e+06</td>
<td>5.000000e+00</td>
<td>1.635000e+04</td>
<td>9.450000e+03</td>
<td>9.999000e+03</td>
<td>9.619000e+03</td>
<td>1.190000e+02</td>
<td>1.663775e+09</td>
<td>1.792809e+09</td>
<td>4.668309e+09</td>
<td>...</td>
<td>2.205711e+09</td>
<td>8.586666e+04</td>
<td>2.855351e+05</td>
<td>2.275000e+05</td>
<td>3.728371e+04</td>
<td>3.331136e+05</td>
<td>1.110379e+05</td>
<td>3.864000e+04</td>
<td>8.673969e+05</td>
<td>2.891323e+05</td>
</tr>
</tbody>
</table>

<p>8 rows × 32 columns</p>
</div>
</div>
</div>
</div>
<p>I want outliers in these 9 variables, either very high or very low. Very high is easy to find but very low might be close to zero and probably not many standard deviations below the average. A simple way to look for outliers that are very low is to also include 1/over these variables, which will be very large outliers when the variables are very low. First I scale them all to have reasonable average.</p>
<div id="08c0f1e8" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>vars9 <span class="op">=</span> [<span class="st">'r1'</span>,<span class="st">'r2'</span>,<span class="st">'r3'</span>,<span class="st">'r4'</span>,<span class="st">'r5'</span>,<span class="st">'r6'</span>,<span class="st">'r7'</span>,<span class="st">'r8'</span>,<span class="st">'r9'</span>]</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">vars</span> <span class="kw">in</span> vars9:</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>    data[<span class="bu">vars</span>] <span class="op">=</span> data[<span class="bu">vars</span>]<span class="op">/</span>data[<span class="bu">vars</span>].median()</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>data.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="78">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th">BORO</th>
<th data-quarto-table-cell-role="th">BLOCK</th>
<th data-quarto-table-cell-role="th">LOT</th>
<th data-quarto-table-cell-role="th">LTFRONT</th>
<th data-quarto-table-cell-role="th">LTDEPTH</th>
<th data-quarto-table-cell-role="th">STORIES</th>
<th data-quarto-table-cell-role="th">FULLVAL</th>
<th data-quarto-table-cell-role="th">AVLAND</th>
<th data-quarto-table-cell-role="th">AVTOT</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">bldvol</th>
<th data-quarto-table-cell-role="th">r1</th>
<th data-quarto-table-cell-role="th">r2</th>
<th data-quarto-table-cell-role="th">r3</th>
<th data-quarto-table-cell-role="th">r4</th>
<th data-quarto-table-cell-role="th">r5</th>
<th data-quarto-table-cell-role="th">r6</th>
<th data-quarto-table-cell-role="th">r7</th>
<th data-quarto-table-cell-role="th">r8</th>
<th data-quarto-table-cell-role="th">r9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>...</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>5.368069e+05</td>
<td>3.220281e+00</td>
<td>4.756777e+03</td>
<td>3.509013e+02</td>
<td>5.045457e+01</td>
<td>1.073812e+02</td>
<td>4.969850e+00</td>
<td>8.166002e+05</td>
<td>6.654802e+04</td>
<td>1.999379e+05</td>
<td>...</td>
<td>6.143487e+04</td>
<td>1.373911e+00</td>
<td>1.070031e+00</td>
<td>1.024918e+00</td>
<td>2.170982e+00</td>
<td>1.553161e+00</td>
<td>1.427799e+00</td>
<td>2.940242e+00</td>
<td>1.840873e+00</td>
<td>1.516602e+00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>3.080025e+05</td>
<td>1.199074e+00</td>
<td>3.677416e+03</td>
<td>8.267095e+02</td>
<td>5.999584e+01</td>
<td>5.153451e+01</td>
<td>8.225039e+00</td>
<td>6.399805e+06</td>
<td>2.012308e+06</td>
<td>5.392440e+06</td>
<td>...</td>
<td>2.325184e+06</td>
<td>2.980571e+00</td>
<td>1.855591e+00</td>
<td>1.908227e+00</td>
<td>1.419407e+01</td>
<td>2.440382e+01</td>
<td>2.217612e+01</td>
<td>1.848544e+01</td>
<td>3.363960e+01</td>
<td>2.461574e+01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>9.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>2.000000e+00</td>
<td>2.000000e+00</td>
<td>1.000000e+00</td>
<td>4.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>...</td>
<td>8.000200e+00</td>
<td>2.356863e-06</td>
<td>1.739230e-06</td>
<td>2.621142e-07</td>
<td>1.815442e-06</td>
<td>6.424104e-06</td>
<td>1.035059e-06</td>
<td>9.668100e-07</td>
<td>7.406610e-06</td>
<td>2.920156e-06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>2.729100e+05</td>
<td>3.000000e+00</td>
<td>1.542000e+03</td>
<td>2.300000e+01</td>
<td>2.100000e+01</td>
<td>1.000000e+02</td>
<td>2.000000e+00</td>
<td>3.181550e+05</td>
<td>9.679000e+03</td>
<td>1.892600e+04</td>
<td>...</td>
<td>1.408000e+03</td>
<td>4.933542e-01</td>
<td>4.129555e-01</td>
<td>3.350355e-01</td>
<td>5.164751e-01</td>
<td>3.976071e-01</td>
<td>3.022622e-01</td>
<td>6.239949e-01</td>
<td>6.431241e-01</td>
<td>5.689580e-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>5.387720e+05</td>
<td>3.000000e+00</td>
<td>4.078000e+03</td>
<td>4.900000e+01</td>
<td>3.000000e+01</td>
<td>1.000000e+02</td>
<td>2.000000e+00</td>
<td>4.540000e+05</td>
<td>1.387800e+04</td>
<td>2.579100e+04</td>
<td>...</td>
<td>2.210000e+03</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>8.022750e+05</td>
<td>4.000000e+00</td>
<td>6.920000e+03</td>
<td>1.400000e+02</td>
<td>6.000000e+01</td>
<td>1.120598e+02</td>
<td>4.000000e+00</td>
<td>6.240000e+05</td>
<td>1.998000e+04</td>
<td>4.724400e+04</td>
<td>...</td>
<td>7.035000e+03</td>
<td>1.584384e+00</td>
<td>1.370666e+00</td>
<td>1.406589e+00</td>
<td>1.571982e+00</td>
<td>1.353260e+00</td>
<td>1.401780e+00</td>
<td>1.569056e+00</td>
<td>1.334013e+00</td>
<td>1.382917e+00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>1.070994e+06</td>
<td>5.000000e+00</td>
<td>1.635000e+04</td>
<td>9.450000e+03</td>
<td>9.999000e+03</td>
<td>9.619000e+03</td>
<td>1.190000e+02</td>
<td>1.663775e+09</td>
<td>1.792809e+09</td>
<td>4.668309e+09</td>
<td>...</td>
<td>2.205711e+09</td>
<td>5.598592e+02</td>
<td>5.710702e+02</td>
<td>9.511558e+02</td>
<td>8.122370e+03</td>
<td>2.214728e+04</td>
<td>1.546305e+04</td>
<td>4.482904e+03</td>
<td>3.212235e+04</td>
<td>2.271912e+04</td>
</tr>
</tbody>
</table>

<p>8 rows × 32 columns</p>
</div>
</div>
</div>
</div>
<div id="a3377e91" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add in the inverse of all the 9 primary variables.</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">vars</span> <span class="kw">in</span> vars9:</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>    data[<span class="bu">vars</span><span class="op">+</span><span class="st">'inv'</span>] <span class="op">=</span> <span class="dv">1</span><span class="op">/</span>(data[<span class="bu">vars</span>] <span class="op">+</span> epsilon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c969773f" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="80">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th">BBLE</th>
<th data-quarto-table-cell-role="th">BORO</th>
<th data-quarto-table-cell-role="th">BLOCK</th>
<th data-quarto-table-cell-role="th">LOT</th>
<th data-quarto-table-cell-role="th">EASEMENT</th>
<th data-quarto-table-cell-role="th">OWNER</th>
<th data-quarto-table-cell-role="th">BLDGCL</th>
<th data-quarto-table-cell-role="th">TAXCLASS</th>
<th data-quarto-table-cell-role="th">LTFRONT</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">r9</th>
<th data-quarto-table-cell-role="th">r1inv</th>
<th data-quarto-table-cell-role="th">r2inv</th>
<th data-quarto-table-cell-role="th">r3inv</th>
<th data-quarto-table-cell-role="th">r4inv</th>
<th data-quarto-table-cell-role="th">r5inv</th>
<th data-quarto-table-cell-role="th">r6inv</th>
<th data-quarto-table-cell-role="th">r7inv</th>
<th data-quarto-table-cell-role="th">r8inv</th>
<th data-quarto-table-cell-role="th">r9inv</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>9</td>
<td>1000041001</td>
<td>1</td>
<td>4</td>
<td>1001</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>70.813856</td>
<td>...</td>
<td>0.188672</td>
<td>0.319454</td>
<td>1.873784</td>
<td>44.626014</td>
<td>0.059294</td>
<td>0.349613</td>
<td>8.339012</td>
<td>0.039897</td>
<td>0.224915</td>
<td>5.297406</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>10</td>
<td>1000041002</td>
<td>1</td>
<td>4</td>
<td>1002</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>70.813856</td>
<td>...</td>
<td>0.272666</td>
<td>0.221048</td>
<td>1.296641</td>
<td>30.921506</td>
<td>0.041028</td>
<td>0.241917</td>
<td>5.771662</td>
<td>0.027607</td>
<td>0.155631</td>
<td>3.666141</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>11</td>
<td>1000041003</td>
<td>1</td>
<td>4</td>
<td>1003</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>70.813856</td>
<td>...</td>
<td>0.506981</td>
<td>0.118886</td>
<td>0.697406</td>
<td>16.654116</td>
<td>0.038983</td>
<td>0.229860</td>
<td>5.484137</td>
<td>0.014848</td>
<td>0.083703</td>
<td>1.972072</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>12</td>
<td>1000041004</td>
<td>1</td>
<td>4</td>
<td>1004</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>70.813856</td>
<td>...</td>
<td>0.048399</td>
<td>1.245200</td>
<td>7.300537</td>
<td>171.742678</td>
<td>0.231138</td>
<td>1.362741</td>
<td>32.429174</td>
<td>0.155527</td>
<td>0.876721</td>
<td>20.619011</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>13</td>
<td>1000041005</td>
<td>1</td>
<td>4</td>
<td>1005</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>70.813856</td>
<td>...</td>
<td>0.110867</td>
<td>0.543627</td>
<td>3.188341</td>
<td>75.706405</td>
<td>0.100904</td>
<td>0.594947</td>
<td>14.182787</td>
<td>0.067895</td>
<td>0.382749</td>
<td>9.011649</td>
</tr>
</tbody>
</table>

<p>5 rows × 54 columns</p>
</div>
</div>
</div>
</div>
<p>Now I want the large outliers where the variables are either very low or very high, so I’ll keep only one of the two, r or rinv, depending on which is largest. This allows me to find both the very low and high outliers.</p>
<div id="0cac190f" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">vars</span> <span class="kw">in</span> vars9:</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>    data[<span class="bu">vars</span>] <span class="op">=</span> data[[<span class="bu">vars</span>,<span class="bu">vars</span><span class="op">+</span><span class="st">'inv'</span>]].<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now I can remove the inverse columns since I have the 9 variables that I need</p>
<div id="3a4491e1" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">vars</span> <span class="kw">in</span> vars9:</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>    data.drop(columns<span class="op">=</span>(<span class="bu">vars</span><span class="op">+</span><span class="st">'inv'</span>),inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>data.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th">BORO</th>
<th data-quarto-table-cell-role="th">BLOCK</th>
<th data-quarto-table-cell-role="th">LOT</th>
<th data-quarto-table-cell-role="th">LTFRONT</th>
<th data-quarto-table-cell-role="th">LTDEPTH</th>
<th data-quarto-table-cell-role="th">STORIES</th>
<th data-quarto-table-cell-role="th">FULLVAL</th>
<th data-quarto-table-cell-role="th">AVLAND</th>
<th data-quarto-table-cell-role="th">AVTOT</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">bldvol</th>
<th data-quarto-table-cell-role="th">r1</th>
<th data-quarto-table-cell-role="th">r2</th>
<th data-quarto-table-cell-role="th">r3</th>
<th data-quarto-table-cell-role="th">r4</th>
<th data-quarto-table-cell-role="th">r5</th>
<th data-quarto-table-cell-role="th">r6</th>
<th data-quarto-table-cell-role="th">r7</th>
<th data-quarto-table-cell-role="th">r8</th>
<th data-quarto-table-cell-role="th">r9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>...</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>5.368069e+05</td>
<td>3.220281e+00</td>
<td>4.756777e+03</td>
<td>3.509013e+02</td>
<td>5.045457e+01</td>
<td>1.073812e+02</td>
<td>4.969850e+00</td>
<td>8.166002e+05</td>
<td>6.654802e+04</td>
<td>1.999379e+05</td>
<td>...</td>
<td>6.143487e+04</td>
<td>1.294444e+01</td>
<td>2.499720e+01</td>
<td>1.127279e+02</td>
<td>8.519128e+00</td>
<td>1.485009e+01</td>
<td>5.837383e+01</td>
<td>5.746233e+00</td>
<td>9.022489e+00</td>
<td>2.764315e+01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>3.080025e+05</td>
<td>1.199074e+00</td>
<td>3.677416e+03</td>
<td>8.267095e+02</td>
<td>5.999584e+01</td>
<td>5.153451e+01</td>
<td>8.225039e+00</td>
<td>6.399805e+06</td>
<td>2.012308e+06</td>
<td>5.392440e+06</td>
<td>...</td>
<td>2.325184e+06</td>
<td>1.088717e+02</td>
<td>1.815853e+02</td>
<td>5.091489e+02</td>
<td>7.580573e+01</td>
<td>1.304015e+02</td>
<td>3.641357e+02</td>
<td>5.249273e+01</td>
<td>1.047840e+02</td>
<td>2.144214e+02</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>9.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>2.000000e+00</td>
<td>2.000000e+00</td>
<td>1.000000e+00</td>
<td>4.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>...</td>
<td>8.000200e+00</td>
<td>9.999570e-01</td>
<td>9.999517e-01</td>
<td>9.999559e-01</td>
<td>9.999539e-01</td>
<td>9.999507e-01</td>
<td>9.999511e-01</td>
<td>9.999514e-01</td>
<td>9.999527e-01</td>
<td>9.999501e-01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>2.729100e+05</td>
<td>3.000000e+00</td>
<td>1.542000e+03</td>
<td>2.300000e+01</td>
<td>2.100000e+01</td>
<td>1.000000e+02</td>
<td>2.000000e+00</td>
<td>3.181550e+05</td>
<td>9.679000e+03</td>
<td>1.892600e+04</td>
<td>...</td>
<td>1.408000e+03</td>
<td>1.269474e+00</td>
<td>1.192974e+00</td>
<td>1.210624e+00</td>
<td>1.262922e+00</td>
<td>1.191561e+00</td>
<td>1.215178e+00</td>
<td>1.233189e+00</td>
<td>1.164291e+00</td>
<td>1.178231e+00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>5.387720e+05</td>
<td>3.000000e+00</td>
<td>4.078000e+03</td>
<td>4.900000e+01</td>
<td>3.000000e+01</td>
<td>1.000000e+02</td>
<td>2.000000e+00</td>
<td>4.540000e+05</td>
<td>1.387800e+04</td>
<td>2.579100e+04</td>
<td>...</td>
<td>2.210000e+03</td>
<td>1.701746e+00</td>
<td>1.488500e+00</td>
<td>1.560963e+00</td>
<td>1.682360e+00</td>
<td>1.474922e+00</td>
<td>1.577504e+00</td>
<td>1.585997e+00</td>
<td>1.403326e+00</td>
<td>1.470000e+00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>8.022750e+05</td>
<td>4.000000e+00</td>
<td>6.920000e+03</td>
<td>1.400000e+02</td>
<td>6.000000e+01</td>
<td>1.120598e+02</td>
<td>4.000000e+00</td>
<td>6.240000e+05</td>
<td>1.998000e+04</td>
<td>4.724400e+04</td>
<td>...</td>
<td>7.035000e+03</td>
<td>3.207889e+00</td>
<td>3.313753e+00</td>
<td>3.685617e+00</td>
<td>3.260447e+00</td>
<td>4.274797e+00</td>
<td>4.964164e+00</td>
<td>2.710417e+00</td>
<td>2.769308e+00</td>
<td>3.372197e+00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>1.070994e+06</td>
<td>5.000000e+00</td>
<td>1.635000e+04</td>
<td>9.450000e+03</td>
<td>9.999000e+03</td>
<td>9.619000e+03</td>
<td>1.190000e+02</td>
<td>1.663775e+09</td>
<td>1.792809e+09</td>
<td>4.668309e+09</td>
<td>...</td>
<td>2.205711e+09</td>
<td>9.769741e+03</td>
<td>9.829050e+03</td>
<td>9.973857e+03</td>
<td>9.821693e+03</td>
<td>2.214728e+04</td>
<td>1.546305e+04</td>
<td>9.904245e+03</td>
<td>3.212235e+04</td>
<td>2.271912e+04</td>
</tr>
</tbody>
</table>

<p>8 rows × 32 columns</p>
</div>
</div>
</div>
</div>
<p>Now I add more variables where I standardize each of these 9 basic variables by a few logical groupings. For example, is a property’s value of r1 typical for that zip code? for that taxclass?</p>
<div id="b1f864b0" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardized variables by appropriate logical group</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>zip5_mean <span class="op">=</span> data.groupby(<span class="st">'ZIP'</span>)[vars9].mean()</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>taxclass_mean <span class="op">=</span> data.groupby(<span class="st">'TAXCLASS'</span>)[vars9].mean()</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.join(zip5_mean, on<span class="op">=</span><span class="st">'ZIP'</span>, rsuffix<span class="op">=</span><span class="st">'_zip5'</span>)</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.join(taxclass_mean, on<span class="op">=</span><span class="st">'TAXCLASS'</span>, rsuffix<span class="op">=</span><span class="st">'_taxclass'</span>)</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>rsuffix <span class="op">=</span> [<span class="st">'_zip5'</span>, <span class="st">'_taxclass'</span>]</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> vars9:</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> r <span class="kw">in</span> rsuffix:</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>        data[<span class="bu">str</span>(var)<span class="op">+</span>r] <span class="op">=</span> data[var] <span class="op">/</span> data[<span class="bu">str</span>(var)<span class="op">+</span>r]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="de9fc270" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># include two more possibly interesting variables</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'value_ratio'</span>] <span class="op">=</span> data[<span class="st">'FULLVAL'</span>]<span class="op">/</span>(data[<span class="st">'AVLAND'</span>]<span class="op">+</span>data[<span class="st">'AVTOT'</span>])</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'value_ratio'</span>] <span class="op">=</span> data[<span class="st">'value_ratio'</span>]<span class="op">/</span>data[<span class="st">'value_ratio'</span>].mean()</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="co"># again, use 1/variable if that's larger, in order to find the low outliers</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'value_ratio'</span>] <span class="op">=</span> np.where(data[<span class="st">'value_ratio'</span>] <span class="op">&lt;</span> <span class="dv">1</span>, <span class="dv">1</span><span class="op">/</span>(data[<span class="st">'value_ratio'</span>]<span class="op">+</span>epsilon), data[<span class="st">'value_ratio'</span>])</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'size_ratio'</span>] <span class="op">=</span> data[<span class="st">'bldsize'</span>] <span class="op">/</span> (data[<span class="st">'ltsize'</span>]<span class="op">+</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="277629de" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>data.head().transpose()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="85">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">RECORD</td>
<td>9</td>
<td>10</td>
<td>11</td>
<td>12</td>
<td>13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">BBLE</td>
<td>1000041001</td>
<td>1000041002</td>
<td>1000041003</td>
<td>1000041004</td>
<td>1000041005</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">BORO</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">BLOCK</td>
<td>4</td>
<td>4</td>
<td>4</td>
<td>4</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">LOT</td>
<td>1001</td>
<td>1002</td>
<td>1003</td>
<td>1004</td>
<td>1005</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r7_taxclass</td>
<td>1.288115</td>
<td>1.861571</td>
<td>3.461304</td>
<td>0.330433</td>
<td>0.756924</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r8_taxclass</td>
<td>0.177858</td>
<td>0.257039</td>
<td>0.477925</td>
<td>0.045625</td>
<td>0.104513</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r9_taxclass</td>
<td>0.056876</td>
<td>0.039362</td>
<td>0.021173</td>
<td>0.221379</td>
<td>0.096755</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">value_ratio</td>
<td>8.056705</td>
<td>8.056707</td>
<td>7.135024</td>
<td>8.056717</td>
<td>8.056713</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">size_ratio</td>
<td>1.799293</td>
<td>1.799293</td>
<td>1.799293</td>
<td>1.799293</td>
<td>1.799293</td>
</tr>
</tbody>
</table>

<p>65 rows × 5 columns</p>
</div>
</div>
</div>
</div>
<div id="89f6044d" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>data.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<pre><code>Index(['RECORD', 'BBLE', 'BORO', 'BLOCK', 'LOT', 'EASEMENT', 'OWNER', 'BLDGCL',
       'TAXCLASS', 'LTFRONT', 'LTDEPTH', 'EXT', 'STORIES', 'FULLVAL', 'AVLAND',
       'AVTOT', 'EXLAND', 'EXTOT', 'EXCD1', 'STADDR', 'ZIP', 'EXMPTCL',
       'BLDFRONT', 'BLDDEPTH', 'AVLAND2', 'AVTOT2', 'EXLAND2', 'EXTOT2',
       'EXCD2', 'PERIOD', 'YEAR', 'VALTYPE', 'zip3', 'ltsize', 'bldsize',
       'bldvol', 'r1', 'r2', 'r3', 'r4', 'r5', 'r6', 'r7', 'r8', 'r9',
       'r1_zip5', 'r2_zip5', 'r3_zip5', 'r4_zip5', 'r5_zip5', 'r6_zip5',
       'r7_zip5', 'r8_zip5', 'r9_zip5', 'r1_taxclass', 'r2_taxclass',
       'r3_taxclass', 'r4_taxclass', 'r5_taxclass', 'r6_taxclass',
       'r7_taxclass', 'r8_taxclass', 'r9_taxclass', 'value_ratio',
       'size_ratio'],
      dtype='object')</code></pre>
</div>
</div>
<div id="25aeb975" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>save_record <span class="op">=</span> data[<span class="st">'RECORD'</span>]</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>save_record.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="87">
<pre><code>0     9
1    10
2    11
3    12
4    13
Name: RECORD, dtype: int64</code></pre>
</div>
</div>
<div id="225dcc41" class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'lot_bldsize'</span>] <span class="op">=</span> data[<span class="st">'ltsize'</span>] <span class="op">/</span> data[<span class="st">'bldsize'</span>]</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Flags and Indicators</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>high_market_value_threshold <span class="op">=</span> data[<span class="st">'FULLVAL'</span>].quantile(<span class="fl">0.90</span>)</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'high_market_value_indicator'</span>] <span class="op">=</span> data[<span class="st">'FULLVAL'</span>] <span class="op">&gt;</span> high_market_value_threshold</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>high_building_density_threshold <span class="op">=</span> <span class="fl">0.70</span></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'high_market_value_indicator'</span>] <span class="op">=</span> data[<span class="st">'size_ratio'</span>] <span class="op">&gt;</span> high_building_density_threshold</span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Interaction Terms</span></span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'lot_building_interaction'</span>] <span class="op">=</span> data[<span class="st">'ltsize'</span>] <span class="op">*</span> data[<span class="st">'bldsize'</span>]</span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'market_assessed_value_interaction'</span>] <span class="op">=</span> data[<span class="st">'FULLVAL'</span>] <span class="op">*</span> data[<span class="st">'AVTOT'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6acaf515" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>dropcols <span class="op">=</span> [<span class="st">'RECORD'</span>,<span class="st">'BBLE'</span>, <span class="st">'BORO'</span>, <span class="st">'BLOCK'</span>, <span class="st">'LOT'</span>, <span class="st">'EASEMENT'</span>,</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">'OWNER'</span>, <span class="st">'BLDGCL'</span>, <span class="st">'TAXCLASS'</span>, <span class="st">'LTFRONT'</span>, <span class="st">'LTDEPTH'</span>, <span class="st">'EXT'</span>, <span class="st">'STORIES'</span>,</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">'FULLVAL'</span>, <span class="st">'AVLAND'</span>, <span class="st">'AVTOT'</span>, <span class="st">'EXLAND'</span>, <span class="st">'EXTOT'</span>, <span class="st">'EXCD1'</span>, <span class="st">'STADDR'</span>,</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">'ZIP'</span>, <span class="st">'EXMPTCL'</span>, <span class="st">'BLDFRONT'</span>, <span class="st">'BLDDEPTH'</span>, <span class="st">'AVLAND2'</span>, <span class="st">'AVTOT2'</span>,</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">'EXLAND2'</span>, <span class="st">'EXTOT2'</span>, <span class="st">'EXCD2'</span>, <span class="st">'PERIOD'</span>, <span class="st">'YEAR'</span>, <span class="st">'VALTYPE'</span>, <span class="st">'zip3'</span>,<span class="st">'ltsize'</span>,<span class="st">'bldsize'</span>,<span class="st">'bldvol'</span>]</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.drop(columns <span class="op">=</span> dropcols)</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="89">
<pre><code>(1044493, 33)</code></pre>
</div>
</div>
<div id="7fcd5a9d" class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this dataframe is now just the variables for our unsupervised fraud models</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>data.head().transpose()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="90">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">r1</td>
<td>3.130243</td>
<td>4.523796</td>
<td>8.411301</td>
<td>1.2452</td>
<td>1.839398</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r2</td>
<td>1.873784</td>
<td>1.296641</td>
<td>1.433786</td>
<td>7.300537</td>
<td>3.188341</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r3</td>
<td>44.626014</td>
<td>30.921506</td>
<td>16.654116</td>
<td>171.742678</td>
<td>75.706405</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r4</td>
<td>16.865039</td>
<td>24.373205</td>
<td>25.651791</td>
<td>4.32631</td>
<td>9.910288</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r5</td>
<td>2.860204</td>
<td>4.133542</td>
<td>4.350382</td>
<td>1.362741</td>
<td>1.680722</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r6</td>
<td>8.339012</td>
<td>5.771662</td>
<td>5.484137</td>
<td>32.429174</td>
<td>14.182787</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r7</td>
<td>25.064485</td>
<td>36.222944</td>
<td>67.350964</td>
<td>6.429659</td>
<td>14.728427</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r8</td>
<td>4.446018</td>
<td>6.42534</td>
<td>11.946927</td>
<td>1.140513</td>
<td>2.612575</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r9</td>
<td>5.297406</td>
<td>3.666141</td>
<td>1.972072</td>
<td>20.619011</td>
<td>9.011649</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r1_zip5</td>
<td>0.344811</td>
<td>0.498317</td>
<td>0.926544</td>
<td>0.137165</td>
<td>0.202618</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r2_zip5</td>
<td>0.068016</td>
<td>0.047066</td>
<td>0.052044</td>
<td>0.264999</td>
<td>0.115732</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r3_zip5</td>
<td>0.111838</td>
<td>0.077493</td>
<td>0.041737</td>
<td>0.430409</td>
<td>0.18973</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r4_zip5</td>
<td>1.040068</td>
<td>1.503097</td>
<td>1.581947</td>
<td>0.266804</td>
<td>0.611168</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r5_zip5</td>
<td>0.140338</td>
<td>0.202815</td>
<td>0.213455</td>
<td>0.066864</td>
<td>0.082466</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r6_zip5</td>
<td>0.027176</td>
<td>0.01881</td>
<td>0.017872</td>
<td>0.105685</td>
<td>0.046221</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r7_zip5</td>
<td>1.368515</td>
<td>1.977764</td>
<td>3.677347</td>
<td>0.351058</td>
<td>0.804169</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r8_zip5</td>
<td>0.536412</td>
<td>0.775217</td>
<td>1.441397</td>
<td>0.137603</td>
<td>0.315207</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r9_zip5</td>
<td>0.104537</td>
<td>0.072347</td>
<td>0.038916</td>
<td>0.406889</td>
<td>0.177833</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r1_taxclass</td>
<td>0.058539</td>
<td>0.0846</td>
<td>0.1573</td>
<td>0.023286</td>
<td>0.034399</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r2_taxclass</td>
<td>0.016154</td>
<td>0.011178</td>
<td>0.012361</td>
<td>0.062937</td>
<td>0.027486</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r3_taxclass</td>
<td>0.132343</td>
<td>0.091701</td>
<td>0.04939</td>
<td>0.509322</td>
<td>0.224516</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r4_taxclass</td>
<td>0.545548</td>
<td>0.788422</td>
<td>0.829781</td>
<td>0.139947</td>
<td>0.320577</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r5_taxclass</td>
<td>0.054123</td>
<td>0.078218</td>
<td>0.082321</td>
<td>0.025787</td>
<td>0.031804</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r6_taxclass</td>
<td>0.044412</td>
<td>0.030738</td>
<td>0.029207</td>
<td>0.17271</td>
<td>0.075534</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r7_taxclass</td>
<td>1.288115</td>
<td>1.861571</td>
<td>3.461304</td>
<td>0.330433</td>
<td>0.756924</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r8_taxclass</td>
<td>0.177858</td>
<td>0.257039</td>
<td>0.477925</td>
<td>0.045625</td>
<td>0.104513</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r9_taxclass</td>
<td>0.056876</td>
<td>0.039362</td>
<td>0.021173</td>
<td>0.221379</td>
<td>0.096755</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">value_ratio</td>
<td>8.056705</td>
<td>8.056707</td>
<td>7.135024</td>
<td>8.056717</td>
<td>8.056713</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">size_ratio</td>
<td>1.799293</td>
<td>1.799293</td>
<td>1.799293</td>
<td>1.799293</td>
<td>1.799293</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lot_bldsize</td>
<td>0.555706</td>
<td>0.555706</td>
<td>0.555706</td>
<td>0.555706</td>
<td>0.555706</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">high_market_value_indicator</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lot_building_interaction</td>
<td>121492255.305798</td>
<td>121492255.305798</td>
<td>121492255.305798</td>
<td>121492255.305798</td>
<td>121492255.305798</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">market_assessed_value_interaction</td>
<td>7002516650966.0</td>
<td>14625274139670.0</td>
<td>50562000000000.0</td>
<td>460799629504.0</td>
<td>2417960736912.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="f7e68182" class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate and write the basic statistics of all the variables to check if everything looks OK</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> data.describe().transpose()</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>stats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="91">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">r1</td>
<td>1044493.0</td>
<td>1.294444e+01</td>
<td>1.088717e+02</td>
<td>0.999957</td>
<td>1.269474e+00</td>
<td>1.701746e+00</td>
<td>3.207889e+00</td>
<td>9.769741e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r2</td>
<td>1044493.0</td>
<td>2.499720e+01</td>
<td>1.815853e+02</td>
<td>0.999952</td>
<td>1.192974e+00</td>
<td>1.488500e+00</td>
<td>3.313753e+00</td>
<td>9.829050e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r3</td>
<td>1044493.0</td>
<td>1.127279e+02</td>
<td>5.091489e+02</td>
<td>0.999956</td>
<td>1.210624e+00</td>
<td>1.560963e+00</td>
<td>3.685617e+00</td>
<td>9.973857e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r4</td>
<td>1044493.0</td>
<td>8.519128e+00</td>
<td>7.580573e+01</td>
<td>0.999954</td>
<td>1.262922e+00</td>
<td>1.682360e+00</td>
<td>3.260447e+00</td>
<td>9.821693e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r5</td>
<td>1044493.0</td>
<td>1.485009e+01</td>
<td>1.304015e+02</td>
<td>0.999951</td>
<td>1.191561e+00</td>
<td>1.474922e+00</td>
<td>4.274797e+00</td>
<td>2.214728e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r6</td>
<td>1044493.0</td>
<td>5.837383e+01</td>
<td>3.641357e+02</td>
<td>0.999951</td>
<td>1.215178e+00</td>
<td>1.577504e+00</td>
<td>4.964164e+00</td>
<td>1.546305e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r7</td>
<td>1044493.0</td>
<td>5.746233e+00</td>
<td>5.249273e+01</td>
<td>0.999951</td>
<td>1.233189e+00</td>
<td>1.585997e+00</td>
<td>2.710417e+00</td>
<td>9.904245e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r8</td>
<td>1044493.0</td>
<td>9.022489e+00</td>
<td>1.047840e+02</td>
<td>0.999953</td>
<td>1.164291e+00</td>
<td>1.403326e+00</td>
<td>2.769308e+00</td>
<td>3.212235e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r9</td>
<td>1044493.0</td>
<td>2.764315e+01</td>
<td>2.144214e+02</td>
<td>0.999950</td>
<td>1.178231e+00</td>
<td>1.470000e+00</td>
<td>3.372197e+00</td>
<td>2.271912e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r1_zip5</td>
<td>1044493.0</td>
<td>1.000000e+00</td>
<td>8.217521e+00</td>
<td>0.005040</td>
<td>1.619956e-01</td>
<td>3.215630e-01</td>
<td>6.642092e-01</td>
<td>2.284920e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r2_zip5</td>
<td>1044493.0</td>
<td>1.000000e+00</td>
<td>8.869314e+00</td>
<td>0.001689</td>
<td>1.020206e-01</td>
<td>2.270835e-01</td>
<td>5.228364e-01</td>
<td>1.365401e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r3_zip5</td>
<td>1044493.0</td>
<td>1.000000e+00</td>
<td>9.074389e+00</td>
<td>0.000491</td>
<td>5.121857e-02</td>
<td>1.354225e-01</td>
<td>4.224967e-01</td>
<td>1.454222e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r4_zip5</td>
<td>1044493.0</td>
<td>1.000000e+00</td>
<td>6.586892e+00</td>
<td>0.007198</td>
<td>2.092768e-01</td>
<td>3.997583e-01</td>
<td>7.210783e-01</td>
<td>2.092640e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r5_zip5</td>
<td>1044493.0</td>
<td>1.000000e+00</td>
<td>9.721280e+00</td>
<td>0.003136</td>
<td>1.464844e-01</td>
<td>2.348185e-01</td>
<td>4.425110e-01</td>
<td>2.998695e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r6_zip5</td>
<td>1044493.0</td>
<td>1.000000e+00</td>
<td>9.493043e+00</td>
<td>0.000569</td>
<td>8.694206e-02</td>
<td>1.559555e-01</td>
<td>3.436608e-01</td>
<td>1.838606e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r7_zip5</td>
<td>1044493.0</td>
<td>1.000000e+00</td>
<td>7.881081e+00</td>
<td>0.009727</td>
<td>2.953191e-01</td>
<td>4.733899e-01</td>
<td>7.430448e-01</td>
<td>2.296383e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r8_zip5</td>
<td>1044493.0</td>
<td>1.000000e+00</td>
<td>1.234179e+01</td>
<td>0.006126</td>
<td>1.632185e-01</td>
<td>2.475734e-01</td>
<td>4.167635e-01</td>
<td>3.005149e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r9_zip5</td>
<td>1044493.0</td>
<td>1.000000e+00</td>
<td>1.152124e+01</td>
<td>0.001153</td>
<td>9.615886e-02</td>
<td>1.617427e-01</td>
<td>2.970505e-01</td>
<td>2.177199e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r1_taxclass</td>
<td>1044493.0</td>
<td>1.000000e+00</td>
<td>3.494666e+00</td>
<td>0.007712</td>
<td>5.608901e-01</td>
<td>7.193174e-01</td>
<td>9.924283e-01</td>
<td>1.013376e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r2_taxclass</td>
<td>1044493.0</td>
<td>1.000000e+00</td>
<td>5.572151e+00</td>
<td>0.008621</td>
<td>6.723179e-01</td>
<td>8.026218e-01</td>
<td>1.011107e+00</td>
<td>3.755317e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r3_taxclass</td>
<td>1044493.0</td>
<td>1.000000e+00</td>
<td>6.074469e+00</td>
<td>0.002193</td>
<td>6.655659e-01</td>
<td>8.122948e-01</td>
<td>1.064785e+00</td>
<td>4.260404e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r4_taxclass</td>
<td>1044493.0</td>
<td>1.000000e+00</td>
<td>4.296360e+00</td>
<td>0.026635</td>
<td>5.986215e-01</td>
<td>7.583626e-01</td>
<td>1.017097e+00</td>
<td>1.303541e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r5_taxclass</td>
<td>1044493.0</td>
<td>1.000000e+00</td>
<td>5.350972e+00</td>
<td>0.008257</td>
<td>5.863012e-01</td>
<td>7.962156e-01</td>
<td>9.913575e-01</td>
<td>3.133052e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r6_taxclass</td>
<td>1044493.0</td>
<td>1.000000e+00</td>
<td>5.316970e+00</td>
<td>0.004834</td>
<td>6.154172e-01</td>
<td>7.804270e-01</td>
<td>1.024000e+00</td>
<td>3.567660e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r7_taxclass</td>
<td>1044493.0</td>
<td>1.000000e+00</td>
<td>4.675335e+00</td>
<td>0.023186</td>
<td>6.099768e-01</td>
<td>7.581443e-01</td>
<td>1.000533e+00</td>
<td>2.082944e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r8_taxclass</td>
<td>1044493.0</td>
<td>1.000000e+00</td>
<td>6.165441e+00</td>
<td>0.005117</td>
<td>7.017349e-01</td>
<td>8.178881e-01</td>
<td>9.923429e-01</td>
<td>3.790923e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r9_taxclass</td>
<td>1044493.0</td>
<td>1.000000e+00</td>
<td>5.973456e+00</td>
<td>0.003115</td>
<td>6.826764e-01</td>
<td>8.073178e-01</td>
<td>1.023067e+00</td>
<td>4.239516e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">value_ratio</td>
<td>1044493.0</td>
<td>3.255193e+00</td>
<td>1.823361e+01</td>
<td>0.999901</td>
<td>1.119627e+00</td>
<td>1.284058e+00</td>
<td>6.390237e+00</td>
<td>1.000271e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">size_ratio</td>
<td>1044493.0</td>
<td>6.551120e-01</td>
<td>1.261914e+01</td>
<td>0.000027</td>
<td>2.541492e-01</td>
<td>3.811814e-01</td>
<td>6.245891e-01</td>
<td>1.019954e+04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lot_bldsize</td>
<td>1044493.0</td>
<td>4.244950e+00</td>
<td>6.185213e+01</td>
<td>0.000098</td>
<td>1.600000e+00</td>
<td>2.622768e+00</td>
<td>3.933566e+00</td>
<td>3.705596e+04</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lot_building_interaction</td>
<td>1044493.0</td>
<td>1.066826e+08</td>
<td>1.306322e+10</td>
<td>3600.012000</td>
<td>1.716000e+06</td>
<td>3.130380e+06</td>
<td>1.085600e+07</td>
<td>1.031513e+13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">market_assessed_value_interaction</td>
<td>1044493.0</td>
<td>2.004535e+13</td>
<td>2.637493e+15</td>
<td>40.000000</td>
<td>6.506798e+09</td>
<td>1.159500e+10</td>
<td>2.365120e+10</td>
<td>1.746040e+18</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="e4317c2b" class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>data.isna().<span class="bu">sum</span>().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="92">
<pre><code>0</code></pre>
</div>
</div>
<div id="bb8d9ee6" class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># zscale all the variables</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>data_zs <span class="op">=</span> (data <span class="op">-</span> data.mean()) <span class="op">/</span> data.std()</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>data_zs_save <span class="op">=</span> data_zs.copy()</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>data_zs.describe().transpose()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="93">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">r1</td>
<td>1044493.0</td>
<td>4.530633e-18</td>
<td>1.0</td>
<td>-0.109712</td>
<td>-0.107236</td>
<td>-0.103265</td>
<td>-0.089431</td>
<td>89.617375</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r2</td>
<td>1044493.0</td>
<td>-9.066709e-17</td>
<td>1.0</td>
<td>-0.132154</td>
<td>-0.131091</td>
<td>-0.129464</td>
<td>-0.119412</td>
<td>53.991444</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r3</td>
<td>1044493.0</td>
<td>-2.068037e-17</td>
<td>1.0</td>
<td>-0.219441</td>
<td>-0.219027</td>
<td>-0.218339</td>
<td>-0.214166</td>
<td>19.367869</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r4</td>
<td>1044493.0</td>
<td>1.768716e-18</td>
<td>1.0</td>
<td>-0.099190</td>
<td>-0.095721</td>
<td>-0.090188</td>
<td>-0.069370</td>
<td>129.451612</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r5</td>
<td>1044493.0</td>
<td>-5.904789e-18</td>
<td>1.0</td>
<td>-0.106211</td>
<td>-0.104742</td>
<td>-0.102569</td>
<td>-0.081098</td>
<td>169.725243</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r6</td>
<td>1044493.0</td>
<td>-2.737428e-17</td>
<td>1.0</td>
<td>-0.157562</td>
<td>-0.156971</td>
<td>-0.155976</td>
<td>-0.146675</td>
<td>42.304772</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r7</td>
<td>1044493.0</td>
<td>2.552393e-17</td>
<td>1.0</td>
<td>-0.090418</td>
<td>-0.085975</td>
<td>-0.079254</td>
<td>-0.057833</td>
<td>188.568939</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r8</td>
<td>1044493.0</td>
<td>-1.129257e-17</td>
<td>1.0</td>
<td>-0.076563</td>
<td>-0.074994</td>
<td>-0.072713</td>
<td>-0.059677</td>
<td>306.471822</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r9</td>
<td>1044493.0</td>
<td>1.455789e-18</td>
<td>1.0</td>
<td>-0.124256</td>
<td>-0.123425</td>
<td>-0.122064</td>
<td>-0.113193</td>
<td>105.826575</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r1_zip5</td>
<td>1044493.0</td>
<td>1.171434e-17</td>
<td>1.0</td>
<td>-0.121078</td>
<td>-0.101978</td>
<td>-0.082560</td>
<td>-0.040863</td>
<td>277.932913</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r2_zip5</td>
<td>1044493.0</td>
<td>-4.839478e-17</td>
<td>1.0</td>
<td>-0.112558</td>
<td>-0.101246</td>
<td>-0.087145</td>
<td>-0.053799</td>
<td>153.833918</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r3_zip5</td>
<td>1044493.0</td>
<td>-2.387086e-17</td>
<td>1.0</td>
<td>-0.110146</td>
<td>-0.104556</td>
<td>-0.095277</td>
<td>-0.063641</td>
<td>160.145446</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r4_zip5</td>
<td>1044493.0</td>
<td>4.955125e-17</td>
<td>1.0</td>
<td>-0.150724</td>
<td>-0.120045</td>
<td>-0.091127</td>
<td>-0.042345</td>
<td>317.545865</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r5_zip5</td>
<td>1044493.0</td>
<td>-4.581654e-17</td>
<td>1.0</td>
<td>-0.102545</td>
<td>-0.087799</td>
<td>-0.078712</td>
<td>-0.057347</td>
<td>308.364256</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r6_zip5</td>
<td>1044493.0</td>
<td>1.185720e-17</td>
<td>1.0</td>
<td>-0.105280</td>
<td>-0.096182</td>
<td>-0.088912</td>
<td>-0.069139</td>
<td>193.573973</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r7_zip5</td>
<td>1044493.0</td>
<td>3.945596e-19</td>
<td>1.0</td>
<td>-0.125652</td>
<td>-0.089414</td>
<td>-0.066820</td>
<td>-0.032604</td>
<td>291.252317</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r8_zip5</td>
<td>1044493.0</td>
<td>-3.524846e-17</td>
<td>1.0</td>
<td>-0.080529</td>
<td>-0.067801</td>
<td>-0.060966</td>
<td>-0.047257</td>
<td>243.412712</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r9_zip5</td>
<td>1044493.0</td>
<td>-5.727918e-17</td>
<td>1.0</td>
<td>-0.086696</td>
<td>-0.078450</td>
<td>-0.072758</td>
<td>-0.061013</td>
<td>188.885835</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r1_taxclass</td>
<td>1044493.0</td>
<td>-7.925207e-18</td>
<td>1.0</td>
<td>-0.283944</td>
<td>-0.125651</td>
<td>-0.080317</td>
<td>-0.002167</td>
<td>289.691763</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r2_taxclass</td>
<td>1044493.0</td>
<td>-7.393231e-17</td>
<td>1.0</td>
<td>-0.177917</td>
<td>-0.058807</td>
<td>-0.035422</td>
<td>0.001993</td>
<td>673.764395</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r3_taxclass</td>
<td>1044493.0</td>
<td>-3.470084e-17</td>
<td>1.0</td>
<td>-0.164262</td>
<td>-0.055056</td>
<td>-0.030901</td>
<td>0.010665</td>
<td>701.197810</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r4_taxclass</td>
<td>1044493.0</td>
<td>2.733346e-17</td>
<td>1.0</td>
<td>-0.226556</td>
<td>-0.093423</td>
<td>-0.056242</td>
<td>0.003979</td>
<td>303.173221</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r5_taxclass</td>
<td>1044493.0</td>
<td>1.123815e-17</td>
<td>1.0</td>
<td>-0.185339</td>
<td>-0.077313</td>
<td>-0.038084</td>
<td>-0.001615</td>
<td>585.323933</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r6_taxclass</td>
<td>1044493.0</td>
<td>-9.251743e-19</td>
<td>1.0</td>
<td>-0.187168</td>
<td>-0.072331</td>
<td>-0.041297</td>
<td>0.004514</td>
<td>670.807012</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r7_taxclass</td>
<td>1044493.0</td>
<td>4.419068e-17</td>
<td>1.0</td>
<td>-0.208929</td>
<td>-0.083421</td>
<td>-0.051730</td>
<td>0.000114</td>
<td>445.303652</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">r8_taxclass</td>
<td>1044493.0</td>
<td>-2.258514e-18</td>
<td>1.0</td>
<td>-0.161364</td>
<td>-0.048377</td>
<td>-0.029538</td>
<td>-0.001242</td>
<td>614.704237</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">r9_taxclass</td>
<td>1044493.0</td>
<td>3.466002e-18</td>
<td>1.0</td>
<td>-0.166886</td>
<td>-0.053122</td>
<td>-0.032256</td>
<td>0.003862</td>
<td>709.558482</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">value_ratio</td>
<td>1044493.0</td>
<td>-3.327907e-17</td>
<td>1.0</td>
<td>-0.123689</td>
<td>-0.117123</td>
<td>-0.108105</td>
<td>0.171938</td>
<td>548.408183</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">size_ratio</td>
<td>1044493.0</td>
<td>2.881646e-17</td>
<td>1.0</td>
<td>-0.051912</td>
<td>-0.031774</td>
<td>-0.021708</td>
<td>-0.002419</td>
<td>808.207306</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lot_bldsize</td>
<td>1044493.0</td>
<td>-3.417703e-17</td>
<td>1.0</td>
<td>-0.068629</td>
<td>-0.042762</td>
<td>-0.026227</td>
<td>-0.005034</td>
<td>599.037066</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">high_market_value_indicator</td>
<td>1044493.0</td>
<td>7.662620e-17</td>
<td>1.0</td>
<td>-0.500292</td>
<td>-0.500292</td>
<td>-0.500292</td>
<td>-0.500292</td>
<td>1.998831</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lot_building_interaction</td>
<td>1044493.0</td>
<td>-2.948993e-18</td>
<td>1.0</td>
<td>-0.008166</td>
<td>-0.008035</td>
<td>-0.007927</td>
<td>-0.007336</td>
<td>789.623089</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">market_assessed_value_interaction</td>
<td>1044493.0</td>
<td>-3.387771e-18</td>
<td>1.0</td>
<td>-0.007600</td>
<td>-0.007598</td>
<td>-0.007596</td>
<td>-0.007591</td>
<td>662.000028</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="5a24087c" class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co"># do a complete PCA and look at the scree and cumulative variance plots</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components <span class="op">=</span> <span class="fl">.99</span>, svd_solver <span class="op">=</span> <span class="st">'full'</span>)</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>pca.fit(data_zs)</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>plt.plot(pca.explained_variance_ratio_)</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Number of components minus 1'</span>)</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'PC variance'</span>)</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>plt.xticks(np.arange(<span class="dv">0</span>, <span class="dv">36</span>, step<span class="op">=</span><span class="dv">2</span>))</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span><span class="dv">4</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NY_OG_files/figure-html/cell-95-output-1.png" width="606" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="97705dd1" class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># do a complete PCA and look at the scree and cumulative variance plots</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components <span class="op">=</span> <span class="fl">.99</span>, svd_solver <span class="op">=</span> <span class="st">'full'</span>)</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>pca.fit(data_zs)</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span><span class="dv">4</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>plt.bar(np.arange(<span class="bu">len</span>(pca.explained_variance_ratio_)), pca.explained_variance_ratio_)</span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(<span class="bu">len</span>(pca.explained_variance_ratio_)), pca.explained_variance_ratio_, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Number of components minus 1'</span>)</span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'PC variance'</span>)</span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>plt.xticks(np.arange(<span class="dv">0</span>, <span class="dv">10</span>, step<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NY_OG_files/figure-html/cell-96-output-1.png" width="597" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="fb6f5de0" class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Number of components minus 1'</span>)</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>plt.plot(np.cumsum(pca.explained_variance_ratio_))</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'PC cumulative variance'</span>)</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>plt.yticks(np.arange(<span class="fl">0.05</span>, <span class="fl">1.1</span>, step<span class="op">=</span><span class="fl">.1</span>))</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>plt.xticks(np.arange(<span class="dv">0</span>, <span class="dv">36</span>, step<span class="op">=</span><span class="dv">2</span>))</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span><span class="dv">4</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="dv">0</span>,<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NY_OG_files/figure-html/cell-97-output-1.png" width="606" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="e7c121eb" class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="co"># now redo the PCA but just keep the top few PCs</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>data_zs <span class="op">=</span> data_zs_save.copy()</span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components <span class="op">=</span> <span class="dv">5</span>, svd_solver <span class="op">=</span> <span class="st">'full'</span>)</span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>princ_comps <span class="op">=</span> pca.fit_transform(data_zs)</span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>pca.n_components_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 8.3 s, sys: 732 ms, total: 9.03 s
Wall time: 2.41 s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="97">
<pre><code>5</code></pre>
</div>
</div>
<div id="fd56a3bc" class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.cumsum(pca.explained_variance_ratio_))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[0.3194038  0.46603662 0.57642861 0.64734677 0.70235809]</code></pre>
</div>
</div>
<div id="e31c7f85" class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>data_pca <span class="op">=</span> pd.DataFrame(princ_comps, columns <span class="op">=</span> [<span class="st">'PC'</span> <span class="op">+</span> <span class="bu">str</span>(i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, pca.n_components_<span class="op">+</span><span class="dv">1</span>)])</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>data_pca.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="99">
<pre><code>(1044493, 5)</code></pre>
</div>
</div>
<div id="4d4e97ff" class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>data_pca.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="100">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PC1</th>
<th data-quarto-table-cell-role="th">PC2</th>
<th data-quarto-table-cell-role="th">PC3</th>
<th data-quarto-table-cell-role="th">PC4</th>
<th data-quarto-table-cell-role="th">PC5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-0.287502</td>
<td>-0.312171</td>
<td>0.021055</td>
<td>-0.171276</td>
<td>0.190024</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-0.167137</td>
<td>-0.399473</td>
<td>0.172508</td>
<td>-0.057031</td>
<td>0.245359</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.069719</td>
<td>-0.575129</td>
<td>0.451087</td>
<td>0.203608</td>
<td>0.298239</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>-0.387076</td>
<td>-0.137734</td>
<td>-0.249001</td>
<td>-0.485465</td>
<td>0.059842</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>-0.381933</td>
<td>-0.226063</td>
<td>-0.122581</td>
<td>-0.298735</td>
<td>0.132512</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="64e1a03c" class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>data_pca.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="101">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PC1</th>
<th data-quarto-table-cell-role="th">PC2</th>
<th data-quarto-table-cell-role="th">PC3</th>
<th data-quarto-table-cell-role="th">PC4</th>
<th data-quarto-table-cell-role="th">PC5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>4.468048e-17</td>
<td>7.164659e-17</td>
<td>-3.877569e-17</td>
<td>4.680294e-17</td>
<td>2.031302e-17</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>3.246587e+00</td>
<td>2.199746e+00</td>
<td>1.908648e+00</td>
<td>1.529804e+00</td>
<td>1.347358e+00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>-7.175446e-01</td>
<td>-2.136625e+02</td>
<td>-3.459215e+02</td>
<td>-3.316447e+01</td>
<td>-1.712929e+02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>-4.594581e-01</td>
<td>-3.344164e-02</td>
<td>-6.328371e-02</td>
<td>1.412898e-01</td>
<td>-4.141070e-03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>-4.062916e-01</td>
<td>8.377637e-02</td>
<td>-1.950388e-03</td>
<td>2.171742e-01</td>
<td>4.098485e-02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>-2.631572e-01</td>
<td>1.474075e-01</td>
<td>6.211204e-02</td>
<td>2.489887e-01</td>
<td>6.809073e-02</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>7.937746e+02</td>
<td>1.384273e+03</td>
<td>3.553147e+02</td>
<td>3.896609e+02</td>
<td>3.495221e+02</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="1ee6f414" class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># zscale the pcs.</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="co"># I do this (make all the retained PCs equally important) if I only keep a small number of PCs.</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternatively you can keep maybe up to 6 to 8 or so, and don't do this second z scale</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a><span class="co"># I prefer to keep a somewhat small number of PCs and then make them all equally important via zscaling.</span></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This second zscale step makes the later Minkowski distance to be similar to a Mahalanobis distance.</span></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Many people don't do this second zscaling, but I like to do it.</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>data_pca_zs <span class="op">=</span> (data_pca <span class="op">-</span> data_pca.mean()) <span class="op">/</span> data_pca.std()</span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>data_pca_zs.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PC1</th>
<th data-quarto-table-cell-role="th">PC2</th>
<th data-quarto-table-cell-role="th">PC3</th>
<th data-quarto-table-cell-role="th">PC4</th>
<th data-quarto-table-cell-role="th">PC5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>-3.068041e-17</td>
<td>-4.081651e-20</td>
<td>-2.598651e-18</td>
<td>-7.564661e-18</td>
<td>3.959202e-18</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>-2.210151e-01</td>
<td>-9.713052e+01</td>
<td>-1.812391e+02</td>
<td>-2.167891e+01</td>
<td>-1.271324e+02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>-1.415203e-01</td>
<td>-1.520250e-02</td>
<td>-3.315631e-02</td>
<td>9.235811e-02</td>
<td>-3.073474e-03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>-1.251442e-01</td>
<td>3.808456e-02</td>
<td>-1.021869e-03</td>
<td>1.419621e-01</td>
<td>3.041868e-02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>-8.105657e-02</td>
<td>6.701115e-02</td>
<td>3.254243e-02</td>
<td>1.627586e-01</td>
<td>5.053648e-02</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>2.444951e+02</td>
<td>6.292876e+02</td>
<td>1.861604e+02</td>
<td>2.547130e+02</td>
<td>2.594129e+02</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="016fbaa1" class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>data_pca_zs.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="103">
<pre><code>(1044493, 5)</code></pre>
</div>
</div>
<div id="813754ca" class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>data_pca_zs.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="104">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PC1</th>
<th data-quarto-table-cell-role="th">PC2</th>
<th data-quarto-table-cell-role="th">PC3</th>
<th data-quarto-table-cell-role="th">PC4</th>
<th data-quarto-table-cell-role="th">PC5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-0.088555</td>
<td>-0.141912</td>
<td>0.011031</td>
<td>-0.111960</td>
<td>0.141034</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-0.051481</td>
<td>-0.181599</td>
<td>0.090382</td>
<td>-0.037280</td>
<td>0.182104</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.021475</td>
<td>-0.261452</td>
<td>0.236338</td>
<td>0.133094</td>
<td>0.221351</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>-0.119225</td>
<td>-0.062614</td>
<td>-0.130459</td>
<td>-0.317338</td>
<td>0.044414</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>-0.117641</td>
<td>-0.102768</td>
<td>-0.064224</td>
<td>-0.195277</td>
<td>0.098350</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
</section>
<section id="now-calculate-two-unsupervised-fraud-scores" class="level2">
<h2 class="anchored" data-anchor-id="now-calculate-two-unsupervised-fraud-scores">Now calculate two unsupervised fraud scores</h2>
<div id="5ead2e98" class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the powers for the two Minkowski distances. The final results are relatively insensitive to these choices. </span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Good choices are anywhere from 1 to about 4.</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>ntop <span class="op">=</span> <span class="dv">10000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="calculate-score-1" class="level3">
<h3 class="anchored" data-anchor-id="calculate-score-1">Calculate score 1</h3>
<div id="5aae08c2" class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>oop1 <span class="op">=</span> <span class="dv">1</span><span class="op">/</span>p1</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>score1 <span class="op">=</span> (((data_pca_zs).<span class="bu">abs</span>()<span class="op">**</span>p1).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>))<span class="op">**</span>oop1</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>score1.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="106">
<pre><code>0    0.246025
1    0.279909
2    0.437475
3    0.371256
4    0.276281
5    0.281636
6    0.371264
7    0.360560
8    0.360560
9    0.360560
dtype: float64</code></pre>
</div>
</div>
<div id="be0bbba5" class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>data_pca_zs.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="107">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PC1</th>
<th data-quarto-table-cell-role="th">PC2</th>
<th data-quarto-table-cell-role="th">PC3</th>
<th data-quarto-table-cell-role="th">PC4</th>
<th data-quarto-table-cell-role="th">PC5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-0.088555</td>
<td>-0.141912</td>
<td>0.011031</td>
<td>-0.111960</td>
<td>0.141034</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-0.051481</td>
<td>-0.181599</td>
<td>0.090382</td>
<td>-0.037280</td>
<td>0.182104</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.021475</td>
<td>-0.261452</td>
<td>0.236338</td>
<td>0.133094</td>
<td>0.221351</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>-0.119225</td>
<td>-0.062614</td>
<td>-0.130459</td>
<td>-0.317338</td>
<td>0.044414</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>-0.117641</td>
<td>-0.102768</td>
<td>-0.064224</td>
<td>-0.195277</td>
<td>0.098350</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>-0.119354</td>
<td>-0.099474</td>
<td>-0.070257</td>
<td>-0.203236</td>
<td>0.094537</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>-0.006353</td>
<td>-0.226469</td>
<td>0.181305</td>
<td>0.043025</td>
<td>0.227564</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>-0.011020</td>
<td>-0.221945</td>
<td>0.172113</td>
<td>0.035079</td>
<td>0.223089</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>-0.011020</td>
<td>-0.221945</td>
<td>0.172113</td>
<td>0.035079</td>
<td>0.223089</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>-0.011020</td>
<td>-0.221945</td>
<td>0.172113</td>
<td>0.035079</td>
<td>0.223089</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="d0152653" class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>score1.<span class="bu">max</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="108">
<pre><code>726.0134522130637</code></pre>
</div>
</div>
</section>
<section id="autoencoder-for-score-2" class="level3">
<h3 class="anchored" data-anchor-id="autoencoder-for-score-2">Autoencoder for score 2</h3>
<div id="b6a80a91" class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>NNmodel <span class="op">=</span> MLPRegressor(hidden_layer_sizes<span class="op">=</span>(<span class="dv">3</span>),activation<span class="op">=</span><span class="st">'logistic'</span>,max_iter<span class="op">=</span><span class="dv">50</span>,random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>NNmodel.fit(data_pca_zs,data_pca_zs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="109">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</a></style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>MLPRegressor(activation='logistic', hidden_layer_sizes=3, max_iter=50,
             random_state=1)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;MLPRegressor<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.neural_network.MLPRegressor.html">?<span>Documentation for MLPRegressor</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>MLPRegressor(activation='logistic', hidden_layer_sizes=3, max_iter=50,
             random_state=1)</pre></div> </div></div></div></div>
</div>
</div>
<div id="f5530a07" class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate score 2 as the error of an autoencoder</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>pca_out <span class="op">=</span> NNmodel.predict(data_pca_zs)</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>error <span class="op">=</span> pca_out <span class="op">-</span> data_pca_zs</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>oop2 <span class="op">=</span> <span class="dv">1</span><span class="op">/</span>p2</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>score2 <span class="op">=</span> ((error.<span class="bu">abs</span>()<span class="op">**</span>p2).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>))<span class="op">**</span>oop2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="31885889" class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> pd.DataFrame(score1)</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>scores.columns<span class="op">=</span>[<span class="st">'score1'</span>]</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>scores[<span class="st">'score2'</span>] <span class="op">=</span> score2</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>scores[<span class="st">'RECORD'</span>] <span class="op">=</span> save_record</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>scores.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="111">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">score1</th>
<th data-quarto-table-cell-role="th">score2</th>
<th data-quarto-table-cell-role="th">RECORD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.246025</td>
<td>0.222947</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.279909</td>
<td>0.258002</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.437475</td>
<td>0.373022</td>
<td>11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.371256</td>
<td>0.265296</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.276281</td>
<td>0.227088</td>
<td>13</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>0.281636</td>
<td>0.229178</td>
<td>14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>0.371264</td>
<td>0.329990</td>
<td>15</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>0.360560</td>
<td>0.321740</td>
<td>16</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>0.360560</td>
<td>0.321740</td>
<td>17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>0.360560</td>
<td>0.321740</td>
<td>18</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="c91da402" class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>scores[<span class="st">'score1 rank'</span>] <span class="op">=</span> scores[<span class="st">'score1'</span>].rank()</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>scores[<span class="st">'score2 rank'</span>] <span class="op">=</span> scores[<span class="st">'score2'</span>].rank()</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>scores.head(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="112">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">score1</th>
<th data-quarto-table-cell-role="th">score2</th>
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th">score1 rank</th>
<th data-quarto-table-cell-role="th">score2 rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.246025</td>
<td>0.222947</td>
<td>9</td>
<td>678868.0</td>
<td>808100.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.279909</td>
<td>0.258002</td>
<td>10</td>
<td>765499.0</td>
<td>856994.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.437475</td>
<td>0.373022</td>
<td>11</td>
<td>875948.0</td>
<td>963320.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.371256</td>
<td>0.265296</td>
<td>12</td>
<td>850129.0</td>
<td>870794.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.276281</td>
<td>0.227088</td>
<td>13</td>
<td>759084.0</td>
<td>813206.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>0.281636</td>
<td>0.229178</td>
<td>14</td>
<td>768573.0</td>
<td>815829.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>0.371264</td>
<td>0.329990</td>
<td>15</td>
<td>850134.0</td>
<td>937470.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>0.360560</td>
<td>0.321740</td>
<td>16</td>
<td>844765.0</td>
<td>931056.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>0.360560</td>
<td>0.321740</td>
<td>17</td>
<td>844764.0</td>
<td>931058.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>0.360560</td>
<td>0.321740</td>
<td>18</td>
<td>844769.0</td>
<td>931061.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>0.360560</td>
<td>0.321740</td>
<td>19</td>
<td>844770.0</td>
<td>931062.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>0.360560</td>
<td>0.321740</td>
<td>20</td>
<td>844767.0</td>
<td>931060.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>0.360560</td>
<td>0.321740</td>
<td>21</td>
<td>844768.0</td>
<td>931057.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>0.360560</td>
<td>0.321740</td>
<td>22</td>
<td>844766.0</td>
<td>931059.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>0.360409</td>
<td>0.321624</td>
<td>23</td>
<td>844681.0</td>
<td>930980.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>0.355454</td>
<td>0.317796</td>
<td>24</td>
<td>841943.0</td>
<td>928028.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>0.355454</td>
<td>0.317796</td>
<td>25</td>
<td>841942.0</td>
<td>928027.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>0.367873</td>
<td>0.327379</td>
<td>26</td>
<td>848537.0</td>
<td>935575.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>0.367873</td>
<td>0.327379</td>
<td>27</td>
<td>848535.0</td>
<td>935573.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>0.367873</td>
<td>0.327379</td>
<td>28</td>
<td>848534.0</td>
<td>935572.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="d52df372" class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the final score as the average of the two scores</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>weight <span class="op">=</span> <span class="fl">.5</span></span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>scores[<span class="st">'final'</span>] <span class="op">=</span> (weight<span class="op">*</span>scores[<span class="st">'score1 rank'</span>] <span class="op">+</span> (<span class="dv">1</span><span class="op">-</span>weight)<span class="op">*</span>scores[<span class="st">'score2 rank'</span>])</span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>scores_sorted <span class="op">=</span> scores.sort_values(by<span class="op">=</span><span class="st">'final'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>scores_sorted.head(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="113">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">score1</th>
<th data-quarto-table-cell-role="th">score2</th>
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th">score1 rank</th>
<th data-quarto-table-cell-role="th">score2 rank</th>
<th data-quarto-table-cell-role="th">final</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">934505</td>
<td>726.013452</td>
<td>724.824555</td>
<td>956520</td>
<td>1044493.0</td>
<td>1044493.0</td>
<td>1044493.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">641107</td>
<td>658.286442</td>
<td>657.201701</td>
<td>658933</td>
<td>1044492.0</td>
<td>1044492.0</td>
<td>1044492.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">897398</td>
<td>358.381867</td>
<td>329.739441</td>
<td>917942</td>
<td>1044491.0</td>
<td>1044491.0</td>
<td>1044491.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">632014</td>
<td>251.986026</td>
<td>215.525578</td>
<td>649717</td>
<td>1044490.0</td>
<td>1044490.0</td>
<td>1044490.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">960230</td>
<td>226.307024</td>
<td>213.092588</td>
<td>982930</td>
<td>1044488.0</td>
<td>1044489.0</td>
<td>1044488.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">443552</td>
<td>241.769839</td>
<td>201.444558</td>
<td>459429</td>
<td>1044489.0</td>
<td>1044487.0</td>
<td>1044488.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">957706</td>
<td>224.150706</td>
<td>211.014789</td>
<td>980276</td>
<td>1044487.0</td>
<td>1044488.0</td>
<td>1044487.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">973751</td>
<td>206.165107</td>
<td>164.724296</td>
<td>996722</td>
<td>1044486.0</td>
<td>1044486.0</td>
<td>1044486.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">320488</td>
<td>159.593777</td>
<td>160.141393</td>
<td>333412</td>
<td>1044485.0</td>
<td>1044485.0</td>
<td>1044485.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">230836</td>
<td>159.122510</td>
<td>131.377231</td>
<td>241946</td>
<td>1044484.0</td>
<td>1044484.0</td>
<td>1044484.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">110100</td>
<td>132.861721</td>
<td>130.441746</td>
<td>111420</td>
<td>1044482.0</td>
<td>1044483.0</td>
<td>1044482.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1028942</td>
<td>141.101680</td>
<td>115.443716</td>
<td>1053859</td>
<td>1044483.0</td>
<td>1044481.0</td>
<td>1044482.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">956476</td>
<td>131.662481</td>
<td>122.488266</td>
<td>979038</td>
<td>1044481.0</td>
<td>1044482.0</td>
<td>1044481.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1024406</td>
<td>126.321406</td>
<td>102.640900</td>
<td>1048771</td>
<td>1044476.0</td>
<td>1044480.0</td>
<td>1044478.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1024115</td>
<td>126.171272</td>
<td>101.988095</td>
<td>1048475</td>
<td>1044475.0</td>
<td>1044479.0</td>
<td>1044477.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">212609</td>
<td>130.105159</td>
<td>95.853362</td>
<td>223485</td>
<td>1044480.0</td>
<td>1044466.0</td>
<td>1044473.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">678408</td>
<td>128.442574</td>
<td>94.071228</td>
<td>696562</td>
<td>1044479.0</td>
<td>1044464.0</td>
<td>1044471.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1020880</td>
<td>120.657288</td>
<td>95.991879</td>
<td>1045012</td>
<td>1044472.0</td>
<td>1044467.0</td>
<td>1044469.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7005</td>
<td>117.979749</td>
<td>101.199214</td>
<td>7040</td>
<td>1044465.0</td>
<td>1044473.0</td>
<td>1044469.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7006</td>
<td>117.979749</td>
<td>101.199214</td>
<td>7041</td>
<td>1044465.0</td>
<td>1044473.0</td>
<td>1044469.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="0f2952c0" class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>scores_sorted.tail(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="114">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">score1</th>
<th data-quarto-table-cell-role="th">score2</th>
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th">score1 rank</th>
<th data-quarto-table-cell-role="th">score2 rank</th>
<th data-quarto-table-cell-role="th">final</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">443730</td>
<td>0.092243</td>
<td>0.022357</td>
<td>459607</td>
<td>130.0</td>
<td>477.0</td>
<td>303.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">408048</td>
<td>0.104202</td>
<td>0.020191</td>
<td>423613</td>
<td>292.0</td>
<td>233.0</td>
<td>262.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">428809</td>
<td>0.092621</td>
<td>0.020661</td>
<td>444598</td>
<td>134.0</td>
<td>273.0</td>
<td>203.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">437408</td>
<td>0.102844</td>
<td>0.016975</td>
<td>453273</td>
<td>266.0</td>
<td>64.0</td>
<td>165.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">511325</td>
<td>0.100810</td>
<td>0.017665</td>
<td>527820</td>
<td>232.0</td>
<td>80.0</td>
<td>156.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">408873</td>
<td>0.102089</td>
<td>0.012103</td>
<td>424441</td>
<td>256.0</td>
<td>13.0</td>
<td>134.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">408049</td>
<td>0.101055</td>
<td>0.012903</td>
<td>423614</td>
<td>236.0</td>
<td>17.0</td>
<td>126.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">445557</td>
<td>0.094642</td>
<td>0.018453</td>
<td>461446</td>
<td>146.0</td>
<td>104.0</td>
<td>125.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">308515</td>
<td>0.082448</td>
<td>0.019058</td>
<td>321161</td>
<td>80.0</td>
<td>138.0</td>
<td>109.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">182515</td>
<td>0.081563</td>
<td>0.015904</td>
<td>186718</td>
<td>75.0</td>
<td>40.0</td>
<td>57.5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="759d6cac" class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>scores.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="115">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">score1</th>
<th data-quarto-table-cell-role="th">score2</th>
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th">score1 rank</th>
<th data-quarto-table-cell-role="th">score2 rank</th>
<th data-quarto-table-cell-role="th">final</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>4.861766e-01</td>
<td>2.176407e-01</td>
<td>5.368069e+05</td>
<td>5.222470e+05</td>
<td>5.222470e+05</td>
<td>5.222470e+05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>2.182575e+00</td>
<td>1.563808e+00</td>
<td>3.080025e+05</td>
<td>3.015193e+05</td>
<td>3.015193e+05</td>
<td>2.926665e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>4.918587e-02</td>
<td>8.101042e-03</td>
<td>9.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>5.750000e+01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>2.089560e-01</td>
<td>6.090604e-02</td>
<td>2.729100e+05</td>
<td>2.611240e+05</td>
<td>2.611240e+05</td>
<td>2.638430e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>2.204428e-01</td>
<td>9.609887e-02</td>
<td>5.387720e+05</td>
<td>5.222470e+05</td>
<td>5.222470e+05</td>
<td>5.045235e+05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>2.907654e-01</td>
<td>1.986070e-01</td>
<td>8.022750e+05</td>
<td>7.833700e+05</td>
<td>7.833700e+05</td>
<td>7.812585e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>7.260135e+02</td>
<td>7.248246e+02</td>
<td>1.070994e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="f52af46c" class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>scores_sorted.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="116">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">score1</th>
<th data-quarto-table-cell-role="th">score2</th>
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th">score1 rank</th>
<th data-quarto-table-cell-role="th">score2 rank</th>
<th data-quarto-table-cell-role="th">final</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>4.861766e-01</td>
<td>2.176407e-01</td>
<td>5.368069e+05</td>
<td>5.222470e+05</td>
<td>5.222470e+05</td>
<td>5.222470e+05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>2.182575e+00</td>
<td>1.563808e+00</td>
<td>3.080025e+05</td>
<td>3.015193e+05</td>
<td>3.015193e+05</td>
<td>2.926665e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>4.918587e-02</td>
<td>8.101042e-03</td>
<td>9.000000e+00</td>
<td>1.000000e+00</td>
<td>1.000000e+00</td>
<td>5.750000e+01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>2.089560e-01</td>
<td>6.090604e-02</td>
<td>2.729100e+05</td>
<td>2.611240e+05</td>
<td>2.611240e+05</td>
<td>2.638430e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>2.204428e-01</td>
<td>9.609887e-02</td>
<td>5.387720e+05</td>
<td>5.222470e+05</td>
<td>5.222470e+05</td>
<td>5.045235e+05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>2.907654e-01</td>
<td>1.986070e-01</td>
<td>8.022750e+05</td>
<td>7.833700e+05</td>
<td>7.833700e+05</td>
<td>7.812585e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>7.260135e+02</td>
<td>7.248246e+02</td>
<td>1.070994e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
<td>1.044493e+06</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="3c96dc91" class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>scores_sorted.set_index(<span class="st">'RECORD'</span>, drop<span class="op">=</span><span class="va">True</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>scores_sorted.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="117">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">score1</th>
<th data-quarto-table-cell-role="th">score2</th>
<th data-quarto-table-cell-role="th">score1 rank</th>
<th data-quarto-table-cell-role="th">score2 rank</th>
<th data-quarto-table-cell-role="th">final</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">956520</td>
<td>726.013452</td>
<td>724.824555</td>
<td>1044493.0</td>
<td>1044493.0</td>
<td>1044493.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">658933</td>
<td>658.286442</td>
<td>657.201701</td>
<td>1044492.0</td>
<td>1044492.0</td>
<td>1044492.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">917942</td>
<td>358.381867</td>
<td>329.739441</td>
<td>1044491.0</td>
<td>1044491.0</td>
<td>1044491.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">649717</td>
<td>251.986026</td>
<td>215.525578</td>
<td>1044490.0</td>
<td>1044490.0</td>
<td>1044490.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">982930</td>
<td>226.307024</td>
<td>213.092588</td>
<td>1044488.0</td>
<td>1044489.0</td>
<td>1044488.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">459429</td>
<td>241.769839</td>
<td>201.444558</td>
<td>1044489.0</td>
<td>1044487.0</td>
<td>1044488.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">980276</td>
<td>224.150706</td>
<td>211.014789</td>
<td>1044487.0</td>
<td>1044488.0</td>
<td>1044487.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">996722</td>
<td>206.165107</td>
<td>164.724296</td>
<td>1044486.0</td>
<td>1044486.0</td>
<td>1044486.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">333412</td>
<td>159.593777</td>
<td>160.141393</td>
<td>1044485.0</td>
<td>1044485.0</td>
<td>1044485.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">241946</td>
<td>159.122510</td>
<td>131.377231</td>
<td>1044484.0</td>
<td>1044484.0</td>
<td>1044484.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="22ff00b1" class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>sc1max <span class="op">=</span> <span class="bu">int</span>(score1.<span class="bu">max</span>())</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>plt.hist(score1, bins <span class="op">=</span><span class="dv">100</span>, <span class="bu">range</span><span class="op">=</span>(<span class="dv">0</span>,sc1max<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>plt.yscale(<span class="st">'log'</span>)</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>plt.ylim(ymin<span class="op">=</span><span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NY_OG_files/figure-html/cell-119-output-1.png" width="580" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="8b9fe224" class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>sc2max <span class="op">=</span> <span class="bu">int</span>(score2.<span class="bu">max</span>())</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>sc2max</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="119">
<pre><code>724</code></pre>
</div>
</div>
<div id="3bcfce91" class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>sc2max <span class="op">=</span> <span class="bu">int</span>(score2.<span class="bu">max</span>())</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sc2max)</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>plt.hist(score2, bins <span class="op">=</span><span class="dv">100</span>, <span class="bu">range</span><span class="op">=</span>(<span class="dv">0</span>,sc2max<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>plt.yscale(<span class="st">'log'</span>)</span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>plt.ylim(ymin<span class="op">=</span><span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>724</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NY_OG_files/figure-html/cell-121-output-2.png" width="580" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The flatter the next plot, the more similar are the two scores. If the two scores are very similar then the rank order hardly changes and the plot is flat.</p>
<div id="24fe8c0c" class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>sns.displot(scores[<span class="st">'final'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NY_OG_files/figure-html/cell-122-output-1.png" width="470" height="470" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="46d65fb3" class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>top_records <span class="op">=</span> scores_sorted.head(ntop).index</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(top_records)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index([ 956520,  658933,  917942,  649717,  982930,  459429,  980276,  996722,
        333412,  241946,
       ...
         98965, 1059396,  956149,  779437, 1008025,  161344,   51125,  929750,
         58145,  944706],
      dtype='int64', name='RECORD', length=10000)</code></pre>
</div>
</div>
<div id="423cdf7f" class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>data_zs[<span class="st">'RECORD'</span>] <span class="op">=</span> save_record</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>data_zs.set_index(<span class="st">'RECORD'</span>, inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>data_zs.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="123">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">r1</th>
<th data-quarto-table-cell-role="th">r2</th>
<th data-quarto-table-cell-role="th">r3</th>
<th data-quarto-table-cell-role="th">r4</th>
<th data-quarto-table-cell-role="th">r5</th>
<th data-quarto-table-cell-role="th">r6</th>
<th data-quarto-table-cell-role="th">r7</th>
<th data-quarto-table-cell-role="th">r8</th>
<th data-quarto-table-cell-role="th">r9</th>
<th data-quarto-table-cell-role="th">r1_zip5</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">r6_taxclass</th>
<th data-quarto-table-cell-role="th">r7_taxclass</th>
<th data-quarto-table-cell-role="th">r8_taxclass</th>
<th data-quarto-table-cell-role="th">r9_taxclass</th>
<th data-quarto-table-cell-role="th">value_ratio</th>
<th data-quarto-table-cell-role="th">size_ratio</th>
<th data-quarto-table-cell-role="th">lot_bldsize</th>
<th data-quarto-table-cell-role="th">high_market_value_indicator</th>
<th data-quarto-table-cell-role="th">lot_building_interaction</th>
<th data-quarto-table-cell-role="th">market_assessed_value_interaction</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>-0.090145</td>
<td>-0.127342</td>
<td>-0.133756</td>
<td>0.110096</td>
<td>-0.091946</td>
<td>-0.137407</td>
<td>0.368018</td>
<td>-0.043675</td>
<td>-0.104214</td>
<td>-0.079731</td>
<td>...</td>
<td>-0.179724</td>
<td>0.061624</td>
<td>-0.133347</td>
<td>-0.157886</td>
<td>0.263333</td>
<td>0.09067</td>
<td>-0.059646</td>
<td>1.998831</td>
<td>0.001134</td>
<td>-0.004945</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>-0.077345</td>
<td>-0.130520</td>
<td>-0.160673</td>
<td>0.209141</td>
<td>-0.082181</td>
<td>-0.144458</td>
<td>0.580589</td>
<td>-0.024786</td>
<td>-0.111822</td>
<td>-0.061050</td>
<td>...</td>
<td>-0.182296</td>
<td>0.184280</td>
<td>-0.120504</td>
<td>-0.160818</td>
<td>0.263333</td>
<td>0.09067</td>
<td>-0.059646</td>
<td>1.998831</td>
<td>0.001134</td>
<td>-0.002055</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>-0.041637</td>
<td>-0.129765</td>
<td>-0.188695</td>
<td>0.226007</td>
<td>-0.080518</td>
<td>-0.145247</td>
<td>1.173586</td>
<td>0.027909</td>
<td>-0.119723</td>
<td>-0.008939</td>
<td>...</td>
<td>-0.182584</td>
<td>0.526444</td>
<td>-0.084678</td>
<td>-0.163863</td>
<td>0.212785</td>
<td>0.09067</td>
<td>-0.059646</td>
<td>1.998831</td>
<td>0.001134</td>
<td>0.011570</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>-0.107459</td>
<td>-0.097456</td>
<td>0.115909</td>
<td>-0.055310</td>
<td>-0.103429</td>
<td>-0.071250</td>
<td>0.013019</td>
<td>-0.075221</td>
<td>-0.032759</td>
<td>-0.104999</td>
<td>...</td>
<td>-0.155594</td>
<td>-0.143213</td>
<td>-0.154794</td>
<td>-0.130347</td>
<td>0.263334</td>
<td>0.09067</td>
<td>-0.059646</td>
<td>1.998831</td>
<td>0.001134</td>
<td>-0.007425</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>-0.102001</td>
<td>-0.120103</td>
<td>-0.072713</td>
<td>0.018352</td>
<td>-0.100991</td>
<td>-0.121359</td>
<td>0.171113</td>
<td>-0.061173</td>
<td>-0.086892</td>
<td>-0.097034</td>
<td>...</td>
<td>-0.173871</td>
<td>-0.051991</td>
<td>-0.145243</td>
<td>-0.151210</td>
<td>0.263334</td>
<td>0.09067</td>
<td>-0.059646</td>
<td>1.998831</td>
<td>0.001134</td>
<td>-0.006683</td>
</tr>
</tbody>
</table>

<p>5 rows × 33 columns</p>
</div>
</div>
</div>
</div>
<div id="8e1d2873" class="cell" data-execution_count="124">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>scores.set_index(<span class="st">'RECORD'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>scores.drop(columns<span class="op">=</span>[<span class="st">'score1'</span>,<span class="st">'score2'</span>],inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>scores.head(<span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="124">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">score1 rank</th>
<th data-quarto-table-cell-role="th">score2 rank</th>
<th data-quarto-table-cell-role="th">final</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>678868.0</td>
<td>808100.0</td>
<td>743484.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>765499.0</td>
<td>856994.0</td>
<td>811246.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>875948.0</td>
<td>963320.0</td>
<td>919634.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>850129.0</td>
<td>870794.0</td>
<td>860461.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>759084.0</td>
<td>813206.0</td>
<td>786145.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>768573.0</td>
<td>815829.0</td>
<td>792201.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>850134.0</td>
<td>937470.0</td>
<td>893802.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>844765.0</td>
<td>931056.0</td>
<td>887910.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>844764.0</td>
<td>931058.0</td>
<td>887911.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18</td>
<td>844769.0</td>
<td>931061.0</td>
<td>887915.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>844770.0</td>
<td>931062.0</td>
<td>887916.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20</td>
<td>844767.0</td>
<td>931060.0</td>
<td>887913.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21</td>
<td>844768.0</td>
<td>931057.0</td>
<td>887912.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">22</td>
<td>844766.0</td>
<td>931059.0</td>
<td>887912.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">23</td>
<td>844681.0</td>
<td>930980.0</td>
<td>887830.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24</td>
<td>841943.0</td>
<td>928028.0</td>
<td>884985.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25</td>
<td>841942.0</td>
<td>928027.0</td>
<td>884984.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26</td>
<td>848537.0</td>
<td>935575.0</td>
<td>892056.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">27</td>
<td>848535.0</td>
<td>935573.0</td>
<td>892054.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">28</td>
<td>848534.0</td>
<td>935572.0</td>
<td>892053.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">29</td>
<td>848536.0</td>
<td>935574.0</td>
<td>892055.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30</td>
<td>848072.0</td>
<td>935039.0</td>
<td>891555.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31</td>
<td>719090.0</td>
<td>828360.0</td>
<td>773725.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">32</td>
<td>719092.0</td>
<td>828358.0</td>
<td>773725.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">33</td>
<td>719096.0</td>
<td>828366.0</td>
<td>773731.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">34</td>
<td>719087.0</td>
<td>828357.0</td>
<td>773722.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35</td>
<td>719089.0</td>
<td>828359.0</td>
<td>773724.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">36</td>
<td>719095.0</td>
<td>828365.0</td>
<td>773730.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">37</td>
<td>719091.0</td>
<td>828363.0</td>
<td>773727.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">38</td>
<td>719094.0</td>
<td>828364.0</td>
<td>773729.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="302819ac" class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>scores.tail(<span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="125">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">score1 rank</th>
<th data-quarto-table-cell-role="th">score2 rank</th>
<th data-quarto-table-cell-role="th">final</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1070965</td>
<td>522201.0</td>
<td>502692.0</td>
<td>512446.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1070966</td>
<td>836834.0</td>
<td>898565.0</td>
<td>867699.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1070967</td>
<td>824253.0</td>
<td>848050.0</td>
<td>836151.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1070968</td>
<td>891054.0</td>
<td>980773.0</td>
<td>935913.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1070969</td>
<td>830636.0</td>
<td>862357.0</td>
<td>846496.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1070970</td>
<td>743884.0</td>
<td>767988.0</td>
<td>755936.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1070971</td>
<td>820033.0</td>
<td>838925.0</td>
<td>829479.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1070972</td>
<td>736017.0</td>
<td>764968.0</td>
<td>750492.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1070973</td>
<td>761012.0</td>
<td>777574.0</td>
<td>769293.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1070974</td>
<td>757279.0</td>
<td>776538.0</td>
<td>766908.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1070975</td>
<td>559461.0</td>
<td>576011.0</td>
<td>567736.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1070976</td>
<td>791591.0</td>
<td>801969.0</td>
<td>796780.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1070977</td>
<td>739251.0</td>
<td>769153.0</td>
<td>754202.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1070978</td>
<td>579983.0</td>
<td>558380.0</td>
<td>569181.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1070979</td>
<td>432258.0</td>
<td>447401.0</td>
<td>439829.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1070980</td>
<td>1037809.0</td>
<td>1041573.0</td>
<td>1039691.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1070981</td>
<td>594367.0</td>
<td>592528.0</td>
<td>593447.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1070982</td>
<td>623164.0</td>
<td>646634.0</td>
<td>634899.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1070983</td>
<td>693762.0</td>
<td>722095.0</td>
<td>707928.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1070984</td>
<td>806874.0</td>
<td>818237.0</td>
<td>812555.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1070985</td>
<td>657713.0</td>
<td>695697.0</td>
<td>676705.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1070986</td>
<td>726138.0</td>
<td>755905.0</td>
<td>741021.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1070987</td>
<td>391803.0</td>
<td>435637.0</td>
<td>413720.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1070988</td>
<td>220064.0</td>
<td>216836.0</td>
<td>218450.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1070989</td>
<td>864500.0</td>
<td>934193.0</td>
<td>899346.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1070990</td>
<td>633654.0</td>
<td>663809.0</td>
<td>648731.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1070991</td>
<td>906686.0</td>
<td>991818.0</td>
<td>949252.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1070992</td>
<td>861146.0</td>
<td>938972.0</td>
<td>900059.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1070993</td>
<td>658402.0</td>
<td>684300.0</td>
<td>671351.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1070994</td>
<td>310196.0</td>
<td>257939.0</td>
<td>284067.5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="83069fbb" class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>NY_data_with_scores <span class="op">=</span> NY_data_orig.join(scores, on<span class="op">=</span><span class="st">'RECORD'</span>)</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>NY_data_with_scores[<span class="st">'final'</span>].fillna(<span class="dv">1</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>NY_data_with_scores</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="126">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th">BBLE</th>
<th data-quarto-table-cell-role="th">BORO</th>
<th data-quarto-table-cell-role="th">BLOCK</th>
<th data-quarto-table-cell-role="th">LOT</th>
<th data-quarto-table-cell-role="th">EASEMENT</th>
<th data-quarto-table-cell-role="th">OWNER</th>
<th data-quarto-table-cell-role="th">BLDGCL</th>
<th data-quarto-table-cell-role="th">TAXCLASS</th>
<th data-quarto-table-cell-role="th">LTFRONT</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">AVTOT2</th>
<th data-quarto-table-cell-role="th">EXLAND2</th>
<th data-quarto-table-cell-role="th">EXTOT2</th>
<th data-quarto-table-cell-role="th">EXCD2</th>
<th data-quarto-table-cell-role="th">PERIOD</th>
<th data-quarto-table-cell-role="th">YEAR</th>
<th data-quarto-table-cell-role="th">VALTYPE</th>
<th data-quarto-table-cell-role="th">score1 rank</th>
<th data-quarto-table-cell-role="th">score2 rank</th>
<th data-quarto-table-cell-role="th">final</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>1000010101</td>
<td>1</td>
<td>1</td>
<td>101</td>
<td>NaN</td>
<td>U S GOVT LAND &amp; BLDGS</td>
<td>P7</td>
<td>4</td>
<td>500</td>
<td>...</td>
<td>8613000.0</td>
<td>3775500.0</td>
<td>8613000.0</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>1000010201</td>
<td>1</td>
<td>1</td>
<td>201</td>
<td>NaN</td>
<td>U S GOVT LAND &amp; BLDGS</td>
<td>Z9</td>
<td>4</td>
<td>27</td>
<td>...</td>
<td>80690400.0</td>
<td>11111400.0</td>
<td>80690400.0</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>1000020001</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>NaN</td>
<td>DEPT OF GENERAL SERVI</td>
<td>Y7</td>
<td>4</td>
<td>709</td>
<td>...</td>
<td>40179510.0</td>
<td>32321790.0</td>
<td>40179510.0</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>1000020023</td>
<td>1</td>
<td>2</td>
<td>23</td>
<td>NaN</td>
<td>DEPARTMENT OF BUSINES</td>
<td>T2</td>
<td>4</td>
<td>793</td>
<td>...</td>
<td>15750000.0</td>
<td>13644000.0</td>
<td>15750000.0</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>1000030001</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>NaN</td>
<td>PARKS AND RECREATION</td>
<td>Q1</td>
<td>4</td>
<td>323</td>
<td>...</td>
<td>107758350.0</td>
<td>106348680.0</td>
<td>107758350.0</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
<td>NaN</td>
<td>NaN</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1070989</td>
<td>1070990</td>
<td>5080500083</td>
<td>5</td>
<td>8050</td>
<td>83</td>
<td>NaN</td>
<td>TOBIN, GALE</td>
<td>A1</td>
<td>1</td>
<td>60</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
<td>633654.0</td>
<td>663809.0</td>
<td>648731.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1070990</td>
<td>1070991</td>
<td>5080500086</td>
<td>5</td>
<td>8050</td>
<td>86</td>
<td>NaN</td>
<td>SHERRI MILINAZZO</td>
<td>A1</td>
<td>1</td>
<td>62</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
<td>906686.0</td>
<td>991818.0</td>
<td>949252.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1070991</td>
<td>1070992</td>
<td>5080500089</td>
<td>5</td>
<td>8050</td>
<td>89</td>
<td>NaN</td>
<td>JOHN GERVASI</td>
<td>A1</td>
<td>1</td>
<td>53</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1017.0</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
<td>861146.0</td>
<td>938972.0</td>
<td>900059.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1070992</td>
<td>1070993</td>
<td>5080500092</td>
<td>5</td>
<td>8050</td>
<td>92</td>
<td>NaN</td>
<td>RITA M MOOG</td>
<td>A1</td>
<td>1</td>
<td>52</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
<td>658402.0</td>
<td>684300.0</td>
<td>671351.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1070993</td>
<td>1070994</td>
<td>5080500094</td>
<td>5</td>
<td>8050</td>
<td>94</td>
<td>NaN</td>
<td>EDWARD DONOHUE</td>
<td>A1</td>
<td>1</td>
<td>50</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>FINAL</td>
<td>2010/11</td>
<td>AC-TR</td>
<td>310196.0</td>
<td>257939.0</td>
<td>284067.5</td>
</tr>
</tbody>
</table>

<p>1070994 rows × 35 columns</p>
</div>
</div>
</div>
</div>
<div id="82447ad5" class="cell" data-execution_count="127">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>NY_data_scored_and_sorted <span class="op">=</span> NY_data_with_scores.sort_values(by<span class="op">=</span>[<span class="st">'final'</span>,<span class="st">'RECORD'</span>], ascending <span class="op">=</span> [<span class="va">False</span>,<span class="va">True</span>])</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>NY_data_scored_zs <span class="op">=</span> NY_data_with_scores.join(data_zs, on<span class="op">=</span><span class="st">'RECORD'</span>)</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>NY_data_scored_zs.set_index(<span class="st">'RECORD'</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>NY_data_scored_zs.head(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="127">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">BBLE</th>
<th data-quarto-table-cell-role="th">BORO</th>
<th data-quarto-table-cell-role="th">BLOCK</th>
<th data-quarto-table-cell-role="th">LOT</th>
<th data-quarto-table-cell-role="th">EASEMENT</th>
<th data-quarto-table-cell-role="th">OWNER</th>
<th data-quarto-table-cell-role="th">BLDGCL</th>
<th data-quarto-table-cell-role="th">TAXCLASS</th>
<th data-quarto-table-cell-role="th">LTFRONT</th>
<th data-quarto-table-cell-role="th">LTDEPTH</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">r6_taxclass</th>
<th data-quarto-table-cell-role="th">r7_taxclass</th>
<th data-quarto-table-cell-role="th">r8_taxclass</th>
<th data-quarto-table-cell-role="th">r9_taxclass</th>
<th data-quarto-table-cell-role="th">value_ratio</th>
<th data-quarto-table-cell-role="th">size_ratio</th>
<th data-quarto-table-cell-role="th">lot_bldsize</th>
<th data-quarto-table-cell-role="th">high_market_value_indicator</th>
<th data-quarto-table-cell-role="th">lot_building_interaction</th>
<th data-quarto-table-cell-role="th">market_assessed_value_interaction</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1000010101</td>
<td>1</td>
<td>1</td>
<td>101</td>
<td>NaN</td>
<td>U S GOVT LAND &amp; BLDGS</td>
<td>P7</td>
<td>4</td>
<td>500</td>
<td>1046</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>1000010201</td>
<td>1</td>
<td>1</td>
<td>201</td>
<td>NaN</td>
<td>U S GOVT LAND &amp; BLDGS</td>
<td>Z9</td>
<td>4</td>
<td>27</td>
<td>0</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>1000020001</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>NaN</td>
<td>DEPT OF GENERAL SERVI</td>
<td>Y7</td>
<td>4</td>
<td>709</td>
<td>564</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>1000020023</td>
<td>1</td>
<td>2</td>
<td>23</td>
<td>NaN</td>
<td>DEPARTMENT OF BUSINES</td>
<td>T2</td>
<td>4</td>
<td>793</td>
<td>551</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>1000030001</td>
<td>1</td>
<td>3</td>
<td>1</td>
<td>NaN</td>
<td>PARKS AND RECREATION</td>
<td>Q1</td>
<td>4</td>
<td>323</td>
<td>1260</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>1000030002</td>
<td>1</td>
<td>3</td>
<td>2</td>
<td>NaN</td>
<td>PARKS AND RECREATION</td>
<td>Q1</td>
<td>4</td>
<td>496</td>
<td>76</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>1000030003</td>
<td>1</td>
<td>3</td>
<td>3</td>
<td>NaN</td>
<td>PARKS AND RECREATION</td>
<td>Q1</td>
<td>4</td>
<td>180</td>
<td>370</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>1000030010</td>
<td>1</td>
<td>3</td>
<td>10</td>
<td>NaN</td>
<td>DEPT RE-CITY OF NY</td>
<td>Z9</td>
<td>4</td>
<td>362</td>
<td>177</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>1000041001</td>
<td>1</td>
<td>4</td>
<td>1001</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>-0.179724</td>
<td>0.061624</td>
<td>-0.133347</td>
<td>-0.157886</td>
<td>0.263333</td>
<td>0.09067</td>
<td>-0.059646</td>
<td>1.998831</td>
<td>0.001134</td>
<td>-0.004945</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>1000041002</td>
<td>1</td>
<td>4</td>
<td>1002</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>-0.182296</td>
<td>0.184280</td>
<td>-0.120504</td>
<td>-0.160818</td>
<td>0.263333</td>
<td>0.09067</td>
<td>-0.059646</td>
<td>1.998831</td>
<td>0.001134</td>
<td>-0.002055</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>1000041003</td>
<td>1</td>
<td>4</td>
<td>1003</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>-0.182584</td>
<td>0.526444</td>
<td>-0.084678</td>
<td>-0.163863</td>
<td>0.212785</td>
<td>0.09067</td>
<td>-0.059646</td>
<td>1.998831</td>
<td>0.001134</td>
<td>0.011570</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>1000041004</td>
<td>1</td>
<td>4</td>
<td>1004</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>-0.155594</td>
<td>-0.143213</td>
<td>-0.154794</td>
<td>-0.130347</td>
<td>0.263334</td>
<td>0.09067</td>
<td>-0.059646</td>
<td>1.998831</td>
<td>0.001134</td>
<td>-0.007425</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>1000041005</td>
<td>1</td>
<td>4</td>
<td>1005</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>-0.173871</td>
<td>-0.051991</td>
<td>-0.145243</td>
<td>-0.151210</td>
<td>0.263334</td>
<td>0.09067</td>
<td>-0.059646</td>
<td>1.998831</td>
<td>0.001134</td>
<td>-0.006683</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>1000041006</td>
<td>1</td>
<td>4</td>
<td>1006</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>-0.173052</td>
<td>-0.060826</td>
<td>-0.146168</td>
<td>-0.150276</td>
<td>0.263333</td>
<td>0.09067</td>
<td>-0.059646</td>
<td>1.998831</td>
<td>0.001134</td>
<td>-0.006781</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>1000041007</td>
<td>1</td>
<td>4</td>
<td>1007</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>-0.183813</td>
<td>0.326043</td>
<td>-0.105661</td>
<td>-0.162547</td>
<td>0.263333</td>
<td>0.09067</td>
<td>-0.059646</td>
<td>1.998831</td>
<td>0.001134</td>
<td>0.002596</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>1000041008</td>
<td>1</td>
<td>4</td>
<td>1008</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>-0.183696</td>
<td>0.311661</td>
<td>-0.107167</td>
<td>-0.162414</td>
<td>0.263333</td>
<td>0.09067</td>
<td>-0.059646</td>
<td>1.998831</td>
<td>0.001134</td>
<td>0.002060</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>1000041009</td>
<td>1</td>
<td>4</td>
<td>1009</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>-0.183696</td>
<td>0.311661</td>
<td>-0.107167</td>
<td>-0.162414</td>
<td>0.263333</td>
<td>0.09067</td>
<td>-0.059646</td>
<td>1.998831</td>
<td>0.001134</td>
<td>0.002060</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18</td>
<td>1000041010</td>
<td>1</td>
<td>4</td>
<td>1010</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>-0.183696</td>
<td>0.311661</td>
<td>-0.107167</td>
<td>-0.162414</td>
<td>0.263333</td>
<td>0.09067</td>
<td>-0.059646</td>
<td>1.998831</td>
<td>0.001134</td>
<td>0.002060</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>1000041011</td>
<td>1</td>
<td>4</td>
<td>1011</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>-0.183696</td>
<td>0.311661</td>
<td>-0.107167</td>
<td>-0.162414</td>
<td>0.263333</td>
<td>0.09067</td>
<td>-0.059646</td>
<td>1.998831</td>
<td>0.001134</td>
<td>0.002060</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20</td>
<td>1000041012</td>
<td>1</td>
<td>4</td>
<td>1012</td>
<td>NaN</td>
<td>TRZ HOLDINGS, LLC</td>
<td>R5</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>-0.183696</td>
<td>0.311661</td>
<td>-0.107167</td>
<td>-0.162414</td>
<td>0.263333</td>
<td>0.09067</td>
<td>-0.059646</td>
<td>1.998831</td>
<td>0.001134</td>
<td>0.002060</td>
</tr>
</tbody>
</table>

<p>20 rows × 67 columns</p>
</div>
</div>
</div>
</div>
<div id="800c52e8" class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>NY_data_scored_zs_sorted <span class="op">=</span> NY_data_scored_zs.sort_values(by<span class="op">=</span>[<span class="st">'final'</span>,<span class="st">'RECORD'</span>], ascending <span class="op">=</span> [<span class="va">False</span>,<span class="va">True</span>])</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>NY_data_top_n <span class="op">=</span> NY_data_scored_zs_sorted.head(ntop)</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>NY_data_top_n</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="128">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">BBLE</th>
<th data-quarto-table-cell-role="th">BORO</th>
<th data-quarto-table-cell-role="th">BLOCK</th>
<th data-quarto-table-cell-role="th">LOT</th>
<th data-quarto-table-cell-role="th">EASEMENT</th>
<th data-quarto-table-cell-role="th">OWNER</th>
<th data-quarto-table-cell-role="th">BLDGCL</th>
<th data-quarto-table-cell-role="th">TAXCLASS</th>
<th data-quarto-table-cell-role="th">LTFRONT</th>
<th data-quarto-table-cell-role="th">LTDEPTH</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">r6_taxclass</th>
<th data-quarto-table-cell-role="th">r7_taxclass</th>
<th data-quarto-table-cell-role="th">r8_taxclass</th>
<th data-quarto-table-cell-role="th">r9_taxclass</th>
<th data-quarto-table-cell-role="th">value_ratio</th>
<th data-quarto-table-cell-role="th">size_ratio</th>
<th data-quarto-table-cell-role="th">lot_bldsize</th>
<th data-quarto-table-cell-role="th">high_market_value_indicator</th>
<th data-quarto-table-cell-role="th">lot_building_interaction</th>
<th data-quarto-table-cell-role="th">market_assessed_value_interaction</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">956520</td>
<td>5006590012</td>
<td>5</td>
<td>659</td>
<td>12</td>
<td>NaN</td>
<td>TROMPETA RIZALINA</td>
<td>A1</td>
<td>1</td>
<td>25</td>
<td>91</td>
<td>...</td>
<td>670.807012</td>
<td>-0.075673</td>
<td>614.704237</td>
<td>709.558482</td>
<td>-0.102717</td>
<td>316.656659</td>
<td>-0.068627</td>
<td>1.998831</td>
<td>1.575971</td>
<td>-0.007597</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">658933</td>
<td>4029060054</td>
<td>4</td>
<td>2906</td>
<td>54</td>
<td>NaN</td>
<td>WAN CHIU CHEUNG</td>
<td>C0</td>
<td>1</td>
<td>25</td>
<td>100</td>
<td>...</td>
<td>636.374724</td>
<td>0.066416</td>
<td>509.715716</td>
<td>607.332283</td>
<td>-0.110012</td>
<td>443.540911</td>
<td>-0.068628</td>
<td>1.998831</td>
<td>2.671111</td>
<td>-0.007586</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">917942</td>
<td>4142600001</td>
<td>4</td>
<td>14260</td>
<td>1</td>
<td>NaN</td>
<td>LOGAN PROPERTY, INC.</td>
<td>T1</td>
<td>4</td>
<td>4910</td>
<td>0</td>
<td>...</td>
<td>15.300514</td>
<td>9.478741</td>
<td>208.261239</td>
<td>40.667816</td>
<td>12.040692</td>
<td>-0.051220</td>
<td>1.776500</td>
<td>-0.500292</td>
<td>0.244888</td>
<td>662.000028</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">649717</td>
<td>4025270002</td>
<td>4</td>
<td>2527</td>
<td>2</td>
<td>NaN</td>
<td>57-43 LLC</td>
<td>V1</td>
<td>4</td>
<td>51</td>
<td>940</td>
<td>...</td>
<td>2.396351</td>
<td>88.289486</td>
<td>12.295657</td>
<td>6.686020</td>
<td>0.478378</td>
<td>-0.050460</td>
<td>0.812136</td>
<td>-0.500292</td>
<td>-0.004937</td>
<td>-0.007600</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">982930</td>
<td>5020900016</td>
<td>5</td>
<td>2090</td>
<td>16</td>
<td>NaN</td>
<td>FOREST VIEW HOMEOWNER</td>
<td>Z0</td>
<td>1</td>
<td>371</td>
<td>211</td>
<td>...</td>
<td>11.027945</td>
<td>445.303652</td>
<td>18.567554</td>
<td>18.446932</td>
<td>-0.085063</td>
<td>-0.051105</td>
<td>1.514320</td>
<td>-0.500292</td>
<td>-0.003375</td>
<td>-0.007600</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">161344</td>
<td>2028830060F</td>
<td>2</td>
<td>2883</td>
<td>60</td>
<td>F</td>
<td>NaN</td>
<td>V1</td>
<td>4</td>
<td>308</td>
<td>414</td>
<td>...</td>
<td>-0.175918</td>
<td>0.119849</td>
<td>-0.108352</td>
<td>-0.128775</td>
<td>0.471817</td>
<td>-0.045016</td>
<td>0.117096</td>
<td>-0.500292</td>
<td>0.100182</td>
<td>-0.007599</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">51125</td>
<td>1009130040</td>
<td>1</td>
<td>913</td>
<td>40</td>
<td>NaN</td>
<td>RICHARD A CIRILLO</td>
<td>B9</td>
<td>1</td>
<td>25</td>
<td>98</td>
<td>...</td>
<td>0.931872</td>
<td>2.670813</td>
<td>1.486738</td>
<td>0.706372</td>
<td>-0.113786</td>
<td>-0.013116</td>
<td>-0.035622</td>
<td>-0.500292</td>
<td>-0.007942</td>
<td>-0.005410</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">929750</td>
<td>4161220056</td>
<td>4</td>
<td>16122</td>
<td>56</td>
<td>NaN</td>
<td>GRADY, DIANA L</td>
<td>C2</td>
<td>2A</td>
<td>40</td>
<td>97</td>
<td>...</td>
<td>-0.139221</td>
<td>0.433725</td>
<td>0.341563</td>
<td>0.139585</td>
<td>0.455862</td>
<td>-0.037621</td>
<td>0.020984</td>
<td>-0.500292</td>
<td>-0.007959</td>
<td>-0.007600</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">58145</td>
<td>1010114004</td>
<td>1</td>
<td>1011</td>
<td>4004</td>
<td>NaN</td>
<td>CENTRAL PARK REALTY H</td>
<td>R4</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>1.577151</td>
<td>0.393144</td>
<td>1.562417</td>
<td>4.051715</td>
<td>0.314487</td>
<td>0.065690</td>
<td>-0.057737</td>
<td>1.998831</td>
<td>0.013932</td>
<td>-0.007600</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">944706</td>
<td>5002580005</td>
<td>5</td>
<td>258</td>
<td>5</td>
<td>NaN</td>
<td>NaN</td>
<td>V0</td>
<td>1B</td>
<td>47</td>
<td>840</td>
<td>...</td>
<td>-0.093423</td>
<td>1.306094</td>
<td>-0.081544</td>
<td>-0.072015</td>
<td>7.276806</td>
<td>-0.044005</td>
<td>0.093359</td>
<td>-0.500292</td>
<td>0.003742</td>
<td>-0.007599</td>
</tr>
</tbody>
</table>

<p>10000 rows × 67 columns</p>
</div>
</div>
</div>
</div>
<div id="9de82bbd" class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>NY_data_top_n[<span class="st">'OWNER'</span>].head(<span class="dv">40</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="129">
<pre><code>RECORD
956520         TROMPETA RIZALINA
658933           WAN CHIU CHEUNG
917942      LOGAN PROPERTY, INC.
649717                 57-43 LLC
982930     FOREST VIEW HOMEOWNER
459429                       NaN
980276     WOODMONT WEST HOA INC
996722     IMPERIAL COURT HOMEOW
333412            SPOONER ALSTON
241946       RUFFALO ENTERPRISES
111420     BOXWOOD FLTD PARNTERS
1053859                      NaN
979038           CITY WEST H.O.A
1048771     HUGUENOT VILLAGE H O
1048475    PARK VILLAGE RESIDENT
223485             ASSET HLDG CP
696562                       NaN
1045012           LINDA VITALONE
7033                         NaN
7034              HSIA, JONATHAN
7035                NOVARO, HUGO
7036             LECH, JOHN PAUL
7037                 HANLON, AMY
7038               OWEN, MICHAEL
7039              LAMBERT, PETER
7040            BILINKAS, EDWARD
7041                         NaN
7042           SWENDSRUD, MONICA
7043                CHOI, JOSEPH
844895                XEDIT CORP
146231              NY NH &amp; H RR
373564               J BRENOWITZ
524297             MARTIN OLINER
871048       VALERIE SHAKESPEARE
114694                       NaN
539374         CONS LAND INV INC
435070               KLEIN HARRY
718883           GARDEN VIEW LTD
877038              DASH MARLENE
1000954    MATIONAL COLLECTORS &amp;
Name: OWNER, dtype: object</code></pre>
</div>
</div>
<div id="d53867b7" class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># you can look at this list and add some to the exclusions if you want</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">14</span>))</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>NY_data_top_n[<span class="st">'OWNER'</span>].value_counts().head(<span class="dv">50</span>).sort_values().plot(kind<span class="op">=</span><span class="st">'barh'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NY_OG_files/figure-html/cell-131-output-1.png" width="674" height="1076" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="d7722a51" class="cell" data-execution_count="131">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>NY_data_top_n.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="131">
<pre><code>(10000, 67)</code></pre>
</div>
</div>
<div id="a5074606" class="cell" data-execution_count="132">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>NY_top_lotsize_ne_0 <span class="op">=</span> NY_data_top_n[NY_data_top_n[<span class="st">'LTFRONT'</span>] <span class="op">!=</span> <span class="dv">0</span>]</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>NY_top_sizes_ne_0 <span class="op">=</span> NY_top_lotsize_ne_0[NY_top_lotsize_ne_0[<span class="st">'BLDDEPTH'</span>] <span class="op">!=</span> <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e1cd47fb" class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>nfields <span class="op">=</span> <span class="dv">34</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>data_base_vars <span class="op">=</span> NY_data_top_n.iloc[:,nfields:nfields<span class="op">+</span><span class="dv">9</span>]</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>data_base_vars.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="133">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">r1</th>
<th data-quarto-table-cell-role="th">r2</th>
<th data-quarto-table-cell-role="th">r3</th>
<th data-quarto-table-cell-role="th">r4</th>
<th data-quarto-table-cell-role="th">r5</th>
<th data-quarto-table-cell-role="th">r6</th>
<th data-quarto-table-cell-role="th">r7</th>
<th data-quarto-table-cell-role="th">r8</th>
<th data-quarto-table-cell-role="th">r9</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">956520</td>
<td>-0.109693</td>
<td>31.053329</td>
<td>12.586493</td>
<td>-0.092675</td>
<td>35.717026</td>
<td>15.129681</td>
<td>-0.089171</td>
<td>51.484331</td>
<td>28.990580</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">658933</td>
<td>-0.100307</td>
<td>25.979800</td>
<td>10.859515</td>
<td>-0.081413</td>
<td>33.529659</td>
<td>14.345071</td>
<td>-0.068305</td>
<td>42.678673</td>
<td>24.796319</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">917942</td>
<td>-0.082428</td>
<td>0.627763</td>
<td>-0.031184</td>
<td>8.275884</td>
<td>169.725243</td>
<td>42.304772</td>
<td>16.688598</td>
<td>306.471822</td>
<td>105.826575</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">649717</td>
<td>89.063881</td>
<td>36.576029</td>
<td>16.284157</td>
<td>90.587261</td>
<td>8.849828</td>
<td>6.925421</td>
<td>153.273624</td>
<td>18.237425</td>
<td>17.653725</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">982930</td>
<td>15.633665</td>
<td>0.239314</td>
<td>-0.085664</td>
<td>28.627389</td>
<td>0.594399</td>
<td>0.095272</td>
<td>65.313551</td>
<td>1.484807</td>
<td>0.634812</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="efc812ad" class="cell" data-execution_count="134">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The heatmaps are good for seeing which variables are driving the high scores</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>data_heatmap <span class="op">=</span> data_base_vars.<span class="bu">abs</span>().head(<span class="dv">23</span>)</span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">20</span>,<span class="dv">10</span>)</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.heatmap(data_heatmap, center<span class="op">=</span><span class="dv">0</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">50</span>, cmap<span class="op">=</span><span class="st">'Reds'</span>)</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>ax.xaxis.tick_top()</span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_label_position(<span class="st">'top'</span>)</span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="134">
<pre><code>(array([0.5, 1.5, 2.5, 3.5, 4.5, 5.5, 6.5, 7.5, 8.5]),
 [Text(0.5, 1, 'r1'),
  Text(1.5, 1, 'r2'),
  Text(2.5, 1, 'r3'),
  Text(3.5, 1, 'r4'),
  Text(4.5, 1, 'r5'),
  Text(5.5, 1, 'r6'),
  Text(6.5, 1, 'r7'),
  Text(7.5, 1, 'r8'),
  Text(8.5, 1, 'r9')])</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NY_OG_files/figure-html/cell-135-output-2.png" width="1434" height="790" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="c49772cb" class="cell" data-execution_count="135">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>data_all_vars <span class="op">=</span> NY_data_top_n.iloc[:,nfields:]</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>data_all_vars.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="135">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">r1</th>
<th data-quarto-table-cell-role="th">r2</th>
<th data-quarto-table-cell-role="th">r3</th>
<th data-quarto-table-cell-role="th">r4</th>
<th data-quarto-table-cell-role="th">r5</th>
<th data-quarto-table-cell-role="th">r6</th>
<th data-quarto-table-cell-role="th">r7</th>
<th data-quarto-table-cell-role="th">r8</th>
<th data-quarto-table-cell-role="th">r9</th>
<th data-quarto-table-cell-role="th">r1_zip5</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">r6_taxclass</th>
<th data-quarto-table-cell-role="th">r7_taxclass</th>
<th data-quarto-table-cell-role="th">r8_taxclass</th>
<th data-quarto-table-cell-role="th">r9_taxclass</th>
<th data-quarto-table-cell-role="th">value_ratio</th>
<th data-quarto-table-cell-role="th">size_ratio</th>
<th data-quarto-table-cell-role="th">lot_bldsize</th>
<th data-quarto-table-cell-role="th">high_market_value_indicator</th>
<th data-quarto-table-cell-role="th">lot_building_interaction</th>
<th data-quarto-table-cell-role="th">market_assessed_value_interaction</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">RECORD</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">956520</td>
<td>-0.109693</td>
<td>31.053329</td>
<td>12.586493</td>
<td>-0.092675</td>
<td>35.717026</td>
<td>15.129681</td>
<td>-0.089171</td>
<td>51.484331</td>
<td>28.990580</td>
<td>-0.120225</td>
<td>...</td>
<td>670.807012</td>
<td>-0.075673</td>
<td>614.704237</td>
<td>709.558482</td>
<td>-0.102717</td>
<td>316.656659</td>
<td>-0.068627</td>
<td>1.998831</td>
<td>1.575971</td>
<td>-0.007597</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">658933</td>
<td>-0.100307</td>
<td>25.979800</td>
<td>10.859515</td>
<td>-0.081413</td>
<td>33.529659</td>
<td>14.345071</td>
<td>-0.068305</td>
<td>42.678673</td>
<td>24.796319</td>
<td>-0.110202</td>
<td>...</td>
<td>636.374724</td>
<td>0.066416</td>
<td>509.715716</td>
<td>607.332283</td>
<td>-0.110012</td>
<td>443.540911</td>
<td>-0.068628</td>
<td>1.998831</td>
<td>2.671111</td>
<td>-0.007586</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">917942</td>
<td>-0.082428</td>
<td>0.627763</td>
<td>-0.031184</td>
<td>8.275884</td>
<td>169.725243</td>
<td>42.304772</td>
<td>16.688598</td>
<td>306.471822</td>
<td>105.826575</td>
<td>0.084077</td>
<td>...</td>
<td>15.300514</td>
<td>9.478741</td>
<td>208.261239</td>
<td>40.667816</td>
<td>12.040692</td>
<td>-0.051220</td>
<td>1.776500</td>
<td>-0.500292</td>
<td>0.244888</td>
<td>662.000028</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">649717</td>
<td>89.063881</td>
<td>36.576029</td>
<td>16.284157</td>
<td>90.587261</td>
<td>8.849828</td>
<td>6.925421</td>
<td>153.273624</td>
<td>18.237425</td>
<td>17.653725</td>
<td>277.932913</td>
<td>...</td>
<td>2.396351</td>
<td>88.289486</td>
<td>12.295657</td>
<td>6.686020</td>
<td>0.478378</td>
<td>-0.050460</td>
<td>0.812136</td>
<td>-0.500292</td>
<td>-0.004937</td>
<td>-0.007600</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">982930</td>
<td>15.633665</td>
<td>0.239314</td>
<td>-0.085664</td>
<td>28.627389</td>
<td>0.594399</td>
<td>0.095272</td>
<td>65.313551</td>
<td>1.484807</td>
<td>0.634812</td>
<td>9.801218</td>
<td>...</td>
<td>11.027945</td>
<td>445.303652</td>
<td>18.567554</td>
<td>18.446932</td>
<td>-0.085063</td>
<td>-0.051105</td>
<td>1.514320</td>
<td>-0.500292</td>
<td>-0.003375</td>
<td>-0.007600</td>
</tr>
</tbody>
</table>

<p>5 rows × 33 columns</p>
</div>
</div>
</div>
</div>
<div id="af299cd8" class="cell" data-execution_count="136">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>data_heatmap <span class="op">=</span> data_all_vars.<span class="bu">abs</span>().head(<span class="dv">30</span>)</span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">20</span>,<span class="dv">10</span>)</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.heatmap(data_heatmap, center<span class="op">=</span><span class="dv">0</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">50</span>, cmap<span class="op">=</span><span class="st">'Reds'</span>)</span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>ax.xaxis.tick_top()</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_label_position(<span class="st">'top'</span>)</span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="136">
<pre><code>(array([ 0.5,  1.5,  2.5,  3.5,  4.5,  5.5,  6.5,  7.5,  8.5,  9.5, 10.5,
        11.5, 12.5, 13.5, 14.5, 15.5, 16.5, 17.5, 18.5, 19.5, 20.5, 21.5,
        22.5, 23.5, 24.5, 25.5, 26.5, 27.5, 28.5, 29.5, 30.5, 31.5, 32.5]),
 [Text(0.5, 1, 'r1'),
  Text(1.5, 1, 'r2'),
  Text(2.5, 1, 'r3'),
  Text(3.5, 1, 'r4'),
  Text(4.5, 1, 'r5'),
  Text(5.5, 1, 'r6'),
  Text(6.5, 1, 'r7'),
  Text(7.5, 1, 'r8'),
  Text(8.5, 1, 'r9'),
  Text(9.5, 1, 'r1_zip5'),
  Text(10.5, 1, 'r2_zip5'),
  Text(11.5, 1, 'r3_zip5'),
  Text(12.5, 1, 'r4_zip5'),
  Text(13.5, 1, 'r5_zip5'),
  Text(14.5, 1, 'r6_zip5'),
  Text(15.5, 1, 'r7_zip5'),
  Text(16.5, 1, 'r8_zip5'),
  Text(17.5, 1, 'r9_zip5'),
  Text(18.5, 1, 'r1_taxclass'),
  Text(19.5, 1, 'r2_taxclass'),
  Text(20.5, 1, 'r3_taxclass'),
  Text(21.5, 1, 'r4_taxclass'),
  Text(22.5, 1, 'r5_taxclass'),
  Text(23.5, 1, 'r6_taxclass'),
  Text(24.5, 1, 'r7_taxclass'),
  Text(25.5, 1, 'r8_taxclass'),
  Text(26.5, 1, 'r9_taxclass'),
  Text(27.5, 1, 'value_ratio'),
  Text(28.5, 1, 'size_ratio'),
  Text(29.5, 1, 'lot_bldsize'),
  Text(30.5, 1, 'high_market_value_indicator'),
  Text(31.5, 1, 'lot_building_interaction'),
  Text(32.5, 1, 'market_assessed_value_interaction')])</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="NY_OG_files/figure-html/cell-137-output-2.png" width="1434" height="1012" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="8673a89a" class="cell" data-execution_count="137">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>top_records_df <span class="op">=</span> pd.DataFrame(top_records)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>