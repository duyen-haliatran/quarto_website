<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Duyen Tran">
<meta name="dcterms.date" content="2024-05-26">

<title>Website - Intuit Upgrade Notebook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Website</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resume.html"> 
<span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../visualization.html"> 
<span class="menu-text">Visualization</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-analysis" id="toc-data-analysis" class="nav-link active" data-scroll-target="#data-analysis">Data Analysis</a>
  <ul class="collapse">
  <li><a href="#data-description-intuit-quickbooks-upgrade" id="toc-data-description-intuit-quickbooks-upgrade" class="nav-link" data-scroll-target="#data-description-intuit-quickbooks-upgrade">Data Description: Intuit Quickbooks upgrade</a></li>
  <li><a href="#data-preprocessing" id="toc-data-preprocessing" class="nav-link" data-scroll-target="#data-preprocessing">Data Preprocessing</a></li>
  <li><a href="#correlation-between-features" id="toc-correlation-between-features" class="nav-link" data-scroll-target="#correlation-between-features">Correlation Between Features</a></li>
  </ul></li>
  <li><a href="#logistic-regression-model" id="toc-logistic-regression-model" class="nav-link" data-scroll-target="#logistic-regression-model">Logistic Regression Model</a>
  <ul class="collapse">
  <li><a href="#logistic-regression-model-1" id="toc-logistic-regression-model-1" class="nav-link" data-scroll-target="#logistic-regression-model-1"><strong>Logistic Regression Model 1</strong></a></li>
  <li><a href="#improve-the-model-by-adding-dummies-for-zip-00801-and-00804" id="toc-improve-the-model-by-adding-dummies-for-zip-00801-and-00804" class="nav-link" data-scroll-target="#improve-the-model-by-adding-dummies-for-zip-00801-and-00804">Improve the model by adding dummies for zip 00801 and 00804</a></li>
  <li><a href="#accuracy-of-logistic-regression-model" id="toc-accuracy-of-logistic-regression-model" class="nav-link" data-scroll-target="#accuracy-of-logistic-regression-model">Accuracy of Logistic Regression Model</a></li>
  </ul></li>
  <li><a href="#neural-network-model" id="toc-neural-network-model" class="nav-link" data-scroll-target="#neural-network-model">Neural Network Model</a>
  <ul class="collapse">
  <li><a href="#nn-with-1-node-and-1-hidden-layer-all-variables" id="toc-nn-with-1-node-and-1-hidden-layer-all-variables" class="nav-link" data-scroll-target="#nn-with-1-node-and-1-hidden-layer-all-variables"><strong>NN with 1 Node and 1 Hidden Layer (all variables)</strong></a></li>
  <li><a href="#nn-with-1-node-and-1-hidden-layer-significant-variables" id="toc-nn-with-1-node-and-1-hidden-layer-significant-variables" class="nav-link" data-scroll-target="#nn-with-1-node-and-1-hidden-layer-significant-variables"><strong>NN with 1 Node and 1 Hidden Layer (significant variables)</strong></a></li>
  <li><a href="#nn-with-hidden-layers-sizes-2" id="toc-nn-with-hidden-layers-sizes-2" class="nav-link" data-scroll-target="#nn-with-hidden-layers-sizes-2"><strong>NN with hidden layers sizes: (2, )</strong></a></li>
  <li><a href="#nn-with-1-hidden-layer-and-3-nodes" id="toc-nn-with-1-hidden-layer-and-3-nodes" class="nav-link" data-scroll-target="#nn-with-1-hidden-layer-and-3-nodes"><strong>NN with 1 hidden layer and 3 nodes</strong></a></li>
  <li><a href="#nn-with-2-nodes-and-10-hidden-layers" id="toc-nn-with-2-nodes-and-10-hidden-layers" class="nav-link" data-scroll-target="#nn-with-2-nodes-and-10-hidden-layers"><strong>NN with 2 nodes and 10 hidden layers</strong></a></li>
  <li><a href="#evaluating-neural-network-performance-from-gains-chart" id="toc-evaluating-neural-network-performance-from-gains-chart" class="nav-link" data-scroll-target="#evaluating-neural-network-performance-from-gains-chart"><strong>Evaluating Neural Network Performance from Gains Chart</strong></a></li>
  <li><a href="#model-tuning" id="toc-model-tuning" class="nav-link" data-scroll-target="#model-tuning"><strong>Model Tuning</strong></a></li>
  <li><a href="#retrain-model-with-hidden-layers-sizes-3-3" id="toc-retrain-model-with-hidden-layers-sizes-3-3" class="nav-link" data-scroll-target="#retrain-model-with-hidden-layers-sizes-3-3"><strong>Retrain model with hidden layers sizes: (3, 3)</strong></a></li>
  <li><a href="#calculating-the-accuracy-of-the-models" id="toc-calculating-the-accuracy-of-the-models" class="nav-link" data-scroll-target="#calculating-the-accuracy-of-the-models"><strong>Calculating the Accuracy of the models</strong></a></li>
  </ul></li>
  <li><a href="#calculate-the-profit-of-each-model" id="toc-calculate-the-profit-of-each-model" class="nav-link" data-scroll-target="#calculate-the-profit-of-each-model">Calculate the profit of each model</a></li>
  <li><a href="#calculate-the-profit-which-is-scale-to-801821---38487-763334-businesses" id="toc-calculate-the-profit-which-is-scale-to-801821---38487-763334-businesses" class="nav-link" data-scroll-target="#calculate-the-profit-which-is-scale-to-801821---38487-763334-businesses">Calculate the profit, which is scale to 801821 - 38487 = 763334 businesses</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Intuit Upgrade Notebook</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Duyen Tran </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 26, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>This analytical examines the efficacy of an upsell campaign targeting small businesses to upgrade to the latest QuickBooks software, based on a dataset of 75,000 entities from a pool of 801,821.</p>
<p>Utilizing logistic regression and neural networks, the analysis aims to:</p>
<ul>
<li>Understand customer behaviors and preferences towards the software upgrade.</li>
<li>Identify factors influencing the likelihood of upgrading.</li>
<li>Enhance targeting strategies for future marketing campaigns to optimize conversion rates and customer satisfaction.</li>
</ul>
<p>By leveraging logistic regression, we assess the probabilistic impact of variables on customer decisions, while neural networks allow for a deeper dive into complex, non-linear relationships among data points. This dual-model approach provides:</p>
<ul>
<li>Insights into direct and subtle factors affecting upgrade decisions.</li>
<li>Identification of potential customer segments more likely to respond positively.</li>
<li>A foundation for more effective and efficient marketing strategies, contributing to business growth and customer loyalty.</li>
</ul>
<section id="data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="data-analysis">Data Analysis</h2>
<div id="ef2402f2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyrsm <span class="im">as</span> rsm</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># increase plot resolution</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># mpl.rcParams["figure.dpi"] = 150</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>rsm.__version__</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>intuit75k <span class="op">=</span> pd.read_parquet(<span class="st">"data/intuit75k.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="data-description-intuit-quickbooks-upgrade" class="level3">
<h3 class="anchored" data-anchor-id="data-description-intuit-quickbooks-upgrade">Data Description: Intuit Quickbooks upgrade</h3>
<p>The purpose of this exercise is to gain experience modeling the response to an upsell campaign. The <code>intuit75k.parquet</code> file contains data on 75,000 (small) businesses that were selected randomly from the 801,821 that were sent the wave-1 mailing. The mailing contained an offer to upgrade to the latest version of the Quickbooks software.</p>
<p>Variable <code>res1</code> denotes which of these businesses responded to the mailing by purchasing Quickbooks version 3.0 from Intuit Direct. Note that Intuit Direct sells products directly to its customers rather than through a retailer. Use the available data to predict which businesses that did not respond to the wave-1 mailing, are most likely to respond to the wave-2 mailing. Note that variables were added, deleted, and recoded so please ignore the variable descriptions in Exhibit 3 in the case in the course reader. Instead, use the variable descriptions below:</p>
<section id="variable-description" class="level4">
<h4 class="anchored" data-anchor-id="variable-description"><strong>Variable description</strong></h4>
<ul>
<li>id: Small business customer ID</li>
<li>zip5: 5-Digit ZIP Code (00000=unknown, 99999=international ZIPs).</li>
<li>zip_bins: Zip-code bins (20 approx. equal sized bins from lowest to highest zip code number)</li>
<li>sex: Gender Identity “Female”, “Male”, or “Unknown”</li>
<li>bizflag: Business Flag. Address contains a Business name (1 = yes, 0 = no or unknown).</li>
<li>numords: Number of orders from Intuit Direct in the previous 36 months</li>
<li>dollars: Total $ ordered from Intuit Direct in the previous 36 months</li>
<li>last: Time (in months) since last order from Intuit Direct in previous 36 months</li>
<li>sincepurch: Time (in months) since original (not upgrade) purchase of Quickbooks</li>
<li>version1: Is 1 if customer’s current Quickbooks is version 1, 0 if version 2</li>
<li>owntaxprod: Is 1 if customer purchased tax software, 0 otherwise</li>
<li>upgraded: Is 1 if customer upgraded from Quickbooks vs.&nbsp;1 to vs.&nbsp;2</li>
<li>res1: Response to wave 1 mailing (“Yes” if responded else “No”)</li>
<li>training: 70/30 split, 1 for training sample, 0 for validation sample</li>
</ul>
</section>
</section>
<section id="data-preprocessing" class="level3">
<h3 class="anchored" data-anchor-id="data-preprocessing">Data Preprocessing</h3>
<p>In the data preprocessing section, we will be reviewing the variables that are present in our dataset and identifying any potential scaling or data pre-processing actions that needs to be made. We will also be reviewing our dataset to ensure tha there are no null values, and that the data types are aligned.</p>
<div id="bbf68043" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>intuit75k.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">zip5</th>
<th data-quarto-table-cell-role="th">zip_bins</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">bizflag</th>
<th data-quarto-table-cell-role="th">numords</th>
<th data-quarto-table-cell-role="th">dollars</th>
<th data-quarto-table-cell-role="th">last</th>
<th data-quarto-table-cell-role="th">sincepurch</th>
<th data-quarto-table-cell-role="th">version1</th>
<th data-quarto-table-cell-role="th">owntaxprod</th>
<th data-quarto-table-cell-role="th">upgraded</th>
<th data-quarto-table-cell-role="th">res1</th>
<th data-quarto-table-cell-role="th">training</th>
<th data-quarto-table-cell-role="th">res1_yes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>94553</td>
<td>18</td>
<td>Male</td>
<td>0</td>
<td>2</td>
<td>109.5</td>
<td>5</td>
<td>12</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>No</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>53190</td>
<td>10</td>
<td>Unknown</td>
<td>0</td>
<td>1</td>
<td>69.5</td>
<td>4</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>No</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>37091</td>
<td>8</td>
<td>Male</td>
<td>0</td>
<td>4</td>
<td>93.0</td>
<td>14</td>
<td>29</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>No</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>02125</td>
<td>1</td>
<td>Male</td>
<td>0</td>
<td>1</td>
<td>22.0</td>
<td>17</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>No</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>60201</td>
<td>11</td>
<td>Male</td>
<td>0</td>
<td>1</td>
<td>24.5</td>
<td>2</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>No</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="c20e0b35" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>intuit75k.hist(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>array([[&lt;Axes: title={'center': 'id'}&gt;,
        &lt;Axes: title={'center': 'zip_bins'}&gt;,
        &lt;Axes: title={'center': 'bizflag'}&gt;],
       [&lt;Axes: title={'center': 'numords'}&gt;,
        &lt;Axes: title={'center': 'dollars'}&gt;,
        &lt;Axes: title={'center': 'last'}&gt;],
       [&lt;Axes: title={'center': 'sincepurch'}&gt;,
        &lt;Axes: title={'center': 'version1'}&gt;,
        &lt;Axes: title={'center': 'owntaxprod'}&gt;],
       [&lt;Axes: title={'center': 'upgraded'}&gt;,
        &lt;Axes: title={'center': 'training'}&gt;,
        &lt;Axes: title={'center': 'res1_yes'}&gt;]], dtype=object)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-4-output-2.png" width="1559" height="1540" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Prior to creating any models, we want to review the distribution and scale of the variables in the dataset. If there is scale in the distribution of the variables as exemplified by the histograms produced above, this will effect the ability of our model to accurately and effectively predict the response to our second wave mailing outreach. Based on the distribution of the histograms above, the variable with the greatest skew is the <code>dollars</code>. It skews heavily towards the left, as do the <code>numrods</code> and <code>sincepurch</code> variables. Due to this, we will want to apply some type of transformation to these variables to normalize their distribution.</p>
<div id="6d600daa" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="op">=</span> intuit75k[intuit75k[<span class="st">'training'</span>] <span class="op">==</span> <span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we are creating our training set of data. This corresponds to any record that has a 1 in the <code>training</code> column within the <code>Intuit75k database</code>. As per the intuit instructions, the data was already pre-split into 70:30 training:test sets. If the data was not pre-split, we would want to consider employing the <code>StratifyShuffleSplit</code> method to create our training and testing data. This would ensure that our training and test sets have the same number of yes’s, which would provide a more accurate and representative dataset for the training and testing of our model.</p>
<div id="0480a313" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>intuit75k[<span class="st">'res1'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>res1
No     71399
Yes     3601
Name: count, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="correlation-between-features" class="level3">
<h3 class="anchored" data-anchor-id="correlation-between-features">Correlation Between Features</h3>
<p>In addition to scaling the data before we start building our models, we want to identify any potential correlation between the features in our dataset. If any features are highly correlated, this could lead to multi-collinearity within our models and lead to inflation of the variable coefficients or inflated importance of features on our model. If we are able to identify any correlation prior to building our model, we are able to adjust which features are correlated and see how this might increase their importance if a highly-correlated feature is omitted from the model.</p>
<div id="fe90282a" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>corr_columns <span class="op">=</span> [<span class="st">'zip_bins'</span>,<span class="st">'bizflag'</span>,<span class="st">'numords'</span>,<span class="st">'dollars'</span>,<span class="st">'last'</span>,<span class="st">'sincepurch'</span>]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="op">=</span> train_data[corr_columns].corr()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>corr_matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">zip_bins</th>
<th data-quarto-table-cell-role="th">bizflag</th>
<th data-quarto-table-cell-role="th">numords</th>
<th data-quarto-table-cell-role="th">dollars</th>
<th data-quarto-table-cell-role="th">last</th>
<th data-quarto-table-cell-role="th">sincepurch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">zip_bins</td>
<td>1.000000</td>
<td>-0.000679</td>
<td>0.005397</td>
<td>0.006667</td>
<td>-0.000726</td>
<td>-0.001555</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">bizflag</td>
<td>-0.000679</td>
<td>1.000000</td>
<td>-0.000113</td>
<td>0.002398</td>
<td>0.000647</td>
<td>-0.003839</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">numords</td>
<td>0.005397</td>
<td>-0.000113</td>
<td>1.000000</td>
<td>0.587267</td>
<td>-0.130395</td>
<td>0.000284</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">dollars</td>
<td>0.006667</td>
<td>0.002398</td>
<td>0.587267</td>
<td>1.000000</td>
<td>-0.073897</td>
<td>0.003649</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">last</td>
<td>-0.000726</td>
<td>0.000647</td>
<td>-0.130395</td>
<td>-0.073897</td>
<td>1.000000</td>
<td>-0.001506</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">sincepurch</td>
<td>-0.001555</td>
<td>-0.003839</td>
<td>0.000284</td>
<td>0.003649</td>
<td>-0.001506</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>Based on the correlation matrix created above, we see that there is not a high level of correlation between the features of this dataset. A high level of correlation is traditionally considered within the range of 0.7 and 0.9. Correlation coefficients whose magnitude is between 0.5 and 0.7 indicates that variables are moderately correlated. <code>Dollars</code> and <code>numrods</code> have a moderate correlation value of 0.59. It would make sense that these variables have a moderate correlation. The <code>numrod</code> variable represents number of orders from Intuit Direct in the previous 36 months, whereas <code>Dollars</code> represents the total dollar value ordered from intuit direct in the previous 36 months. Traditionally, orders and dollar value tend to have a positive - direct relationship, as we see <code>orders</code> increase, we expect to see <code>dollars</code> increase as well.</p>
</section>
</section>
<section id="logistic-regression-model" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression-model">Logistic Regression Model</h2>
<p>Now that we have transformed the variables to be on the same scale and have identified correlated variables, we can begin building our first logistic regression model. The goal of this model is to predict the probability of a business responding to a mailed offer.</p>
<div id="b40d3317" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#response rate of the first wave</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>response_rate <span class="op">=</span> train_data[<span class="st">"res1_yes"</span>].mean()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>response_rate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>0.047580952380952383</code></pre>
</div>
</div>
<p>We can find the average response rate to the first wave mailing offer by taking the mean of the <code>res1_yes</code> column across the training dataset. This will be important when we try to project our model’s findings onto the larger client base as a whole. This variable represents whether a business responded to the offer or not. The average response rate in the first wave mailing is 4.76%.</p>
<section id="logistic-regression-model-1" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression-model-1"><strong>Logistic Regression Model 1</strong></h3>
<div id="c4a1eda5" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> rsm.logistic(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {<span class="st">'wave1'</span>: train_data},</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    rvar <span class="op">=</span> <span class="st">"res1_yes"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    evar <span class="op">=</span> [</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"zip_bins"</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bizflag"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"numords"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"dollars"</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"last"</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"sincepurch"</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"sex"</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"version1"</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"owntaxprod"</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"upgraded"</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="6ba4db86" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>lr.summary(main <span class="op">=</span> <span class="va">True</span>, vif <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Logistic regression (GLM)
Data                 : wave1
Response variable    : res1_yes
Level                : None
Explanatory variables: zip_bins, bizflag, numords, dollars, last, sincepurch, sex, version1, owntaxprod, upgraded
Null hyp.: There is no effect of x on res1_yes
Alt. hyp.: There is an effect of x on res1_yes

                 OR     OR%  coefficient  std.error  z.value p.value     
Intercept     0.052  -94.8%        -2.96      0.087  -34.016  &lt; .001  ***
sex[Male]     0.987   -1.3%        -0.01      0.052   -0.249   0.804     
sex[Unknown]  0.991   -0.9%        -0.01      0.074   -0.118   0.906     
zip_bins      0.946   -5.4%        -0.06      0.004  -14.931  &lt; .001  ***
bizflag       1.047    4.7%         0.05      0.048    0.964   0.335     
numords       1.251   25.1%         0.22      0.019   12.010  &lt; .001  ***
dollars       1.001    0.1%         0.00      0.000    3.638  &lt; .001  ***
last          0.958   -4.2%        -0.04      0.002  -17.959  &lt; .001  ***
sincepurch    1.002    0.2%         0.00      0.004    0.518   0.605     
version1      2.082  108.2%         0.73      0.085    8.583  &lt; .001  ***
owntaxprod    1.359   35.9%         0.31      0.101    3.048   0.002   **
upgraded      2.540  154.0%         0.93      0.084   11.076  &lt; .001  ***

Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Pseudo R-squared (McFadden): 0.071
Pseudo R-squared (McFadden adjusted): 0.07
Area under the RO Curve (AUC): 0.709
Log-likelihood: -9332.061, AIC: 18688.123, BIC: 18794.545
Chi-squared: 1425.521, df(11), p.value &lt; 0.001 
Nr obs: 52,500

Variance inflation factors:

              vif    Rsq
sincepurch  3.736  0.732
version1    2.972  0.664
upgraded    2.918  0.657
numords     1.558  0.358
dollars     1.527  0.345
owntaxprod  1.027  0.026
last        1.017  0.017
sex         1.000  0.000
bizflag     1.000  0.000
zip_bins    1.000  0.000</code></pre>
</div>
</div>
<section id="logistic-regression-summary-interpretation" class="level4">
<h4 class="anchored" data-anchor-id="logistic-regression-summary-interpretation"><strong>Logistic Regression Summary Interpretation</strong></h4>
<p>Based on the first version of our logistic regression model, there are a couple of important things to note in regards to feature selection and overall performance of the model. First, we want to take a look at our Pseudo R-squared (McFadden) and Pseudo R-squared (McFadden Adjusted) values. Based on our output, we see that these values are <strong>0.073</strong> and <strong>0.07</strong>, respectively. The Pseudo R-squared values are generally lower than the traditional R-squared in linear regression models and don’t have a fixed range. However, the values for our McFadden and McFadden are still on the lower side. This isn’t automatically a deal-breaker for this model or automatically a reason to throw our model away, but we would want weigh these R-squared values in conjunction with other factors (such as AUC, and Chi-squared) to evaluate the effectiveness and predictive performance of our model. <br></p>
<p>In addition to the r-squared values, we also want to evaluate the AUC value. AUC indicates a model’s ability to discriminate between a positive and negative class. The AUC value is on a fixed scale, with a base threshold of 0.5. Any value over 0.5 is considered to be a better value, and indicate a better model. Our first logisitic regression model had an AUC of 0.708 which suggests that the model has a good ability to distinguish between the two classes (i.e.&nbsp;responded to the mailing offer or not). We can also use the AIC and BIC values to evaluate our model as well. The AIC and BIC respectively represent the Akaike Information Criterion and the Bayesian Information Criterion. These values also indicate the models’s fit to the data. Generally, the goal is to have a lower AIC and BIC value, and models with lower AIC and BIC values are preferred. Our model has an AIC value of 18688.123, and the BIC value of 18794.545. These values are a bit difficult to represent or evaluate at first, but will become more important when we begin to omit variables and see how these values change. If both the AIC and BIC values become lower when removing a variable, we would consider using the model that produces the lower values.</p>
<p><br>Finally, the most important value when evaluating a models performance is the Chi-squared value. The Chi-squared value of 1425.521 with 11 degrees of freedom and a p.value &lt; 0.001 suggests that the model as a whole is statistically significant, and at least some of the predictors or features in this model are significantly related to the outcome. Therefore, our first logistic regression model with all of the variables included seems to be a statistically significant model with a decent prediction ability. We would want to consider removing any statistically insignificant variables to see how the model’s performance changes, in hopes of building a more powerful prediction model.</p>
<div id="3fd7db78" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>lr.plot(<span class="st">"vimp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-11-output-1.png" width="554" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="permutation-importance-plot-interpretation" class="level4">
<h4 class="anchored" data-anchor-id="permutation-importance-plot-interpretation"><strong>Permutation Importance Plot Interpretation</strong></h4>
<p>Based on the permutation importance graph above, we can see that the variables of importance are <code>upgraded</code>, <code>last</code>, <code>zip_bins</code>, <code>numrods</code>, <code>version1</code>, <code>owntaxprod</code>, <code>dollars</code>. These variables however, do not contribute to a very large decrease in AUC, but this graph allows us to view the ratio of importance of the variables. Additionally, we can see that the <code>bizflag</code>, <code>sincepurch</code>, and <code>sex</code> variables are not important. Based on their lack of importance via AUC decrease, and their statistical insignificance, as identified by their high p-values in the logistic regression summary, we will consider testing their removal from the model and seeing if the model’s performance changes.</p>
<div id="c0bc3005" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>lr.plot(<span class="st">"pred"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-12-output-1.png" width="820" height="1538" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="prediction-plot-interpretation" class="level4">
<h4 class="anchored" data-anchor-id="prediction-plot-interpretation"><strong>Prediction Plot Interpretation</strong></h4>
<p>Based on the prediction plots above, it looks like gender has very little influence of a prediction value. Similarily <code>bizflag</code>, and <code>since_purch</code> also looks insignificant, and doesn’t seem to contribute much to the prediction value. Therefore, we will want to remove them from this logistic regression model to see if the new logistic regression improves the AUC and r^2 value.</p>
</section>
<section id="testing-the-removal-of-features-from-the-model" class="level4">
<h4 class="anchored" data-anchor-id="testing-the-removal-of-features-from-the-model"><strong>Testing the removal of features from the model</strong></h4>
<p>As mentioned above, <code>bizflag</code>, <code>sincepurch</code>, and <code>sex</code> all have low importance and are statistically insignificant to our model, as indicated by their high p-values. We want to test removing them from our model to see if the performance of our model changes. The change in model performance will be interpreted based on how the AUC, BIC, Pseudo R-Squared, and Chi-squared values change in comparison to our baseline model with all of the features included as explanatory variables.</p>
</section>
<section id="removing-bizflag-sincepurch-and-sex-together" class="level4">
<h4 class="anchored" data-anchor-id="removing-bizflag-sincepurch-and-sex-together"><strong>Removing <code>bizflag</code>, <code>sincepurch</code>, and <code>sex</code> together</strong></h4>
<div id="f5bc4c0f" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>lr.summary(main <span class="op">=</span> <span class="va">False</span>, test<span class="op">=</span>[<span class="st">'sincepurch'</span>, <span class="st">'sex'</span>,<span class="st">'bizflag'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Pseudo R-squared (McFadden): 0.071
Pseudo R-squared (McFadden adjusted): 0.07
Area under the RO Curve (AUC): 0.709
Log-likelihood: -9332.061, AIC: 18688.123, BIC: 18794.545
Chi-squared: 1425.521, df(11), p.value &lt; 0.001 
Nr obs: 52,500

Model 1: res1_yes ~ zip_bins + numords + dollars + last + version1 + owntaxprod + upgraded
Model 2: res1_yes ~ zip_bins + bizflag + numords + dollars + last + sincepurch + sex + version1 + owntaxprod + upgraded
Pseudo R-squared, Model 1 vs 2: 0.071 vs 0.071
Chi-squared: 1.257 df (4), p.value 0.869</code></pre>
</div>
</div>
<section id="model-interpretation" class="level5">
<h5 class="anchored" data-anchor-id="model-interpretation"><strong>Model Interpretation</strong></h5>
<p>We first wanted to see the model’s performance when we removed <code>sincepurch</code>, <code>sex</code>, and <code>bizflag</code> together from the model. As identified above, we noticed that these variables had the lowest importance to the model and were statistically insignificant to the baseline logistic regression model. The test function enables us to generate a logistic regression output as if we were generating the models without these variables being included. We are then able to compare the model’s performance with and without them included. As we see, the first output shows our baseline model’s output. We see the same metrics that were identified previously.</p>
<p><br> The second output shows us the Pseudo R-squared values in the baseline logit model vs.&nbsp;our new model with the variables being removed. As we see via the output, the Pseudo r-squared value does not change in model 1 vs.&nbsp;model 2, this indicates that the overall explanatory power of the models is unchanged despite the removal of the <code>sincepurch</code>,<code>sex</code>, and <code>bizflag</code> variables. However, the chi-squared value and the p.value change significantly, which is critical. The chi-squared value of 1.257 with 4 degrees of freedom and a p-value of 0.869 from comparing Model 1 and Model 2 suggests that the variables removed do not significantly contribute to the model. A high p-value (p &gt; 0.05) indicates that there is no significant loss (or gain) in explanatory power due to these changes.</p>
<p><br> essentially, the comparison suggests that the removal of <code>bizflag</code>, <code>sincepurch</code>, and <code>sex</code> between Model 1 and Model 2 does not significantly affect the model’s explanatory power or predictive ability. This is indicated by the unchanged Pseudo R-squared values and the non-significant chi-squared test for the comparison. Therefore, if removing variables does not significantly decrease the model’s performance, it might be beneficial to keep the model simpler by excluding them. A simpler model is easier to interpret and may generalize better to new data. We will also want to test the removal of the variables one by one to see if that improves the model’s explanatory power.</p>
</section>
</section>
<section id="removing-sincepurch-and-sex" class="level4">
<h4 class="anchored" data-anchor-id="removing-sincepurch-and-sex"><strong>Removing <code>sincepurch</code>, and <code>sex</code></strong></h4>
<div id="9b4e8128" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>lr.summary(main <span class="op">=</span> <span class="va">False</span>, test <span class="op">=</span> [<span class="st">'sincepurch'</span>, <span class="st">'sex'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Pseudo R-squared (McFadden): 0.071
Pseudo R-squared (McFadden adjusted): 0.07
Area under the RO Curve (AUC): 0.709
Log-likelihood: -9332.061, AIC: 18688.123, BIC: 18794.545
Chi-squared: 1425.521, df(11), p.value &lt; 0.001 
Nr obs: 52,500

Model 1: res1_yes ~ zip_bins + bizflag + numords + dollars + last + version1 + owntaxprod + upgraded
Model 2: res1_yes ~ zip_bins + bizflag + numords + dollars + last + sincepurch + sex + version1 + owntaxprod + upgraded
Pseudo R-squared, Model 1 vs 2: 0.071 vs 0.071
Chi-squared: 0.331 df (3), p.value 0.954</code></pre>
</div>
</div>
<section id="model-interpretation-1" class="level5">
<h5 class="anchored" data-anchor-id="model-interpretation-1"><strong>Model interpretation</strong></h5>
<p>In the previous section, we evaluated the performance of our logistic regression model when we removed the three insignificant variables from our model as interpreted from their individual p-values. In this removal round, we wanted to evalute the performance of our logistic regression model if we considered removing <code>sincepurch</code> and <code>sex</code>. Both models have the same Pseudo R-squared values (0.071), which suggests that the overall explanatory power of the models is unchanged despite the removal or addition of variables. Additionally, The chi-squared value of 0.331 with 3 degrees of freedom and a p-value of 0.954 from comparing Model 1 and Model 2 suggests that the variables removed (or added) do not significantly contribute to the model. A high p-value (p &gt; 0.05) indicates that there is no significant loss (or gain) in explanatory power due to these changes. This indicates that we might want to consider removing them completely from the model as they don’t increase the explanatory power of the model.</p>
</section>
</section>
<section id="removing-sex" class="level4">
<h4 class="anchored" data-anchor-id="removing-sex"><strong>Removing <code>sex</code></strong></h4>
<div id="5099f306" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>lr.summary(main <span class="op">=</span> <span class="va">False</span>, test <span class="op">=</span> [<span class="st">'sex'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Pseudo R-squared (McFadden): 0.071
Pseudo R-squared (McFadden adjusted): 0.07
Area under the RO Curve (AUC): 0.709
Log-likelihood: -9332.061, AIC: 18688.123, BIC: 18794.545
Chi-squared: 1425.521, df(11), p.value &lt; 0.001 
Nr obs: 52,500

Model 1: res1_yes ~ zip_bins + bizflag + numords + dollars + last + sincepurch + version1 + owntaxprod + upgraded
Model 2: res1_yes ~ zip_bins + bizflag + numords + dollars + last + sincepurch + sex + version1 + owntaxprod + upgraded
Pseudo R-squared, Model 1 vs 2: 0.071 vs 0.071
Chi-squared: 0.062 df (2), p.value 0.97</code></pre>
</div>
</div>
<section id="model-interpretation-2" class="level5">
<h5 class="anchored" data-anchor-id="model-interpretation-2"><strong>Model interpretation</strong></h5>
<p>In this removal round, we wanted to evaluate the performance of our logistic regression model if we tested the removal of <code>sex</code>. Both models have the same Pseudo R-squared values (0.071), which suggests that the overall explanatory power of the models is unchanged despite the removal or addition of variables. Additionally, The chi-squared value of 0.062 with 2 degrees of freedom and a p-value of 0.97 from comparing Model 1 and Model 2 suggests that the variables removed (or added) do not significantly contribute to the model. A high p-value (p &gt; 0.05) indicates that there is no significant loss (or gain) in explanatory power due to these changes. This indicates that we might want to consider removing them completely from the model as they don’t increase the explanatory power of the model.</p>
</section>
</section>
<section id="removing-sincepurch" class="level4">
<h4 class="anchored" data-anchor-id="removing-sincepurch"><strong>Removing <code>sincepurch</code></strong></h4>
<div id="ae5a3761" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>lr.summary(main <span class="op">=</span> <span class="va">False</span>, test<span class="op">=</span>[<span class="st">'sincepurch'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Pseudo R-squared (McFadden): 0.071
Pseudo R-squared (McFadden adjusted): 0.07
Area under the RO Curve (AUC): 0.709
Log-likelihood: -9332.061, AIC: 18688.123, BIC: 18794.545
Chi-squared: 1425.521, df(11), p.value &lt; 0.001 
Nr obs: 52,500

Model 1: res1_yes ~ zip_bins + bizflag + numords + dollars + last + sex + version1 + owntaxprod + upgraded
Model 2: res1_yes ~ zip_bins + bizflag + numords + dollars + last + sincepurch + sex + version1 + owntaxprod + upgraded
Pseudo R-squared, Model 1 vs 2: 0.071 vs 0.071
Chi-squared: 0.268 df (1), p.value 0.605</code></pre>
</div>
</div>
<section id="model-interpretation-3" class="level5">
<h5 class="anchored" data-anchor-id="model-interpretation-3"><strong>Model interpretation</strong></h5>
<p>In this removal round, we wanted to evaluate the performance of our logistic regression model if we tested the removal of <code>sincepurch</code>. Both models have the same Pseudo R-squared values (0.071), which suggests that the overall explanatory power of the models is unchanged despite the removal or addition of variables. Additionally, The chi-squared value of 0.268 with 1 degrees of freedom and a p-value of 0.605 from comparing Model 1 and Model 2 suggests that the variables removed (or added) do not significantly contribute to the model. A high p-value (p &gt; 0.05) indicates that there is no significant loss (or gain) in explanatory power due to these changes. This indicates that we might want to consider removing them completely from the model as they don’t increase the explanatory power of the model.</p>
</section>
</section>
<section id="removing-bizflag" class="level4">
<h4 class="anchored" data-anchor-id="removing-bizflag"><strong>Removing <code>bizflag</code></strong></h4>
<div id="54741b42" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>lr.summary(main <span class="op">=</span> <span class="va">False</span>, test<span class="op">=</span>[<span class="st">'bizflag'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Pseudo R-squared (McFadden): 0.071
Pseudo R-squared (McFadden adjusted): 0.07
Area under the RO Curve (AUC): 0.709
Log-likelihood: -9332.061, AIC: 18688.123, BIC: 18794.545
Chi-squared: 1425.521, df(11), p.value &lt; 0.001 
Nr obs: 52,500

Model 1: res1_yes ~ zip_bins + numords + dollars + last + sincepurch + sex + version1 + owntaxprod + upgraded
Model 2: res1_yes ~ zip_bins + bizflag + numords + dollars + last + sincepurch + sex + version1 + owntaxprod + upgraded
Pseudo R-squared, Model 1 vs 2: 0.071 vs 0.071
Chi-squared: 0.924 df (1), p.value 0.337</code></pre>
</div>
</div>
<section id="model-interpretation-4" class="level5">
<h5 class="anchored" data-anchor-id="model-interpretation-4"><strong>Model interpretation</strong></h5>
<p>In this removal round, we wanted to evaluate the performance of our logistic regression model if we tested the removal of <code>bizflag</code>. Both models have the same Pseudo R-squared values (0.071), which suggests that the overall explanatory power of the models is unchanged despite the removal or addition of variables. Additionally, The chi-squared value of 0.924 with 1 degree of freedom and a p-value of 0.337 from comparing Model 1 and Model 2 suggests that the variables removed (or added) do not significantly contribute to the model. A high p-value (p &gt; 0.05) indicates that there is no significant loss (or gain) in explanatory power due to these changes. This indicates that we might want to consider removing them completely from the model as they don’t increase the explanatory power of the model.</p>
</section>
</section>
<section id="removing-dollars" class="level4">
<h4 class="anchored" data-anchor-id="removing-dollars"><strong>Removing <code>dollars</code></strong></h4>
<div id="cb8c52a4" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>lr.summary(main <span class="op">=</span> <span class="va">False</span>, test<span class="op">=</span>[<span class="st">'dollars'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Pseudo R-squared (McFadden): 0.071
Pseudo R-squared (McFadden adjusted): 0.07
Area under the RO Curve (AUC): 0.709
Log-likelihood: -9332.061, AIC: 18688.123, BIC: 18794.545
Chi-squared: 1425.521, df(11), p.value &lt; 0.001 
Nr obs: 52,500

Model 1: res1_yes ~ zip_bins + bizflag + numords + last + sincepurch + sex + version1 + owntaxprod + upgraded
Model 2: res1_yes ~ zip_bins + bizflag + numords + dollars + last + sincepurch + sex + version1 + owntaxprod + upgraded
Pseudo R-squared, Model 1 vs 2: 0.070 vs 0.071
Chi-squared: 12.732 df (1), p.value &lt; .001</code></pre>
</div>
</div>
<section id="model-interpretation-5" class="level5">
<h5 class="anchored" data-anchor-id="model-interpretation-5"><strong>Model interpretation</strong></h5>
<p>As mentioned previous, Both models have the same Pseudo R-squared values (0.071), suggesting that the overall explanatory power of the models is unchanged despite the removal or addition of variables. Additionally, The chi-squared value of 0.331 with 3 degrees of freedom and a p-value of 0.954 from comparing Model 1 and Model 2 suggests that the variables removed (or added) do not significantly contribute to the model. A high p-value (p &gt; 0.05) indicates that there is no significant loss (or gain) in explanatory power due to these changes. This indicates that we might want to consider removing them completely from the model as they don’t increase the explanatory power of the model.</p>
<p><br> The comparison between Model 1 and Model 2 with Pseudo R-squared, Model 1 vs 2: 0.070 vs 0.071 and Chi-squared: 12.732 df (1), p.value &lt; .001 shows a minor improvement in the Pseudo R-squared from Model 1 to Model 2, indicating a slightly better fit in Model 2. The chi-squared value being significant (p &lt; .001) for the comparison suggests that the change between models (likely the inclusion of <code>dollars</code> in Model 2) significantly improves the model’s fit to the data.</p>
</section>
</section>
<section id="removing-owntaxprod" class="level4">
<h4 class="anchored" data-anchor-id="removing-owntaxprod"><strong>Removing <code>owntaxprod</code></strong></h4>
<div id="dff8aa16" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>lr.summary(main <span class="op">=</span> <span class="va">False</span>, test<span class="op">=</span>[<span class="st">'owntaxprod'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Pseudo R-squared (McFadden): 0.071
Pseudo R-squared (McFadden adjusted): 0.07
Area under the RO Curve (AUC): 0.709
Log-likelihood: -9332.061, AIC: 18688.123, BIC: 18794.545
Chi-squared: 1425.521, df(11), p.value &lt; 0.001 
Nr obs: 52,500

Model 1: res1_yes ~ zip_bins + bizflag + numords + dollars + last + sincepurch + sex + version1 + upgraded
Model 2: res1_yes ~ zip_bins + bizflag + numords + dollars + last + sincepurch + sex + version1 + owntaxprod + upgraded
Pseudo R-squared, Model 1 vs 2: 0.071 vs 0.071
Chi-squared: 8.694 df (1), p.value 0.003</code></pre>
</div>
</div>
<section id="model-interpretation-6" class="level5">
<h5 class="anchored" data-anchor-id="model-interpretation-6"><strong>Model interpretation</strong></h5>
<p>Model 1 and Model 2 are logistic regression models predicting the binary outcome res_yes_no using different sets of explanatory variables. The primary difference between the models is the inclusion of <code>owntaxprod</code> in Model 2, which is not present in Model 1. Pseudo R-squared for Model 1 vs.&nbsp;Model 2: 0.071 vs.&nbsp;0.071. This metric provides a measure of the explanatory power of the models, with values closer to 1 indicating a better fit. The identical Pseudo R-squared values for both models suggest that they have the same explanatory power, meaning the addition of <code>owntaxprod</code> in Model 2 does not improve the model’s ability to explain the variability in the outcome res_yes_no.</p>
<p><br>Chi-squared: 8.694, df (1), p.value 0.003. This test compares the two models to determine if the addition of the <code>owntaxprod</code> variable in Model 2 significantly improves the model fit compared to Model 1. The chi-squared statistic is used to assess this, with the degrees of freedom (df) typically representing the difference in the number of parameters estimated between the two models. In this case, the df is 1, corresponding to the one additional variable in Model 2. The p-value of 0.003 indicates that the difference in fit between Model 1 and Model 2 is statistically significant at conventional significance levels (e.g., α = 0.05). Therefore, despite the Pseudo R-squared values being identical, the statistical test suggests that <code>owntaxprod</code> provides a significant contribution to predicting the outcome when it is added to the model. <br></p>
Given these results, we would probably want to include <code>owntaxprod</code> in our model. However, some other factors we would want to consider are:
<ul>
<li>
Model complexity: Adding more variables can make the model more complex and potentially harder to interpret.
</li>
<li>
Practical significance: Evaluate whether the inclusion of owntaxprod has practical significance in addition to its statistical significance.
</li>
<li>
Cross-validation: Perform cross-validation to assess the generalizability of the model and avoid overfitting.
</li>
</ul>
<p>Further evaluation: Consider other metrics such as AUC, accuracy, precision, recall, and F1 score for a more comprehensive evaluation of model performance, especially in the context of the specific application or decision-making process the model is intended to support.</p>
</section>
</section>
<section id="check-cross-validation" class="level4">
<h4 class="anchored" data-anchor-id="check-cross-validation"><strong>Check cross-validation</strong></h4>
<div id="a97b8949" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ct <span class="op">=</span> rsm.basics.cross_tabs({<span class="st">'intuit75k'</span> :train_data}, <span class="st">"zip_bins"</span>, <span class="st">"res1"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>ct.summary(output <span class="op">=</span> <span class="st">"perc_row"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Cross-tabs
Data     : intuit75k
Variables: zip_bins, res1
Null hyp : There is no association between zip_bins and res1
Alt. hyp : There is an association between zip_bins and res1

Row percentages:

res1        Yes      No   Total
zip_bins                       
1         21.7%   78.3%  100.0%
2          4.2%   95.8%  100.0%
3         3.37%  96.63%  100.0%
4         4.06%  95.94%  100.0%
5         3.35%  96.65%  100.0%
...         ...     ...     ...
17        3.88%  96.12%  100.0%
18        5.21%  94.79%  100.0%
19        4.14%  95.86%  100.0%
20        3.71%  96.29%  100.0%
Total     4.76%  95.24%  100.0%

[21 rows x 3 columns]

Chi-squared: 1802.53 df(19), p.value &lt; .001
0.0% of cells have expected values below 5
</code></pre>
</div>
</div>
<div id="6e1d188c" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>ct <span class="op">=</span> rsm.basics.cross_tabs({<span class="st">'intuit75k'</span> :train_data}, <span class="st">"sex"</span>, <span class="st">"res1"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>ct.summary(output <span class="op">=</span> <span class="st">"perc_row"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Cross-tabs
Data     : intuit75k
Variables: sex, res1
Null hyp : There is no association between sex and res1
Alt. hyp : There is an association between sex and res1

Row percentages:

res1       Yes      No   Total
sex                           
Female    4.8%   95.2%  100.0%
Male     4.76%  95.24%  100.0%
Unknown   4.7%   95.3%  100.0%
Total    4.76%  95.24%  100.0%

Chi-squared: 0.1 df(2), p.value 0.95
0.0% of cells have expected values below 5
</code></pre>
</div>
</div>
<div id="a902a1ed" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>ct <span class="op">=</span> rsm.basics.cross_tabs({<span class="st">'intuit75k'</span> :train_data}, <span class="st">"bizflag"</span>, <span class="st">"res1"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>ct.summary(output <span class="op">=</span> <span class="st">"perc_row"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Cross-tabs
Data     : intuit75k
Variables: bizflag, res1
Null hyp : There is no association between bizflag and res1
Alt. hyp : There is an association between bizflag and res1

Row percentages:

res1       Yes      No   Total
bizflag                       
0        4.71%  95.29%  100.0%
1        4.92%  95.08%  100.0%
Total    4.76%  95.24%  100.0%

Chi-squared: 1.01 df(1), p.value 0.32
0.0% of cells have expected values below 5
</code></pre>
</div>
</div>
<div id="694a4e0d" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>ct <span class="op">=</span> rsm.basics.cross_tabs({<span class="st">'intuit75k'</span> :train_data}, <span class="st">"version1"</span>, <span class="st">"res1"</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>ct.summary(output <span class="op">=</span> <span class="st">"perc_row"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Cross-tabs
Data     : intuit75k
Variables: version1, res1
Null hyp : There is no association between version1 and res1
Alt. hyp : There is an association between version1 and res1

Row percentages:

res1        Yes      No   Total
version1                       
0         4.33%  95.67%  100.0%
1         6.35%  93.65%  100.0%
Total     4.76%  95.24%  100.0%

Chi-squared: 79.91 df(1), p.value &lt; .001
0.0% of cells have expected values below 5
</code></pre>
</div>
</div>
<div id="ed239398" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>ct <span class="op">=</span> rsm.basics.cross_tabs({<span class="st">'intuit75k'</span> :train_data}, <span class="st">"owntaxprod"</span>, <span class="st">"res1"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>ct.summary(output <span class="op">=</span> <span class="st">"perc_row"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Cross-tabs
Data     : intuit75k
Variables: owntaxprod, res1
Null hyp : There is no association between owntaxprod and res1
Alt. hyp : There is an association between owntaxprod and res1

Row percentages:

res1          Yes      No   Total
owntaxprod                       
0           4.66%  95.34%  100.0%
1           8.18%  91.82%  100.0%
Total       4.76%  95.24%  100.0%

Chi-squared: 40.07 df(1), p.value &lt; .001
0.0% of cells have expected values below 5
</code></pre>
</div>
</div>
<div id="c24bb219" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>pd.crosstab(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    train_data[<span class="st">"version1"</span>],</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    train_data[<span class="st">"upgraded"</span>],</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    margins <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    margins_name <span class="op">=</span> <span class="st">"Total"</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>).<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="st">"</span><span class="sc">{:,}</span><span class="st">"</span>.<span class="bu">format</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">upgraded</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">Total</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">version1</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>30,433</td>
<td>10,877</td>
<td>41,310</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>11,190</td>
<td>0</td>
<td>11,190</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>41,623</td>
<td>10,877</td>
<td>52,500</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="f27f107f" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>ct <span class="op">=</span> rsm.basics.cross_tabs({<span class="st">'intuit75k'</span> :train_data}, <span class="st">"upgraded"</span>, <span class="st">"res1"</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>ct.summary(output <span class="op">=</span> <span class="st">"perc_row"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Cross-tabs
Data     : intuit75k
Variables: upgraded, res1
Null hyp : There is no association between upgraded and res1
Alt. hyp : There is an association between upgraded and res1

Row percentages:

res1        Yes      No   Total
upgraded                       
0         3.99%  96.01%  100.0%
1          7.7%   92.3%  100.0%
Total     4.76%  95.24%  100.0%

Chi-squared: 262.79 df(1), p.value &lt; .001
0.0% of cells have expected values below 5
</code></pre>
</div>
</div>
<div id="2b7aa887" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>reg <span class="op">=</span> rsm.model.regress(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {<span class="st">"intuit75k"</span>: train_data},</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    rvar <span class="op">=</span> <span class="st">"numords"</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    evar <span class="op">=</span> <span class="st">'res1'</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>reg.coef.<span class="bu">round</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">coefficient</th>
<th data-quarto-table-cell-role="th">std.error</th>
<th data-quarto-table-cell-role="th">t.value</th>
<th data-quarto-table-cell-role="th">p.value</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Intercept</td>
<td>2.568</td>
<td>0.025</td>
<td>103.967</td>
<td>0.0</td>
<td>***</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>res1[T.No]</td>
<td>-0.523</td>
<td>0.025</td>
<td>-20.643</td>
<td>0.0</td>
<td>***</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="b24fa9c2" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>reg <span class="op">=</span> rsm.model.regress(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {<span class="st">"intuit75k"</span>: train_data},</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    rvar <span class="op">=</span> <span class="st">"dollars"</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    evar <span class="op">=</span> <span class="st">'res1'</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>reg.coef.<span class="bu">round</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">coefficient</th>
<th data-quarto-table-cell-role="th">std.error</th>
<th data-quarto-table-cell-role="th">t.value</th>
<th data-quarto-table-cell-role="th">p.value</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Intercept</td>
<td>117.000</td>
<td>1.615</td>
<td>72.448</td>
<td>0.0</td>
<td>***</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>res1[T.No]</td>
<td>-25.533</td>
<td>1.655</td>
<td>-15.430</td>
<td>0.0</td>
<td>***</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="b48498aa" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>reg <span class="op">=</span> rsm.model.regress(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {<span class="st">"intuit75k"</span>: train_data},</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    rvar <span class="op">=</span> <span class="st">"last"</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    evar <span class="op">=</span> <span class="st">'res1'</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>reg.coef.<span class="bu">round</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">coefficient</th>
<th data-quarto-table-cell-role="th">std.error</th>
<th data-quarto-table-cell-role="th">t.value</th>
<th data-quarto-table-cell-role="th">p.value</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Intercept</td>
<td>12.022</td>
<td>0.190</td>
<td>63.192</td>
<td>0.0</td>
<td>***</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>res1[T.No]</td>
<td>4.026</td>
<td>0.195</td>
<td>20.653</td>
<td>0.0</td>
<td>***</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="1083696a" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>reg <span class="op">=</span> rsm.model.regress(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {<span class="st">"intuit75k"</span>: train_data},</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    rvar <span class="op">=</span> <span class="st">"sincepurch"</span>,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    evar <span class="op">=</span> <span class="st">'res1'</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>reg.coef.<span class="bu">round</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">coefficient</th>
<th data-quarto-table-cell-role="th">std.error</th>
<th data-quarto-table-cell-role="th">t.value</th>
<th data-quarto-table-cell-role="th">p.value</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Intercept</td>
<td>19.153</td>
<td>0.200</td>
<td>95.793</td>
<td>0.0</td>
<td>***</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>res1[T.No]</td>
<td>-3.712</td>
<td>0.205</td>
<td>-18.121</td>
<td>0.0</td>
<td>***</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="check-the-zip_bins" class="level4">
<h4 class="anchored" data-anchor-id="check-the-zip_bins"><strong>Check the zip_bins</strong></h4>
<div id="fa7f283c" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> rsm.prop_plot(train_data, <span class="st">"zip_bins"</span>, <span class="st">"res1"</span>, <span class="st">"Yes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-31-output-1.png" width="597" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="e8ab638a" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>intuit75k[<span class="st">'zip_bins'</span>] <span class="op">=</span> intuit75k[<span class="st">'zip_bins'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> rsm.logistic(</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {<span class="st">'intuit75k'</span>: train_data},</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    rvar <span class="op">=</span> <span class="st">"res1_yes"</span>,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    evar <span class="op">=</span> [</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"zip_bins"</span>,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"bizflag"</span>,</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"numords"</span>,</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"dollars"</span>,</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"last"</span>,</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"sincepurch"</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"sex"</span>,</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"version1"</span>,</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"owntaxprod"</span>,</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"upgraded"</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>lr.coef.<span class="bu">round</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">OR</th>
<th data-quarto-table-cell-role="th">OR%</th>
<th data-quarto-table-cell-role="th">coefficient</th>
<th data-quarto-table-cell-role="th">std.error</th>
<th data-quarto-table-cell-role="th">z.value</th>
<th data-quarto-table-cell-role="th">p.value</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Intercept</td>
<td>0.052</td>
<td>-94.814</td>
<td>-2.959</td>
<td>0.087</td>
<td>-34.016</td>
<td>0.000</td>
<td>***</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>sex[T.Male]</td>
<td>0.987</td>
<td>-1.286</td>
<td>-0.013</td>
<td>0.052</td>
<td>-0.249</td>
<td>0.804</td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>sex[T.Unknown]</td>
<td>0.991</td>
<td>-0.870</td>
<td>-0.009</td>
<td>0.074</td>
<td>-0.118</td>
<td>0.906</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>zip_bins</td>
<td>0.946</td>
<td>-5.376</td>
<td>-0.055</td>
<td>0.004</td>
<td>-14.931</td>
<td>0.000</td>
<td>***</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>bizflag</td>
<td>1.047</td>
<td>4.743</td>
<td>0.046</td>
<td>0.048</td>
<td>0.964</td>
<td>0.335</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>numords</td>
<td>1.251</td>
<td>25.150</td>
<td>0.224</td>
<td>0.019</td>
<td>12.010</td>
<td>0.000</td>
<td>***</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>dollars</td>
<td>1.001</td>
<td>0.097</td>
<td>0.001</td>
<td>0.000</td>
<td>3.638</td>
<td>0.000</td>
<td>***</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>last</td>
<td>0.958</td>
<td>-4.172</td>
<td>-0.043</td>
<td>0.002</td>
<td>-17.959</td>
<td>0.000</td>
<td>***</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>sincepurch</td>
<td>1.002</td>
<td>0.203</td>
<td>0.002</td>
<td>0.004</td>
<td>0.518</td>
<td>0.605</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>version1</td>
<td>2.082</td>
<td>108.170</td>
<td>0.733</td>
<td>0.085</td>
<td>8.583</td>
<td>0.000</td>
<td>***</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>owntaxprod</td>
<td>1.359</td>
<td>35.945</td>
<td>0.307</td>
<td>0.101</td>
<td>3.048</td>
<td>0.002</td>
<td>**</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>upgraded</td>
<td>2.540</td>
<td>154.028</td>
<td>0.932</td>
<td>0.084</td>
<td>11.076</td>
<td>0.000</td>
<td>***</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="cc6fd370" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>lr.plot(<span class="st">"pred"</span>, incl <span class="op">=</span> <span class="st">"zip_bins"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-33-output-1.png" width="416" height="323" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="de28ec64" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    intuit75k.query(<span class="st">"(training == 1) &amp; (zip_bins == 1)"</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"zip5"</span>)[<span class="st">'res1_yes'</span>]</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    .agg([<span class="st">"mean"</span>, <span class="st">"sum"</span>, <span class="st">"count"</span>])</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    .sort_values(by <span class="op">=</span> <span class="st">"sum"</span>, ascending <span class="op">=</span> <span class="va">False</span>)[<span class="dv">0</span>:<span class="dv">10</span>]</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    .assign(mean <span class="op">=</span> <span class="kw">lambda</span> x: x[<span class="st">"mean"</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> y: <span class="ss">f"</span><span class="sc">{</span><span class="dv">100</span> <span class="op">*</span> y<span class="sc">:.2f}</span><span class="ss">%"</span>))</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">sum</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">zip5</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">00801</td>
<td>41.12%</td>
<td>486</td>
<td>1182</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">00804</td>
<td>35.43%</td>
<td>45</td>
<td>127</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">00000</td>
<td>3.00%</td>
<td>3</td>
<td>100</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">01923</td>
<td>37.50%</td>
<td>3</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">01890</td>
<td>17.65%</td>
<td>3</td>
<td>17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">02050</td>
<td>28.57%</td>
<td>2</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">01950</td>
<td>50.00%</td>
<td>2</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">01752</td>
<td>13.33%</td>
<td>2</td>
<td>15</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">01754</td>
<td>40.00%</td>
<td>2</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">01863</td>
<td>22.22%</td>
<td>2</td>
<td>9</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
</section>
<section id="improve-the-model-by-adding-dummies-for-zip-00801-and-00804" class="level3">
<h3 class="anchored" data-anchor-id="improve-the-model-by-adding-dummies-for-zip-00801-and-00804">Improve the model by adding dummies for zip 00801 and 00804</h3>
<div id="86722d1d" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>intuit75k <span class="op">=</span> intuit75k.assign(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    zip801 <span class="op">=</span> rsm.ifelse(intuit75k[<span class="st">"zip5"</span>] <span class="op">==</span> <span class="st">"00801"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    zip804 <span class="op">=</span> rsm.ifelse(intuit75k[<span class="st">"zip5"</span>] <span class="op">==</span> <span class="st">"00804"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c28b14cf" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> rsm.model.logistic(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {<span class="st">"intuit75k"</span>: intuit75k.query(<span class="st">"training == 1"</span>)},</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    rvar <span class="op">=</span> <span class="st">"res1"</span>,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    lev <span class="op">=</span> <span class="st">"Yes"</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    evar <span class="op">=</span> [</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip_bins'</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sex'</span>,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'numords'</span>,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bizflag'</span>,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'dollars'</span>,</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'last'</span>,</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'owntaxprod'</span>,</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sincepurch'</span>,</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'version1'</span>,</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'upgraded'</span>,</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip801'</span>,</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip804'</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>lr.coef[<span class="dv">30</span>:].<span class="bu">round</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">OR</th>
<th data-quarto-table-cell-role="th">OR%</th>
<th data-quarto-table-cell-role="th">coefficient</th>
<th data-quarto-table-cell-role="th">std.error</th>
<th data-quarto-table-cell-role="th">z.value</th>
<th data-quarto-table-cell-role="th">p.value</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>zip801</td>
<td>25.333</td>
<td>2433.301</td>
<td>3.232</td>
<td>0.164</td>
<td>19.746</td>
<td>0.0</td>
<td>***</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>zip804</td>
<td>18.398</td>
<td>1739.833</td>
<td>2.912</td>
<td>0.249</td>
<td>11.709</td>
<td>0.0</td>
<td>***</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="13e2c41e" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>lr.summary(main <span class="op">=</span> <span class="va">False</span>, fit <span class="op">=</span> <span class="va">False</span>, test <span class="op">=</span> <span class="st">"zip_bins"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Model 1: res1 ~ sex + numords + bizflag + dollars + last + owntaxprod + sincepurch + version1 + upgraded + zip801 + zip804
Model 2: res1 ~ zip_bins + sex + numords + bizflag + dollars + last + owntaxprod + sincepurch + version1 + upgraded + zip801 + zip804
Pseudo R-squared, Model 1 vs 2: 0.146 vs 0.148
Chi-squared: 30.796 df (19), p.value 0.042</code></pre>
</div>
</div>
<div id="5581f7d4" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>intuit75k[<span class="st">"pred_logit"</span>] <span class="op">=</span> lr.predict(intuit75k)[<span class="st">"prediction"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="8ec1e8d6" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>dct <span class="op">=</span> {<span class="st">"train"</span>: intuit75k[intuit75k.training <span class="op">==</span> <span class="dv">1</span>], <span class="st">"test"</span>: intuit75k[intuit75k.training <span class="op">==</span> <span class="dv">0</span>]}</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> rsm.gains_plot(dct, <span class="st">"res1"</span>, <span class="st">"Yes"</span>, <span class="st">"pred_logit"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-39-output-1.png" width="606" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="accuracy-of-logistic-regression-model" class="level3">
<h3 class="anchored" data-anchor-id="accuracy-of-logistic-regression-model">Accuracy of Logistic Regression Model</h3>
<div id="fa486a63" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> accuracy(data, actual, predicted):</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    TP <span class="op">=</span> FP <span class="op">=</span> TN <span class="op">=</span> FN <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, j <span class="kw">in</span> <span class="bu">zip</span>(actual, predicted):</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">==</span> <span class="dv">1</span> <span class="kw">and</span> j <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>            TP <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> i <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> j <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>            FP <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> i <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> j <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>            TN <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> i <span class="op">==</span> <span class="dv">1</span> <span class="kw">and</span> j <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>            FN <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (TN <span class="op">+</span> TP) <span class="op">/</span> (TN <span class="op">+</span> TP <span class="op">+</span> FN <span class="op">+</span> FP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="neural-network-model" class="level2">
<h2 class="anchored" data-anchor-id="neural-network-model">Neural Network Model</h2>
<p>Based on the output of the logistic regression models, we believe that employing a neural network model, that can account for underlying variable interactions, might be a better predictor than the logistic regression model. We first started by creating a simple neural network(NN) model that has 1 hidden layer with 1 node.</p>
<section id="nn-with-1-node-and-1-hidden-layer-all-variables" class="level3">
<h3 class="anchored" data-anchor-id="nn-with-1-node-and-1-hidden-layer-all-variables"><strong>NN with 1 Node and 1 Hidden Layer (all variables)</strong></h3>
<div id="9e5d7eb6" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>clf0 <span class="op">=</span> rsm.model.mlp(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {<span class="st">'intuit75k'</span>: intuit75k.query(<span class="st">'training == 1'</span>)},</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    rvar <span class="op">=</span> <span class="st">'res1_yes'</span>,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    evar <span class="op">=</span> [</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip_bins'</span>,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sex'</span>,</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'numords'</span>,</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bizflag'</span>,</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'dollars'</span>,</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'last'</span>,</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'owntaxprod'</span>,</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sincepurch'</span>,</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'version1'</span>,</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'upgraded'</span>,</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip801'</span>,</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip804'</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>    hidden_layer_sizes <span class="op">=</span> (<span class="dv">1</span>,),</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>    mod_type <span class="op">=</span> <span class="st">'classification'</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>clf0.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Multi-layer Perceptron (NN)
Data                 : intuit75k
Response variable    : res1_yes
Level                : None
Explanatory variables: zip_bins, sex, numords, bizflag, dollars, last, owntaxprod, sincepurch, version1, upgraded, zip801, zip804
Model type           : classification
Nr. of features      : (12, 31)
Nr. of observations  : 52,500
Hidden_layer_sizes   : (1,)
Activation function  : tanh
Solver               : lbfgs
Alpha                : 0.0001
Batch size           : auto
Learning rate        : 0.001
Maximum iterations   : 10000
random_state         : 1234
AUC                  : 0.768

Raw data             :
zip_bins  sex  numords  bizflag  dollars  last  owntaxprod  sincepurch  version1  upgraded  zip801  zip804
      18 Male        2        0    109.5     5           0          12         0         0       0       0
       1 Male        1        0     22.0    17           0           1         0         0       0       0
       3 Male        1        0     20.0    17           0          17         0         1       0       0
      11 Male        1        1     24.5     4           0          17         1         0       0       0
       5 Male        3        0     73.5    10           0           9         0         0       0       0

Estimation data      :
  numords  bizflag   dollars      last  owntaxprod  sincepurch  version1  upgraded  zip801  zip804  zip_bins_2  zip_bins_3  zip_bins_4  zip_bins_5  zip_bins_6  zip_bins_7  zip_bins_8  zip_bins_9  zip_bins_10  zip_bins_11  zip_bins_12  zip_bins_13  zip_bins_14  zip_bins_15  zip_bins_16  zip_bins_17  zip_bins_18  zip_bins_19  zip_bins_20  sex_Male  sex_Unknown
-0.057079        0  0.207902 -1.137183           0   -0.360809         0         0       0       0       False       False       False       False       False       False       False       False        False        False        False        False        False        False        False        False         True        False        False      True        False
-0.863720        0 -0.873735  0.119783           0   -1.458194         0         0       0       0       False       False       False       False       False       False       False       False        False        False        False        False        False        False        False        False        False        False        False      True        False
-0.863720        0 -0.898458  0.119783           0    0.138003         0         1       0       0       False        True       False       False       False       False       False       False        False        False        False        False        False        False        False        False        False        False        False      True        False
-0.863720        1 -0.842831 -1.241930           0    0.138003         1         0       0       0       False       False       False       False       False       False       False       False        False         True        False        False        False        False        False        False        False        False        False      True        False
 0.749561        0 -0.237115 -0.613447           0   -0.660096         0         0       0       0       False       False       False        True       False       False       False       False        False        False        False        False        False        False        False        False        False        False        False      True        False</code></pre>
</div>
</div>
<div id="cc7dc6db" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>intuit75k[<span class="st">"pred_nn0"</span>] <span class="op">=</span> clf0.predict(intuit75k)[<span class="st">"prediction"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="93b6c51d" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>clf0.plot(<span class="st">'vimp'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-43-output-1.png" width="566" height="996" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="a9187a4a" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>clf0.plot(<span class="st">"pred"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-44-output-1.png" width="836" height="1836" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="91c6c6b8" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>dct <span class="op">=</span> {<span class="st">"train"</span>: intuit75k[intuit75k.training <span class="op">==</span> <span class="dv">1</span>], <span class="st">"test"</span>: intuit75k[intuit75k.training <span class="op">==</span> <span class="dv">0</span>]}</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> rsm.gains_plot(dct, <span class="st">"res1"</span>, <span class="st">"Yes"</span>, <span class="st">"pred_nn0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-45-output-1.png" width="606" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="nn-with-1-node-and-1-hidden-layer-significant-variables" class="level3">
<h3 class="anchored" data-anchor-id="nn-with-1-node-and-1-hidden-layer-significant-variables"><strong>NN with 1 Node and 1 Hidden Layer (significant variables)</strong></h3>
<div id="cdf8b8a2" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>clf1 <span class="op">=</span> rsm.model.mlp(</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {<span class="st">'wave1'</span>:intuit75k.query(<span class="st">'training == 1'</span>)},</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    rvar <span class="op">=</span> <span class="st">'res1_yes'</span>,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    evar <span class="op">=</span> [</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip_bins'</span>,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sex'</span>,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'numords'</span>,</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bizflag'</span>,</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'dollars'</span>,</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'last'</span>,</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'owntaxprod'</span>,</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sincepurch'</span>,</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'version1'</span>,</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'upgraded'</span>,</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip801'</span>,</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip804'</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>    hidden_layer_sizes <span class="op">=</span> (<span class="dv">1</span>,),</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>    mod_type <span class="op">=</span> <span class="st">'classification'</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>clf1.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Multi-layer Perceptron (NN)
Data                 : wave1
Response variable    : res1_yes
Level                : None
Explanatory variables: zip_bins, sex, numords, bizflag, dollars, last, owntaxprod, sincepurch, version1, upgraded, zip801, zip804
Model type           : classification
Nr. of features      : (12, 31)
Nr. of observations  : 52,500
Hidden_layer_sizes   : (1,)
Activation function  : tanh
Solver               : lbfgs
Alpha                : 0.0001
Batch size           : auto
Learning rate        : 0.001
Maximum iterations   : 10000
random_state         : 1234
AUC                  : 0.768

Raw data             :
zip_bins  sex  numords  bizflag  dollars  last  owntaxprod  sincepurch  version1  upgraded  zip801  zip804
      18 Male        2        0    109.5     5           0          12         0         0       0       0
       1 Male        1        0     22.0    17           0           1         0         0       0       0
       3 Male        1        0     20.0    17           0          17         0         1       0       0
      11 Male        1        1     24.5     4           0          17         1         0       0       0
       5 Male        3        0     73.5    10           0           9         0         0       0       0

Estimation data      :
  numords  bizflag   dollars      last  owntaxprod  sincepurch  version1  upgraded  zip801  zip804  zip_bins_2  zip_bins_3  zip_bins_4  zip_bins_5  zip_bins_6  zip_bins_7  zip_bins_8  zip_bins_9  zip_bins_10  zip_bins_11  zip_bins_12  zip_bins_13  zip_bins_14  zip_bins_15  zip_bins_16  zip_bins_17  zip_bins_18  zip_bins_19  zip_bins_20  sex_Male  sex_Unknown
-0.057079        0  0.207902 -1.137183           0   -0.360809         0         0       0       0       False       False       False       False       False       False       False       False        False        False        False        False        False        False        False        False         True        False        False      True        False
-0.863720        0 -0.873735  0.119783           0   -1.458194         0         0       0       0       False       False       False       False       False       False       False       False        False        False        False        False        False        False        False        False        False        False        False      True        False
-0.863720        0 -0.898458  0.119783           0    0.138003         0         1       0       0       False        True       False       False       False       False       False       False        False        False        False        False        False        False        False        False        False        False        False      True        False
-0.863720        1 -0.842831 -1.241930           0    0.138003         1         0       0       0       False       False       False       False       False       False       False       False        False         True        False        False        False        False        False        False        False        False        False      True        False
 0.749561        0 -0.237115 -0.613447           0   -0.660096         0         0       0       0       False       False       False        True       False       False       False       False        False        False        False        False        False        False        False        False        False        False        False      True        False</code></pre>
</div>
</div>
<div id="5228b427" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>intuit75k[<span class="st">"pred_nn1"</span>] <span class="op">=</span> clf1.predict(intuit75k)[<span class="st">"prediction"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="bb9001bf" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>clf1.plot(<span class="st">'vimp'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-48-output-1.png" width="566" height="996" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The permutation importance plot reveals that the geographic segmentation <code>zip_bins</code>, the timing of the last event (last), and the upgrade status (upgraded) are the most influential factors in predicting the yes/no response variable in your Multi-layer Perceptron model. The importance of <code>zip_bins</code> suggests that location-based characteristics are crucial in the model’s decision-making process. The prominence of last indicates that recent interactions or activities have a significant impact on the predictions, and the positive trend with upgraded implies that customers who have upgraded are more likely to yield a positive response.</p>
<div id="7938475e" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>clf1.plot(<span class="st">"pred"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-49-output-1.png" width="836" height="1836" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The partial dependence plots show a nuanced view of feature influences. A steeper slope for the <code>zip_bins</code> plot underscores its importance, aligning with the permutation importance results. Other variables like <code>numords</code>, <code>dollars</code>, <code>version1</code>, <code>owntaxprod</code>, and upgraded appear to have a more muted effect on the model’s output. Overall, the model’s predictive behavior is mostly swayed by where the customer is located, with other factors playing secondary roles.</p>
<p>We wanted to first create a base line neural network model. However, as we can see by the prediction plots, this nn model does not provide much in terms of the predictability based on various variables. We will want to build a neural network with more nodes and more hidden layers, and make our model a bit more flexible.</p>
<div id="8300ad17" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>dct <span class="op">=</span> {<span class="st">"train"</span>: intuit75k[intuit75k.training <span class="op">==</span> <span class="dv">1</span>], <span class="st">"test"</span>: intuit75k[intuit75k.training <span class="op">==</span> <span class="dv">0</span>]}</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> rsm.gains_plot(dct, <span class="st">"res1"</span>, <span class="st">"Yes"</span>, <span class="st">"pred_nn1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-50-output-1.png" width="606" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="nn-with-hidden-layers-sizes-2" class="level3">
<h3 class="anchored" data-anchor-id="nn-with-hidden-layers-sizes-2"><strong>NN with hidden layers sizes: (2, )</strong></h3>
<div id="a695ed5b" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>clf2 <span class="op">=</span> rsm.model.mlp(</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span> {<span class="st">'wave1'</span>:intuit75k.query(<span class="st">'training == 1'</span>)},</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    rvar<span class="op">=</span><span class="st">"res1_yes"</span>,</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    evar<span class="op">=</span>[</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip_bins'</span>,</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bizflag'</span>,</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sex'</span>,</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sincepurch'</span>,</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'numords'</span>,</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'dollars'</span>,</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'last'</span>,</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'owntaxprod'</span>,</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'version1'</span>,</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'upgraded'</span>,</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip801'</span>,</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip804'</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>    hidden_layer_sizes<span class="op">=</span>(<span class="dv">2</span>,),</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>    mod_type<span class="op">=</span><span class="st">"classification"</span>,</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>clf2.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Multi-layer Perceptron (NN)
Data                 : wave1
Response variable    : res1_yes
Level                : None
Explanatory variables: zip_bins, bizflag, sex, sincepurch, numords, dollars, last, owntaxprod, version1, upgraded, zip801, zip804
Model type           : classification
Nr. of features      : (12, 31)
Nr. of observations  : 52,500
Hidden_layer_sizes   : (2,)
Activation function  : tanh
Solver               : lbfgs
Alpha                : 0.0001
Batch size           : auto
Learning rate        : 0.001
Maximum iterations   : 10000
random_state         : 1234
AUC                  : 0.777

Raw data             :
zip_bins  bizflag  sex  sincepurch  numords  dollars  last  owntaxprod  version1  upgraded  zip801  zip804
      18        0 Male          12        2    109.5     5           0         0         0       0       0
       1        0 Male           1        1     22.0    17           0         0         0       0       0
       3        0 Male          17        1     20.0    17           0         0         1       0       0
      11        1 Male          17        1     24.5     4           0         1         0       0       0
       5        0 Male           9        3     73.5    10           0         0         0       0       0

Estimation data      :
 bizflag  sincepurch   numords   dollars      last  owntaxprod  version1  upgraded  zip801  zip804  zip_bins_2  zip_bins_3  zip_bins_4  zip_bins_5  zip_bins_6  zip_bins_7  zip_bins_8  zip_bins_9  zip_bins_10  zip_bins_11  zip_bins_12  zip_bins_13  zip_bins_14  zip_bins_15  zip_bins_16  zip_bins_17  zip_bins_18  zip_bins_19  zip_bins_20  sex_Male  sex_Unknown
       0   -0.360809 -0.057079  0.207902 -1.137183           0         0         0       0       0       False       False       False       False       False       False       False       False        False        False        False        False        False        False        False        False         True        False        False      True        False
       0   -1.458194 -0.863720 -0.873735  0.119783           0         0         0       0       0       False       False       False       False       False       False       False       False        False        False        False        False        False        False        False        False        False        False        False      True        False
       0    0.138003 -0.863720 -0.898458  0.119783           0         0         1       0       0       False        True       False       False       False       False       False       False        False        False        False        False        False        False        False        False        False        False        False      True        False
       1    0.138003 -0.863720 -0.842831 -1.241930           0         1         0       0       0       False       False       False       False       False       False       False       False        False         True        False        False        False        False        False        False        False        False        False      True        False
       0   -0.660096  0.749561 -0.237115 -0.613447           0         0         0       0       0       False       False       False        True       False       False       False       False        False        False        False        False        False        False        False        False        False        False        False      True        False</code></pre>
</div>
</div>
<div id="1b83b810" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>clf2.plot(<span class="st">"vimp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-52-output-1.png" width="566" height="996" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>In the second neural network model, which now includes two hidden layers with one node each, the permutation importance plot indicates a shift in feature influence. <code>Zip_bins</code> retains its position as the most impactful feature, but upgraded has risen in importance, surpassing last, which was more significant in the first model. This suggests that the model is now giving more weight to the upgrade status of a customer when predicting the outcome. Features like <code>numords</code> and <code>version1</code> also contribute to the model’s predictions, but to a lesser extent, while <code>dollars</code> and <code>owntaxprod</code> remain less influential.</p>
<div id="8a8ab0c7" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>clf2.plot(<span class="st">"pred"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-53-output-1.png" width="836" height="1834" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="01335516" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>intuit75k[<span class="st">'pred_nn2'</span>] <span class="op">=</span> clf2.predict(intuit75k)[<span class="st">'prediction'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="5f3a2e97" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>dct <span class="op">=</span> {<span class="st">"train"</span>: intuit75k[intuit75k.training <span class="op">==</span> <span class="dv">1</span>], <span class="st">"test"</span>: intuit75k[intuit75k.training <span class="op">==</span> <span class="dv">0</span>]}</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> rsm.gains_plot(dct, <span class="st">"res1"</span>, <span class="st">"Yes"</span>, <span class="st">"pred_nn2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-55-output-1.png" width="606" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The partial dependence plots offer a more detailed look into the relationships between each feature and the model’s predictions. The <code>zip_bins</code> plot continues to show that lower bin values are associated with a higher probability of a positive response, reinforcing its top importance. The upgraded feature shows an upward trend, which aligns with its increased importance, suggesting that customers who have upgraded are more likely to have a positive response. Other features, such as <code>numords</code>, <code>last</code>, <code>version1</code>, and <code>owntaxprod</code>, show relatively flat trends, indicating a less significant effect on the prediction. These plots further confirm the model’s reliance on geographical segmentation and upgrade status, while time since last activity has become relatively less important compared to the first model.</p>
<p>As indicated by the prediction plots above, we see that by adding more hidden layers, our neural network become more flexible. However, the flexibility of the model can still be increased, and we will want to consider building an even more flexible model.</p>
</section>
<section id="nn-with-1-hidden-layer-and-3-nodes" class="level3">
<h3 class="anchored" data-anchor-id="nn-with-1-hidden-layer-and-3-nodes"><strong>NN with 1 hidden layer and 3 nodes</strong></h3>
<div id="3b635f0b" class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>clf3a <span class="op">=</span> rsm.model.mlp(</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span> {<span class="st">'wave1'</span>:intuit75k.query(<span class="st">'training == 1'</span>)},</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    rvar<span class="op">=</span><span class="st">"res1_yes"</span>,</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    evar<span class="op">=</span>[</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip_bins'</span>,</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bizflag'</span>,</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sex'</span>,</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sincepurch'</span>,</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'numords'</span>,</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'dollars'</span>,</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'last'</span>,</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'owntaxprod'</span>,</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'version1'</span>,</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'upgraded'</span>,</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip801'</span>,</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip804'</span></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>    hidden_layer_sizes<span class="op">=</span>(<span class="dv">3</span>,),</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>    mod_type<span class="op">=</span><span class="st">"classification"</span>,</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>clf3a.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Multi-layer Perceptron (NN)
Data                 : wave1
Response variable    : res1_yes
Level                : None
Explanatory variables: zip_bins, bizflag, sex, sincepurch, numords, dollars, last, owntaxprod, version1, upgraded, zip801, zip804
Model type           : classification
Nr. of features      : (12, 31)
Nr. of observations  : 52,500
Hidden_layer_sizes   : (3,)
Activation function  : tanh
Solver               : lbfgs
Alpha                : 0.0001
Batch size           : auto
Learning rate        : 0.001
Maximum iterations   : 10000
random_state         : 1234
AUC                  : 0.778

Raw data             :
zip_bins  bizflag  sex  sincepurch  numords  dollars  last  owntaxprod  version1  upgraded  zip801  zip804
      18        0 Male          12        2    109.5     5           0         0         0       0       0
       1        0 Male           1        1     22.0    17           0         0         0       0       0
       3        0 Male          17        1     20.0    17           0         0         1       0       0
      11        1 Male          17        1     24.5     4           0         1         0       0       0
       5        0 Male           9        3     73.5    10           0         0         0       0       0

Estimation data      :
 bizflag  sincepurch   numords   dollars      last  owntaxprod  version1  upgraded  zip801  zip804  zip_bins_2  zip_bins_3  zip_bins_4  zip_bins_5  zip_bins_6  zip_bins_7  zip_bins_8  zip_bins_9  zip_bins_10  zip_bins_11  zip_bins_12  zip_bins_13  zip_bins_14  zip_bins_15  zip_bins_16  zip_bins_17  zip_bins_18  zip_bins_19  zip_bins_20  sex_Male  sex_Unknown
       0   -0.360809 -0.057079  0.207902 -1.137183           0         0         0       0       0       False       False       False       False       False       False       False       False        False        False        False        False        False        False        False        False         True        False        False      True        False
       0   -1.458194 -0.863720 -0.873735  0.119783           0         0         0       0       0       False       False       False       False       False       False       False       False        False        False        False        False        False        False        False        False        False        False        False      True        False
       0    0.138003 -0.863720 -0.898458  0.119783           0         0         1       0       0       False        True       False       False       False       False       False       False        False        False        False        False        False        False        False        False        False        False        False      True        False
       1    0.138003 -0.863720 -0.842831 -1.241930           0         1         0       0       0       False       False       False       False       False       False       False       False        False         True        False        False        False        False        False        False        False        False        False      True        False
       0   -0.660096  0.749561 -0.237115 -0.613447           0         0         0       0       0       False       False       False        True       False       False       False       False        False        False        False        False        False        False        False        False        False        False        False      True        False</code></pre>
</div>
</div>
<div id="316cba7e" class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>clf3a.plot(<span class="st">'vimp'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-57-output-1.png" width="566" height="996" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>In the third model, which is a neural network with one hidden layer and three nodes, the permutation importance plot shows a slight rearrangement in feature importance. <code>Zip_bins</code> continues to be the leading factor, suggesting that geographic segmentation remains a key predictor in the model. The feature upgraded retains substantial importance, affirming its strong predictive power regarding the response variable. Interestingly, <code>version1</code> has increased in importance compared to the previous models, hinting that the specific version of a product or service is becoming more relevant in the model’s predictions. <code>Last</code> and <code>numords</code> follow in importance, indicating they are useful but less decisive in influencing the model’s outcome.</p>
<div id="87c774e5" class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>clf3a.plot(<span class="st">'pred'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-58-output-1.png" width="836" height="1834" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The partial dependence plots reveal the following insights:</p>
<ul>
<li><code>Zip_bins</code> shows a sharp decline, indicating a strong relationship between lower bin values and the likelihood of a positive response.</li>
<li>The effect of <code>numords</code> is relatively flat, suggesting a limited influence on the predicted outcome.</li>
<li>The last feature shows a downward trend, implying that more recent interactions might correspond to a lower probability of a positive outcome, which is consistent with its position in the permutation importance plot.</li>
<li>The upgraded plot has an upward trend, reinforcing its role as an influential predictor, as higher values correlate with a greater likelihood of a positive outcome.</li>
</ul>
<p>The consistency of zip_bins and upgraded across all models as top predictors underlines their significance in determining the response variable. The rise of version1 in importance could indicate that the model is beginning to capture more nuanced patterns as the complexity of the network increases. However, features like <code>dollars</code> and <code>owntaxprod</code> remain less impactful, suggesting that they might not be as crucial for the model’s decision-making process or that their effects are possibly being captured indirectly through interactions with other features.</p>
<div id="df15558b" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>intuit75k[<span class="st">'pred_nn3a'</span>] <span class="op">=</span> clf3a.predict(intuit75k)[<span class="st">'prediction'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="nn-with-2-nodes-and-10-hidden-layers" class="level3">
<h3 class="anchored" data-anchor-id="nn-with-2-nodes-and-10-hidden-layers"><strong>NN with 2 nodes and 10 hidden layers</strong></h3>
<div id="a688f234" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>clf10 <span class="op">=</span> rsm.model.mlp(</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {<span class="st">'wave1'</span>:intuit75k.query(<span class="st">'training == 1'</span>)},</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    rvar <span class="op">=</span> <span class="st">'res1_yes'</span>,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    evar <span class="op">=</span> [</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip_bins'</span>,</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sex'</span>,</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'numords'</span>,</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bizflag'</span>,</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'dollars'</span>,</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'last'</span>,</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'owntaxprod'</span>,</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sincepurch'</span>,</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'version1'</span>,</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'upgraded'</span>,</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip801'</span>,</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip804'</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>    hidden_layer_sizes <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">10</span>),</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>    mod_type <span class="op">=</span> <span class="st">'classification'</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>clf10.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Multi-layer Perceptron (NN)
Data                 : wave1
Response variable    : res1_yes
Level                : None
Explanatory variables: zip_bins, sex, numords, bizflag, dollars, last, owntaxprod, sincepurch, version1, upgraded, zip801, zip804
Model type           : classification
Nr. of features      : (12, 31)
Nr. of observations  : 52,500
Hidden_layer_sizes   : (10, 10)
Activation function  : tanh
Solver               : lbfgs
Alpha                : 0.0001
Batch size           : auto
Learning rate        : 0.001
Maximum iterations   : 10000
random_state         : 1234
AUC                  : 0.838

Raw data             :
zip_bins  sex  numords  bizflag  dollars  last  owntaxprod  sincepurch  version1  upgraded  zip801  zip804
      18 Male        2        0    109.5     5           0          12         0         0       0       0
       1 Male        1        0     22.0    17           0           1         0         0       0       0
       3 Male        1        0     20.0    17           0          17         0         1       0       0
      11 Male        1        1     24.5     4           0          17         1         0       0       0
       5 Male        3        0     73.5    10           0           9         0         0       0       0

Estimation data      :
  numords  bizflag   dollars      last  owntaxprod  sincepurch  version1  upgraded  zip801  zip804  zip_bins_2  zip_bins_3  zip_bins_4  zip_bins_5  zip_bins_6  zip_bins_7  zip_bins_8  zip_bins_9  zip_bins_10  zip_bins_11  zip_bins_12  zip_bins_13  zip_bins_14  zip_bins_15  zip_bins_16  zip_bins_17  zip_bins_18  zip_bins_19  zip_bins_20  sex_Male  sex_Unknown
-0.057079        0  0.207902 -1.137183           0   -0.360809         0         0       0       0       False       False       False       False       False       False       False       False        False        False        False        False        False        False        False        False         True        False        False      True        False
-0.863720        0 -0.873735  0.119783           0   -1.458194         0         0       0       0       False       False       False       False       False       False       False       False        False        False        False        False        False        False        False        False        False        False        False      True        False
-0.863720        0 -0.898458  0.119783           0    0.138003         0         1       0       0       False        True       False       False       False       False       False       False        False        False        False        False        False        False        False        False        False        False        False      True        False
-0.863720        1 -0.842831 -1.241930           0    0.138003         1         0       0       0       False       False       False       False       False       False       False       False        False         True        False        False        False        False        False        False        False        False        False      True        False
 0.749561        0 -0.237115 -0.613447           0   -0.660096         0         0       0       0       False       False       False        True       False       False       False       False        False        False        False        False        False        False        False        False        False        False        False      True        False</code></pre>
</div>
</div>
<div id="1e1f0a49" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>clf10.plot(<span class="st">'vimp'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-61-output-1.png" width="566" height="996" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="dfabea1e" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>clf10.plot(<span class="st">'pred'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-62-output-1.png" width="836" height="1834" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="767182ce" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>intuit75k[<span class="st">'pred_nn10'</span>] <span class="op">=</span> clf10.predict(intuit75k)[<span class="st">'prediction'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="68a8db07" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>dct <span class="op">=</span> {<span class="st">"train"</span>: intuit75k[intuit75k.training <span class="op">==</span> <span class="dv">1</span>], <span class="st">"test"</span>: intuit75k[intuit75k.training <span class="op">==</span> <span class="dv">0</span>]}</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> rsm.gains_plot(dct, <span class="st">"res1"</span>, <span class="st">"Yes"</span>, <span class="st">"pred_nn10"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-64-output-1.png" width="606" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>For the latest neural network model with two nodes in each of ten hidden layers, the summary and permutation importance plot provide insights into its learning process. This more complex model architecture did not converge, which suggests that the optimization algorithm (likely L-BFGS) was unable to find a solution that minimally satisfies the problem constraints within the iteration limit. This might be due to an insufficient number of iterations, a need for better scaling of input data, or an overly complex model for the given data.</p>
<p>The permutation importance plot for this non-converged model indicates that zip_bins remains the most critical feature, followed by upgraded and last, which is consistent with previous models. This underscores the model’s reliance on geographic data, upgrade status, and recent activity as key determinants of the predicted outcome. Other features such as numords, version1, and dollars continue to be relevant, but their impact on the model’s predictions is less pronounced.</p>
<p>Without convergence, however, the reliability of these importance scores might be compromised. It’s also important to note that without a properly converged model, any interpretation of the feature importances and relationships should be taken with caution. Adjusting the model’s parameters or preprocessing the input data could help achieve convergence and provide more reliable insights into the importance and effects of different features on the model’s predictions.</p>
</section>
<section id="evaluating-neural-network-performance-from-gains-chart" class="level3">
<h3 class="anchored" data-anchor-id="evaluating-neural-network-performance-from-gains-chart"><strong>Evaluating Neural Network Performance from Gains Chart</strong></h3>
<div id="c2635444" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>intuit75k.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">zip5</th>
<th data-quarto-table-cell-role="th">zip_bins</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">bizflag</th>
<th data-quarto-table-cell-role="th">numords</th>
<th data-quarto-table-cell-role="th">dollars</th>
<th data-quarto-table-cell-role="th">last</th>
<th data-quarto-table-cell-role="th">sincepurch</th>
<th data-quarto-table-cell-role="th">version1</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">training</th>
<th data-quarto-table-cell-role="th">res1_yes</th>
<th data-quarto-table-cell-role="th">zip801</th>
<th data-quarto-table-cell-role="th">zip804</th>
<th data-quarto-table-cell-role="th">pred_logit</th>
<th data-quarto-table-cell-role="th">pred_nn0</th>
<th data-quarto-table-cell-role="th">pred_nn1</th>
<th data-quarto-table-cell-role="th">pred_nn2</th>
<th data-quarto-table-cell-role="th">pred_nn3a</th>
<th data-quarto-table-cell-role="th">pred_nn10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>94553</td>
<td>18</td>
<td>Male</td>
<td>0</td>
<td>2</td>
<td>109.5</td>
<td>5</td>
<td>12</td>
<td>0</td>
<td>...</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.044161</td>
<td>0.039253</td>
<td>0.039253</td>
<td>0.046232</td>
<td>0.043931</td>
<td>0.040564</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2</td>
<td>53190</td>
<td>10</td>
<td>Unknown</td>
<td>0</td>
<td>1</td>
<td>69.5</td>
<td>4</td>
<td>3</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.022178</td>
<td>0.020067</td>
<td>0.020067</td>
<td>0.029727</td>
<td>0.027086</td>
<td>0.018918</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3</td>
<td>37091</td>
<td>8</td>
<td>Male</td>
<td>0</td>
<td>4</td>
<td>93.0</td>
<td>14</td>
<td>29</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.091385</td>
<td>0.094208</td>
<td>0.094208</td>
<td>0.075088</td>
<td>0.073340</td>
<td>0.151937</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4</td>
<td>02125</td>
<td>1</td>
<td>Male</td>
<td>0</td>
<td>1</td>
<td>22.0</td>
<td>17</td>
<td>1</td>
<td>0</td>
<td>...</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.011381</td>
<td>0.011572</td>
<td>0.011572</td>
<td>0.012489</td>
<td>0.008148</td>
<td>0.022096</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>60201</td>
<td>11</td>
<td>Male</td>
<td>0</td>
<td>1</td>
<td>24.5</td>
<td>2</td>
<td>3</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.025147</td>
<td>0.024115</td>
<td>0.024115</td>
<td>0.021093</td>
<td>0.024610</td>
<td>0.009841</td>
</tr>
</tbody>
</table>

<p>5 rows × 23 columns</p>
</div>
</div>
</div>
</div>
<div id="a0040e90" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> rsm.gains_plot(intuit75k[intuit75k.training <span class="op">==</span> <span class="dv">1</span>],</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"res1"</span>, <span class="st">"Yes"</span>,</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"pred_logit"</span>, <span class="st">"pred_nn0"</span>,<span class="st">"pred_nn1"</span>, <span class="st">"pred_nn2"</span>, <span class="st">"pred_nn3a"</span>, <span class="st">"pred_nn10"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-66-output-1.png" width="606" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The gains chart provided compares the performance of three predictive models: a logistic regression model (pred_logit) and two neural network models (pred_nn1 and pred_nn2). The chart plots the percentage of positive outcomes (buyers) captured against the percentage of the population targeted based on the model’s predictions.</p>
<p>All models perform above the diagonal line, which represents random chance; this indicates that each model has predictive power beyond mere guessing. The chart shows that the logistic regression and the first neural network model (pred_nn1) have similar performance, capturing nearly the same percentage of buyers across the population targeted. The second neural network model (pred_nn2) appears to perform slightly better, capturing a marginally higher percentage of buyers for most of the population percentages targeted. This suggests that pred_nn2 may have a more nuanced understanding of the data, possibly due to a more complex model structure, and is able to more accurately identify potential buyers.</p>
<p>However, the differences between the models are not drastic, which implies that the complexity added in the neural network models may not be translating into significantly better performance over the logistic regression in this case. The closeness of their performances also suggests that the relationships within the data might be captured almost as effectively by the simpler logistic regression model as by the more complex neural network models.</p>
<div id="bedf0888" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>dct <span class="op">=</span> {<span class="st">"train"</span>: intuit75k[intuit75k.training <span class="op">==</span> <span class="dv">1</span>], <span class="st">"test"</span>: intuit75k[intuit75k.training <span class="op">==</span> <span class="dv">0</span>]}</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> rsm.gains_plot(dct, <span class="st">"res1"</span>, <span class="st">"Yes"</span>, [<span class="st">"pred_logit"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-67-output-1.png" width="606" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Both the training and test curves lie above the diagonal, indicating that the logistic regression model has learned to identify buyers more effectively than random chance. The closeness of the two lines suggests that the model generalizes well; it performs similarly on both the training data (seen data) and the test data (unseen data). This is indicative of a good model fit without overfitting, as overfitting would typically be revealed by a high performance on the training data but a significantly lower performance on the test data.</p>
<p>The chart shows that as you target more of the population based on the model’s predictions, you capture a higher percentage of buyers. Both lines show a relatively steady and linear increase, suggesting that the model ranks potential buyers effectively across the entire dataset. There’s no sharp increase at the beginning, which would suggest that there’s a subset of the population with a significantly higher likelihood of buying. Instead, the model’s predictions are spread out across the population, capturing buyers at a fairly uniform rate as more of the population is targeted.</p>
<div id="3f188a26" class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> rsm.gains_plot(dct, <span class="st">"res1"</span>, <span class="st">"Yes"</span>, <span class="st">"pred_nn0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-68-output-1.png" width="606" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="737a9cc5" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> rsm.gains_plot(dct, <span class="st">"res1"</span>, <span class="st">"Yes"</span>, <span class="st">"pred_nn1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-69-output-1.png" width="606" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="820b8a93" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> rsm.gains_plot(dct, <span class="st">"res1"</span>, <span class="st">"Yes"</span>, <span class="st">"pred_nn2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-70-output-1.png" width="606" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>This gains chart displays the performance of the second neural network model (pred_nn2) on both the training and test datasets. The chart demonstrates that the model is effective at identifying buyers, as indicated by the curves lying well above the diagonal line representing random selection.</p>
<p>The performance on the training data is very close to the performance on the test data, which suggests that the model generalizes well and is not overfitting. Overfitting would be indicated by a high performance on the training data but significantly worse performance on the test data. The fact that both curves are almost superimposed on each other indicates that the patterns the model has learned from the training data are applicable to the unseen test data.</p>
<p>Additionally, the curves are steeper at the beginning, which means that targeting a smaller percentage of the population based on the model’s predictions can capture a larger percentage of buyers. This is a desirable trait in a model used for prioritizing which segments of a population to target for marketing or intervention efforts. The model seems to rank potential buyers effectively, identifying those most likely to purchase early on as the population is targeted incrementally. This can be particularly valuable in applications where it is cost-effective to target only a subset of the entire population.</p>
</section>
<section id="model-tuning" class="level3">
<h3 class="anchored" data-anchor-id="model-tuning"><strong>Model Tuning</strong></h3>
<div id="2dc99ab7" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>hls <span class="op">=</span> [(<span class="dv">1</span>,), (<span class="dv">2</span>,), (<span class="dv">3</span>,), (<span class="dv">3</span>, <span class="dv">3</span>), (<span class="dv">4</span>, <span class="dv">2</span>), (<span class="dv">5</span>, <span class="dv">5</span>)]</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {<span class="st">"hidden_layer_sizes"</span>: hls}</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>scoring <span class="op">=</span> {<span class="st">"AUC"</span>: <span class="st">"roc_auc"</span>}</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>clf_cv <span class="op">=</span> GridSearchCV(</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    clf0.fitted, param_grid, scoring<span class="op">=</span>scoring, cv<span class="op">=</span><span class="dv">5</span>, n_jobs<span class="op">=</span><span class="dv">4</span>, refit<span class="op">=</span><span class="st">"AUC"</span>, verbose<span class="op">=</span><span class="dv">5</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>clf0.data_onehot.mean().<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>clf0.data.res1_yes</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>clf_cv.fit(clf0.data_onehot, clf0.data.res1_yes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting 5 folds for each of 6 candidates, totalling 30 fits</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="70">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</a></style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=5,
             estimator=MLPClassifier(activation='tanh', hidden_layer_sizes=(1,),
                                     max_iter=10000, random_state=1234,
                                     solver='lbfgs'),
             n_jobs=4,
             param_grid={'hidden_layer_sizes': [(1,), (2,), (3,), (3, 3),
                                                (4, 2), (5, 5)]},
             refit='AUC', scoring={'AUC': 'roc_auc'}, verbose=5)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox"><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;GridSearchCV<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.model_selection.GridSearchCV.html">?<span>Documentation for GridSearchCV</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>GridSearchCV(cv=5,
             estimator=MLPClassifier(activation='tanh', hidden_layer_sizes=(1,),
                                     max_iter=10000, random_state=1234,
                                     solver='lbfgs'),
             n_jobs=4,
             param_grid={'hidden_layer_sizes': [(1,), (2,), (3,), (3, 3),
                                                (4, 2), (5, 5)]},
             refit='AUC', scoring={'AUC': 'roc_auc'}, verbose=5)</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox"><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">estimator: MLPClassifier</label><div class="sk-toggleable__content fitted"><pre>MLPClassifier(activation='tanh', hidden_layer_sizes=(1,), max_iter=10000,
              random_state=1234, solver='lbfgs')</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox"><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;MLPClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.neural_network.MLPClassifier.html">?<span>Documentation for MLPClassifier</span></a></label><div class="sk-toggleable__content fitted"><pre>MLPClassifier(activation='tanh', hidden_layer_sizes=(1,), max_iter=10000,
              random_state=1234, solver='lbfgs')</pre></div> </div></div></div></div></div></div></div></div></div>
</div>
</div>
<div id="82dde1f9" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(clf_cv.cv_results_).iloc[:, <span class="dv">5</span>:].sort_values(<span class="st">"rank_test_AUC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">params</th>
<th data-quarto-table-cell-role="th">split0_test_AUC</th>
<th data-quarto-table-cell-role="th">split1_test_AUC</th>
<th data-quarto-table-cell-role="th">split2_test_AUC</th>
<th data-quarto-table-cell-role="th">split3_test_AUC</th>
<th data-quarto-table-cell-role="th">split4_test_AUC</th>
<th data-quarto-table-cell-role="th">mean_test_AUC</th>
<th data-quarto-table-cell-role="th">std_test_AUC</th>
<th data-quarto-table-cell-role="th">rank_test_AUC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>{'hidden_layer_sizes': (2,)}</td>
<td>0.758255</td>
<td>0.770282</td>
<td>0.782662</td>
<td>0.765579</td>
<td>0.773062</td>
<td>0.769968</td>
<td>0.008090</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>{'hidden_layer_sizes': (3,)}</td>
<td>0.754724</td>
<td>0.764858</td>
<td>0.778597</td>
<td>0.761457</td>
<td>0.774358</td>
<td>0.766799</td>
<td>0.008654</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>{'hidden_layer_sizes': (3, 3)}</td>
<td>0.742551</td>
<td>0.755067</td>
<td>0.780358</td>
<td>0.769203</td>
<td>0.773344</td>
<td>0.764104</td>
<td>0.013578</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>{'hidden_layer_sizes': (1,)}</td>
<td>0.748561</td>
<td>0.756562</td>
<td>0.773532</td>
<td>0.763431</td>
<td>0.777387</td>
<td>0.763895</td>
<td>0.010621</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>{'hidden_layer_sizes': (4, 2)}</td>
<td>0.735937</td>
<td>0.756075</td>
<td>0.769769</td>
<td>0.757250</td>
<td>0.745491</td>
<td>0.752904</td>
<td>0.011456</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>{'hidden_layer_sizes': (5, 5)}</td>
<td>0.718748</td>
<td>0.740427</td>
<td>0.741733</td>
<td>0.735261</td>
<td>0.751256</td>
<td>0.737485</td>
<td>0.010699</td>
<td>6</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="96ed096c" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>clf_cv.best_params_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<pre><code>{'hidden_layer_sizes': (2,)}</code></pre>
</div>
</div>
</section>
<section id="retrain-model-with-hidden-layers-sizes-3-3" class="level3">
<h3 class="anchored" data-anchor-id="retrain-model-with-hidden-layers-sizes-3-3"><strong>Retrain model with hidden layers sizes: (3, 3)</strong></h3>
<div id="5b867d5d" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>clf3 <span class="op">=</span> rsm.model.mlp(</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {<span class="st">'wave1'</span>:intuit75k[intuit75k.training <span class="op">==</span> <span class="dv">1</span>]},</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>    rvar<span class="op">=</span><span class="st">"res1_yes"</span>,</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>    evar<span class="op">=</span> [<span class="st">'zip_bins'</span>,</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sex'</span>,</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'numords'</span>,</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bizflag'</span>,</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'dollars'</span>,</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'last'</span>,</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'owntaxprod'</span>,</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sincepurch'</span>,</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'version1'</span>,</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'upgraded'</span>,</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip801'</span>,</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip804'</span> </span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>    hidden_layer_sizes <span class="op">=</span> (<span class="dv">3</span>,<span class="dv">3</span>),</span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>    mod_type <span class="op">=</span> <span class="st">'classification'</span></span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>clf3.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Multi-layer Perceptron (NN)
Data                 : wave1
Response variable    : res1_yes
Level                : None
Explanatory variables: zip_bins, sex, numords, bizflag, dollars, last, owntaxprod, sincepurch, version1, upgraded, zip801, zip804
Model type           : classification
Nr. of features      : (12, 31)
Nr. of observations  : 52,500
Hidden_layer_sizes   : (3, 3)
Activation function  : tanh
Solver               : lbfgs
Alpha                : 0.0001
Batch size           : auto
Learning rate        : 0.001
Maximum iterations   : 10000
random_state         : 1234
AUC                  : 0.782

Raw data             :
zip_bins  sex  numords  bizflag  dollars  last  owntaxprod  sincepurch  version1  upgraded  zip801  zip804
      18 Male        2        0    109.5     5           0          12         0         0       0       0
       1 Male        1        0     22.0    17           0           1         0         0       0       0
       3 Male        1        0     20.0    17           0          17         0         1       0       0
      11 Male        1        1     24.5     4           0          17         1         0       0       0
       5 Male        3        0     73.5    10           0           9         0         0       0       0

Estimation data      :
  numords  bizflag   dollars      last  owntaxprod  sincepurch  version1  upgraded  zip801  zip804  zip_bins_2  zip_bins_3  zip_bins_4  zip_bins_5  zip_bins_6  zip_bins_7  zip_bins_8  zip_bins_9  zip_bins_10  zip_bins_11  zip_bins_12  zip_bins_13  zip_bins_14  zip_bins_15  zip_bins_16  zip_bins_17  zip_bins_18  zip_bins_19  zip_bins_20  sex_Male  sex_Unknown
-0.057079        0  0.207902 -1.137183           0   -0.360809         0         0       0       0       False       False       False       False       False       False       False       False        False        False        False        False        False        False        False        False         True        False        False      True        False
-0.863720        0 -0.873735  0.119783           0   -1.458194         0         0       0       0       False       False       False       False       False       False       False       False        False        False        False        False        False        False        False        False        False        False        False      True        False
-0.863720        0 -0.898458  0.119783           0    0.138003         0         1       0       0       False        True       False       False       False       False       False       False        False        False        False        False        False        False        False        False        False        False        False      True        False
-0.863720        1 -0.842831 -1.241930           0    0.138003         1         0       0       0       False       False       False       False       False       False       False       False        False         True        False        False        False        False        False        False        False        False        False      True        False
 0.749561        0 -0.237115 -0.613447           0   -0.660096         0         0       0       0       False       False       False        True       False       False       False       False        False        False        False        False        False        False        False        False        False        False        False      True        False</code></pre>
</div>
</div>
<p>An AUC (Area Under the ROC Curve) of 0.761 means that the model has a good ability to distinguish between the positive and negative classes. In other words, when the model predicts whether a new, unseen instance belongs to one class or the other, it is correct 76.1% of the time.</p>
<div id="bfe99232" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>clf3.plot(<span class="st">'vimp'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-75-output-1.png" width="566" height="996" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>In this plot, zip_bins appears to be the most important feature, followed by upgraded and last. Numords and Version1 also have an impact on the model, but not as much as the preceding 3. The length of the bars indicates that zip_bins has the highest impact on model performance, whereas dollars and owntaxprod have the least impact among the shown features.</p>
<div id="4f4dcc87" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>intuit75k[<span class="st">'pred_nn3'</span>] <span class="op">=</span> clf3.predict(intuit75k)[<span class="st">'prediction'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="1146bca3" class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>dct <span class="op">=</span> {<span class="st">"train"</span>: intuit75k[intuit75k.training <span class="op">==</span> <span class="dv">1</span>], <span class="st">"test"</span>: intuit75k[intuit75k.training <span class="op">==</span> <span class="dv">0</span>]}</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> rsm.gains_plot(dct, <span class="st">"res1"</span>, <span class="st">"Yes"</span>, <span class="st">"pred_nn3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-77-output-1.png" width="606" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Both lines exhibit a steep curve towards the lower percentage of the population targeted, indicating that the model is effectively ranking buyers higher than non-buyers. The performance on the training set is better than on the test set, which is typical as models tend to perform better on the data they were trained on. However, since the test line follows closely to the training line, it suggests that the model generalizes well and is not overfitting significantly.</p>
<div id="2c26cd35" class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> metrics</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="co"># prediction on training set</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> intuit75k.loc[intuit75k.training <span class="op">==</span> <span class="dv">1</span>, <span class="st">"pred_nn3"</span>]</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>actual <span class="op">=</span> intuit75k.loc[intuit75k.training <span class="op">==</span> <span class="dv">1</span>, <span class="st">"res1_yes"</span>]</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thresholds <span class="op">=</span> metrics.roc_curve(actual, pred)</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>metrics.auc(fpr, tpr).<span class="bu">round</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="77">
<pre><code>0.782</code></pre>
</div>
</div>
<p>An AUC (Area Under the ROC Curve) of 0.761 means that the model has a good ability to distinguish between the positive and negative classes. In other words, when the model predicts whether a new, unseen instance belongs to one class or the other, it is correct 76.1% of the time.</p>
<div id="e836112b" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prediction on test set</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>pred <span class="op">=</span> intuit75k.loc[intuit75k.training <span class="op">==</span> <span class="dv">0</span>, <span class="st">"pred_nn3"</span>]</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>actual <span class="op">=</span> intuit75k.loc[intuit75k.training <span class="op">==</span> <span class="dv">0</span>, <span class="st">"res1_yes"</span>]</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thresholds <span class="op">=</span> metrics.roc_curve(actual, pred)</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>metrics.auc(fpr, tpr).<span class="bu">round</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="78">
<pre><code>0.762</code></pre>
</div>
</div>
<p>An AUC (Area Under the ROC Curve) of 0.755 means that the model has a good ability to distinguish between the positive and negative classes. In other words, when the model predicts whether a new, unseen instance belongs to one class or the other, it is correct 75.5% of the time.</p>
<p>The difference between the training AUC and the test AUC is 0.007, which is very small. This means that the model is not overfitting.</p>
<div id="69d57e29" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> rsm.gains_plot(</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>    intuit75k[intuit75k.training <span class="op">==</span> <span class="dv">1</span>],</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"res1"</span>, <span class="st">"Yes"</span>,</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"pred_logit"</span>, <span class="st">"pred_nn3"</span>]</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-80-output-1.png" width="606" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="interpretation-of-model-tuning" class="level4">
<h4 class="anchored" data-anchor-id="interpretation-of-model-tuning"><strong>Interpretation of model tuning</strong></h4>
<p>Both curves in the graphs are increasing and following a similar trends, which suggests that the models are likely effective at targeting buyers. The distance between the two curves suggests that the neural network model outperforming the logistic regression model.Let’s try to improve the logistic regression model by checking the interactons between the variables.</p>
<section id="interactions-version-1-numords-and-last" class="level5">
<h5 class="anchored" data-anchor-id="interactions-version-1-numords-and-last">Interactions: version 1, numords and last</h5>
<div id="838320bb" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>clf3.plot(<span class="st">'pred'</span>, incl <span class="op">=</span> [], incl_int <span class="op">=</span> [<span class="st">"last:version1"</span>, <span class="st">"numords:version1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-81-output-1.png" width="820" height="323" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="e2b5e0f0" class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>lr.plot(<span class="st">'pred'</span>, incl <span class="op">=</span> [], incl_int <span class="op">=</span> [<span class="st">"last:version1"</span>, <span class="st">"numords:version1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-82-output-1.png" width="820" height="323" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="6b6c3a16" class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>lr_int <span class="op">=</span> rsm.model.logistic(</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {<span class="st">'wave1'</span>:intuit75k.query(<span class="st">'training == 1'</span>)},</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>    rvar <span class="op">=</span> <span class="st">'res1_yes'</span>,</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>    evar <span class="op">=</span> [</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip_bins'</span>,</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sex'</span>,</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'numords'</span>,</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'bizflag'</span>,</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'dollars'</span>,</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'last'</span>,</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'owntaxprod'</span>,</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sincepurch'</span>,</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'version1'</span>,</span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'upgraded'</span>,</span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip801'</span>,</span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'zip804'</span></span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>    ivar <span class="op">=</span> [<span class="st">"numords:version1"</span>, <span class="st">"last:version1"</span>]</span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>lr_int.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Logistic regression (GLM)
Data                 : wave1
Response variable    : res1_yes
Level                : None
Explanatory variables: zip_bins, sex, numords, bizflag, dollars, last, owntaxprod, sincepurch, version1, upgraded, zip801, zip804
Null hyp.: There is no effect of x on res1_yes
Alt. hyp.: There is an effect of x on res1_yes

                      OR      OR%  coefficient  std.error  z.value p.value     
Intercept          0.021   -97.9%        -3.85      0.176  -21.910  &lt; .001  ***
zip_bins[2]        1.296    29.6%         0.26      0.181    1.436   0.151     
zip_bins[3]        1.034     3.4%         0.03      0.187    0.181   0.857     
zip_bins[4]        1.180    18.0%         0.17      0.182    0.912   0.362     
zip_bins[5]        1.015     1.5%         0.01      0.187    0.078   0.938     
zip_bins[6]        1.099     9.9%         0.09      0.183    0.514   0.607     
zip_bins[7]        1.055     5.5%         0.05      0.185    0.287   0.774     
zip_bins[8]        1.118    11.8%         0.11      0.183    0.608   0.543     
zip_bins[9]        1.074     7.4%         0.07      0.185    0.388   0.698     
zip_bins[10]       1.060     6.0%         0.06      0.185    0.314   0.753     
zip_bins[11]       1.122    12.2%         0.12      0.184    0.627   0.531     
zip_bins[12]       1.504    50.4%         0.41      0.177    2.307   0.021    *
zip_bins[13]       0.985    -1.5%        -0.02      0.188   -0.081   0.936     
zip_bins[14]       1.129    12.9%         0.12      0.183    0.664   0.507     
zip_bins[15]       1.019     1.9%         0.02      0.186    0.102   0.919     
zip_bins[16]       1.123    12.3%         0.12      0.183    0.633   0.527     
zip_bins[17]       1.119    11.9%         0.11      0.183    0.614   0.539     
zip_bins[18]       1.604    60.4%         0.47      0.175    2.695   0.007   **
zip_bins[19]       1.243    24.3%         0.22      0.181    1.201    0.23     
zip_bins[20]       1.087     8.7%         0.08      0.184    0.451   0.652     
sex[Male]          0.992    -0.8%        -0.01      0.055   -0.154   0.878     
sex[Unknown]       0.964    -3.6%        -0.04      0.078   -0.471   0.638     
numords            1.162    16.2%         0.15      0.022    6.700  &lt; .001  ***
bizflag            1.048     4.8%         0.05      0.050    0.923   0.356     
dollars            1.001     0.1%         0.00      0.000    4.208  &lt; .001  ***
last               0.966    -3.4%        -0.03      0.003  -12.244  &lt; .001  ***
owntaxprod         1.496    49.6%         0.40      0.105    3.849  &lt; .001  ***
sincepurch         1.002     0.2%         0.00      0.004    0.531   0.595     
version1           1.474    47.4%         0.39      0.151    2.572    0.01    *
upgraded           2.719   171.9%         1.00      0.088   11.371  &lt; .001  ***
zip801            25.908  2490.8%         3.25      0.164   19.831  &lt; .001  ***
zip804            18.400  1740.0%         2.91      0.250   11.661  &lt; .001  ***
numords:version1   1.397    39.7%         0.33      0.035    9.442  &lt; .001  ***
last:version1      0.959    -4.1%        -0.04      0.006   -7.089  &lt; .001  ***

Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Pseudo R-squared (McFadden): 0.156
Pseudo R-squared (McFadden adjusted): 0.153
Area under the RO Curve (AUC): 0.774
Log-likelihood: -8479.762, AIC: 17027.524, BIC: 17329.055
Chi-squared: 3130.12, df(33), p.value &lt; 0.001 
Nr obs: 52,500</code></pre>
</div>
</div>
<p>The output shows the summary of a logistic regression model indicating that all included explanatory variables and their interactions (version1:zip_bins, zip_bins:upgraded, owntaxprod:zip_bins) are statistically significant in predicting the response variable res1_yes, with the model achieving an AUC of 0.717, which suggests a good predictive performance.</p>
<div id="36dedebc" class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>intuit75k[<span class="st">'pred_logit_int'</span>] <span class="op">=</span> lr_int.predict(intuit75k)[<span class="st">'prediction'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="f214774e" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> rsm.gains_plot(</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>    intuit75k[intuit75k.training <span class="op">==</span> <span class="dv">1</span>],</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"res1"</span>, <span class="st">"Yes"</span>,</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"pred_logit_int"</span>, <span class="st">"pred_nn2"</span>]</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-85-output-1.png" width="606" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Both models show an increasing trend, meaning they are effectively ranking individuals more likely to be positive cases higher. The pred_logit_int model performs slightly better than pred_nn3, particularly at lower percentages of the population targeted, indicating a more efficient prioritization of likely positive cases by the logistic regression model with interactions (pred_logit_int).</p>
</section>
</section>
</section>
<section id="calculating-the-accuracy-of-the-models" class="level3">
<h3 class="anchored" data-anchor-id="calculating-the-accuracy-of-the-models"><strong>Calculating the Accuracy of the models</strong></h3>
<div id="a2dc9eb0" class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> classification(actual, predicted):</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>    TP <span class="op">=</span> FP <span class="op">=</span> TN <span class="op">=</span> FN <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, j <span class="kw">in</span> <span class="bu">zip</span>(actual, predicted):</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">==</span> <span class="dv">1</span> <span class="kw">and</span> j <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>            TP <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> i <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> j <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>            FP <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> i <span class="op">==</span> <span class="dv">0</span> <span class="kw">and</span> j <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>            TN <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> i <span class="op">==</span> <span class="dv">1</span> <span class="kw">and</span> j <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>            FN <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>    metrics <span class="op">=</span> {</span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Accuracy"</span>: (TN <span class="op">+</span> TP) <span class="op">/</span> (TN <span class="op">+</span> TP <span class="op">+</span> FN <span class="op">+</span> FP) <span class="cf">if</span> (TN <span class="op">+</span> TP <span class="op">+</span> FN <span class="op">+</span> FP) <span class="cf">else</span> <span class="dv">0</span>, </span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Precision"</span>: TP <span class="op">/</span> (TP <span class="op">+</span> FP) <span class="cf">if</span> (TP <span class="op">+</span> FP) <span class="cf">else</span> <span class="dv">0</span>,</span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Recall"</span>: TP <span class="op">/</span> (TP <span class="op">+</span> FN) <span class="cf">if</span> (TP <span class="op">+</span> FN) <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> metrics</span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prediction_metrics(data, models, predictions, break_even):</span>
<span id="cb114-20"><a href="#cb114-20" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb114-21"><a href="#cb114-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> model, prediction <span class="kw">in</span> <span class="bu">zip</span>(models, predictions):</span>
<span id="cb114-22"><a href="#cb114-22" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">'prediction'</span>] <span class="op">=</span> [<span class="dv">1</span> <span class="cf">if</span> i <span class="op">&gt;</span> break_even <span class="cf">else</span> <span class="dv">0</span> <span class="cf">for</span> i <span class="kw">in</span> data[prediction]]</span>
<span id="cb114-23"><a href="#cb114-23" aria-hidden="true" tabindex="-1"></a>        actual <span class="op">=</span> data[<span class="st">'res1_yes'</span>]</span>
<span id="cb114-24"><a href="#cb114-24" aria-hidden="true" tabindex="-1"></a>        predicted <span class="op">=</span> data[<span class="st">'prediction'</span>]</span>
<span id="cb114-25"><a href="#cb114-25" aria-hidden="true" tabindex="-1"></a>        metrics <span class="op">=</span> classification(actual, predicted)</span>
<span id="cb114-26"><a href="#cb114-26" aria-hidden="true" tabindex="-1"></a>        metrics[<span class="st">'Model'</span>] <span class="op">=</span> model  <span class="co"># Add model name to metrics</span></span>
<span id="cb114-27"><a href="#cb114-27" aria-hidden="true" tabindex="-1"></a>        results.append(metrics)</span>
<span id="cb114-28"><a href="#cb114-28" aria-hidden="true" tabindex="-1"></a>    column_order <span class="op">=</span> [<span class="st">'Model'</span>, <span class="st">'Accuracy'</span>, <span class="st">'Precision'</span>, <span class="st">'Recall'</span>]</span>
<span id="cb114-29"><a href="#cb114-29" aria-hidden="true" tabindex="-1"></a>    results_df <span class="op">=</span> pd.DataFrame(results, columns<span class="op">=</span>column_order)</span>
<span id="cb114-30"><a href="#cb114-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="8b9f3e20" class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find break even</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>cost <span class="op">=</span> <span class="fl">1.41</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>margin <span class="op">=</span> <span class="dv">60</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>break_even <span class="op">=</span> cost <span class="op">/</span> margin</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>break_even</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<pre><code>0.0235</code></pre>
</div>
</div>
<div id="4a85dfc3" class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>test_data <span class="op">=</span> intuit75k[intuit75k.training <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>true_response <span class="op">=</span> test_data[<span class="st">'res1_yes'</span>]</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the function accross all models and predictions</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [<span class="st">"logit"</span>, <span class="st">"nn0"</span>, <span class="st">"nn1"</span>, <span class="st">"nn2"</span>, <span class="st">"nn3a"</span>, <span class="st">"nn10"</span>]</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> [</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pred_logit"</span>,</span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pred_nn0"</span>,</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pred_nn1"</span>,</span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pred_nn2"</span>,</span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pred_nn3a"</span>,</span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pred_nn10"</span>,</span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pred_logit_int"</span>,</span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="2c442763" class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>pred_metrics <span class="op">=</span> prediction_metrics(test_data, models,predictions, break_even)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>pred_metrics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/28/cfl1_cfs3bb536qkz8wkys_w0000gn/T/ipykernel_5280/1757352677.py:22: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="88">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Model</th>
<th data-quarto-table-cell-role="th">Accuracy</th>
<th data-quarto-table-cell-role="th">Precision</th>
<th data-quarto-table-cell-role="th">Recall</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>logit</td>
<td>0.429689</td>
<td>0.070272</td>
<td>0.869447</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>nn0</td>
<td>0.460311</td>
<td>0.072358</td>
<td>0.846782</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>nn1</td>
<td>0.460311</td>
<td>0.072358</td>
<td>0.846782</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>nn2</td>
<td>0.475822</td>
<td>0.074030</td>
<td>0.842248</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>nn3a</td>
<td>0.465156</td>
<td>0.073707</td>
<td>0.856754</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>nn10</td>
<td>0.574844</td>
<td>0.078410</td>
<td>0.713509</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
</section>
<section id="calculate-the-profit-of-each-model" class="level2">
<h2 class="anchored" data-anchor-id="calculate-the-profit-of-each-model">Calculate the profit of each model</h2>
<p>Note that in wave 2, every response probability is only 50%</p>
<div id="4aeee610" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> prediction <span class="kw">in</span> predictions:</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>    test_data[<span class="ss">f'mailto_wave2_</span><span class="sc">{</span>prediction<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> test_data[prediction] <span class="op">&gt;</span> break_even</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_performance(dat, models, predictions, perf <span class="op">=</span> <span class="st">"res1_yes"</span>, break_even <span class="op">=</span> break_even, lev<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> model, prediction <span class="kw">in</span> <span class="bu">zip</span>(models, predictions):</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use the boolean column indicating if prediction is above break_even</span></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>        boolean_column <span class="op">=</span> <span class="ss">f'mailto_wave2_</span><span class="sc">{</span>prediction<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>        mail_to_rate <span class="op">=</span> <span class="bu">len</span>(dat[dat[boolean_column]]) <span class="op">/</span> <span class="bu">len</span>(dat)</span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>        response_rate <span class="op">=</span> (<span class="bu">len</span>(dat[(dat[boolean_column]) <span class="op">&amp;</span> (dat[perf] <span class="op">==</span> lev)]) <span class="op">/</span> <span class="bu">len</span>(dat[dat[boolean_column]]))<span class="op">/</span><span class="dv">2</span> <span class="cf">if</span> <span class="bu">len</span>(dat[dat[boolean_column]]) <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>        nr_mail <span class="op">=</span> <span class="dv">763334</span> <span class="op">*</span> mail_to_rate</span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>        mail_cost <span class="op">=</span> <span class="fl">1.4</span> <span class="op">*</span> nr_mail</span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>        revenue <span class="op">=</span> <span class="dv">60</span> <span class="op">*</span> nr_mail <span class="op">*</span> response_rate</span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a>        expected_profit <span class="op">=</span> revenue <span class="op">-</span> mail_cost</span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a>        expected_ROME <span class="op">=</span> expected_profit <span class="op">/</span> mail_cost <span class="cf">if</span> mail_cost <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a>        results.append({</span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"model"</span>: model,</span>
<span id="cb120-19"><a href="#cb120-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"profit"</span>: expected_profit,</span>
<span id="cb120-20"><a href="#cb120-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ROME"</span>: expected_ROME,</span>
<span id="cb120-21"><a href="#cb120-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">"mail_to_rate"</span>: mail_to_rate,</span>
<span id="cb120-22"><a href="#cb120-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">"response_rate"</span>: response_rate</span>
<span id="cb120-23"><a href="#cb120-23" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb120-24"><a href="#cb120-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-25"><a href="#cb120-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(results)</span>
<span id="cb120-26"><a href="#cb120-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-27"><a href="#cb120-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-28"><a href="#cb120-28" aria-hidden="true" tabindex="-1"></a>performance_data <span class="op">=</span> calculate_performance(test_data, models, predictions, perf <span class="op">=</span> <span class="st">"res1_yes"</span>, break_even <span class="op">=</span> break_even, lev<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb120-29"><a href="#cb120-29" aria-hidden="true" tabindex="-1"></a>performance_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/28/cfl1_cfs3bb536qkz8wkys_w0000gn/T/ipykernel_5280/1120089769.py:2: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

/var/folders/28/cfl1_cfs3bb536qkz8wkys_w0000gn/T/ipykernel_5280/1120089769.py:2: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

/var/folders/28/cfl1_cfs3bb536qkz8wkys_w0000gn/T/ipykernel_5280/1120089769.py:2: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

/var/folders/28/cfl1_cfs3bb536qkz8wkys_w0000gn/T/ipykernel_5280/1120089769.py:2: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

/var/folders/28/cfl1_cfs3bb536qkz8wkys_w0000gn/T/ipykernel_5280/1120089769.py:2: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

/var/folders/28/cfl1_cfs3bb536qkz8wkys_w0000gn/T/ipykernel_5280/1120089769.py:2: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

/var/folders/28/cfl1_cfs3bb536qkz8wkys_w0000gn/T/ipykernel_5280/1120089769.py:2: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="89">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">model</th>
<th data-quarto-table-cell-role="th">profit</th>
<th data-quarto-table-cell-role="th">ROME</th>
<th data-quarto-table-cell-role="th">mail_to_rate</th>
<th data-quarto-table-cell-role="th">response_rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>logit</td>
<td>327867.219680</td>
<td>0.505825</td>
<td>0.606533</td>
<td>0.035136</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>nn0</td>
<td>337522.546631</td>
<td>0.550533</td>
<td>0.573689</td>
<td>0.036179</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>nn1</td>
<td>337522.546631</td>
<td>0.550533</td>
<td>0.573689</td>
<td>0.036179</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>nn2</td>
<td>349484.838560</td>
<td>0.586353</td>
<td>0.557733</td>
<td>0.037015</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>nn3a</td>
<td>352850.293351</td>
<td>0.579440</td>
<td>0.569822</td>
<td>0.036854</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>nn10</td>
<td>324271.068391</td>
<td>0.680212</td>
<td>0.446089</td>
<td>0.039205</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="calculate-the-profit-which-is-scale-to-801821---38487-763334-businesses" class="level2">
<h2 class="anchored" data-anchor-id="calculate-the-profit-which-is-scale-to-801821---38487-763334-businesses">Calculate the profit, which is scale to 801821 - 38487 = 763334 businesses</h2>
<div id="ce77c3df" class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.family'</span>] <span class="op">=</span> <span class="st">'serif'</span>  <span class="co"># e.g., 'Times New Roman', 'Arial', 'Serif'</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.size'</span>] <span class="op">=</span> <span class="dv">12</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.barplot(x<span class="op">=</span><span class="st">"model"</span>, y<span class="op">=</span><span class="st">"profit"</span>, data<span class="op">=</span>performance_data, palette<span class="op">=</span><span class="st">"inferno"</span>)</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">"Model Type"</span>, ylabel<span class="op">=</span><span class="st">"Profit ($)"</span>)</span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Model Performance by Profit'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> ax.patches:</span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a>    ax.text(p.get_x() <span class="op">+</span> p.get_width() <span class="op">/</span> <span class="fl">2.</span>, (p.get_height() <span class="op">-</span> <span class="dv">1</span>), <span class="ss">f"$</span><span class="sc">{</span><span class="bu">int</span>(p.get_height())<span class="sc">:,}</span><span class="ss">"</span>, </span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a>            ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/28/cfl1_cfs3bb536qkz8wkys_w0000gn/T/ipykernel_5280/3822392447.py:8: FutureWarning:



Passing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `x` variable to `hue` and set `legend=False` for the same effect.

</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-91-output-2.png" width="1003" height="681" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="c9c62289" class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.family'</span>] <span class="op">=</span> <span class="st">'serif'</span>  <span class="co"># e.g., 'Times New Roman', 'Arial', 'Serif'</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.size'</span>] <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>plt.clf()</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.barplot(x<span class="op">=</span><span class="st">"model"</span>, y<span class="op">=</span><span class="st">"ROME"</span>, data<span class="op">=</span>performance_data, palette<span class="op">=</span><span class="st">"inferno"</span>)</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">"Model Type"</span>, ylabel<span class="op">=</span><span class="st">"ROME (%)"</span>)</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Model Performance by ROME'</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> ax.patches:</span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>    ax.text(p.get_x() <span class="op">+</span> p.get_width() <span class="op">/</span> <span class="fl">2.</span>, (p.get_height()), <span class="ss">f"</span><span class="sc">{</span>(p.get_height())<span class="sc">:.2f}</span><span class="ss">%"</span>, </span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>            ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/28/cfl1_cfs3bb536qkz8wkys_w0000gn/T/ipykernel_5280/2081715165.py:5: FutureWarning:



Passing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `x` variable to `hue` and set `legend=False` for the same effect.

</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-92-output-2.png" width="961" height="677" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Based on the results above, the profit of NN3 is highest, this means that the NN3 model is the best model to use in this case.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>