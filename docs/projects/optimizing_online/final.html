<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Website - Optimizing Online Sport Retail Revenue</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Website</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../visualization.html"> 
<span class="menu-text">Visualization</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#project-tasks" id="toc-project-tasks" class="nav-link active" data-scroll-target="#project-tasks">Project Tasks</a></li>
  <li><a href="#counting-missing-values" id="toc-counting-missing-values" class="nav-link" data-scroll-target="#counting-missing-values">1. Counting missing values</a></li>
  <li><a href="#nike-vs-adidas-pricing" id="toc-nike-vs-adidas-pricing" class="nav-link" data-scroll-target="#nike-vs-adidas-pricing">2. Nike vs Adidas pricing</a></li>
  <li><a href="#labeling-price-ranges" id="toc-labeling-price-ranges" class="nav-link" data-scroll-target="#labeling-price-ranges">3. Labeling price ranges</a></li>
  <li><a href="#average-discount-by-brand" id="toc-average-discount-by-brand" class="nav-link" data-scroll-target="#average-discount-by-brand">4. Average discount by brand</a></li>
  <li><a href="#correlation-between-revenue-and-reviews" id="toc-correlation-between-revenue-and-reviews" class="nav-link" data-scroll-target="#correlation-between-revenue-and-reviews">5. Correlation between revenue and reviews</a></li>
  <li><a href="#ratings-and-reviews-by-product-description-length" id="toc-ratings-and-reviews-by-product-description-length" class="nav-link" data-scroll-target="#ratings-and-reviews-by-product-description-length">6. Ratings and reviews by product description length</a></li>
  <li><a href="#reviews-by-month-and-brand" id="toc-reviews-by-month-and-brand" class="nav-link" data-scroll-target="#reviews-by-month-and-brand">7. Reviews by month and brand</a></li>
  <li><a href="#footwear-product-performance" id="toc-footwear-product-performance" class="nav-link" data-scroll-target="#footwear-product-performance">8. Footwear product performance</a></li>
  <li><a href="#clothing-product-performance" id="toc-clothing-product-performance" class="nav-link" data-scroll-target="#clothing-product-performance">9. Clothing product performance</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Optimizing Online Sport Retail Revenue</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Sports clothing is a booming sector!</p>
<p>In this notebook, I will use my SQL skills to analyze product data for an online sports retail company.</p>
<p>I will work with numeric, string, and timestamp data on pricing and revenue, ratings, reviews, descriptions, and website traffic then use techniques such as aggregation, cleaning, labeling, Common Table Expressions, and correlation to produce recommendations on how the company can maximize revenue!</p>
<section id="project-tasks" class="level3">
<h3 class="anchored" data-anchor-id="project-tasks">Project Tasks</h3>
<ol type="1">
<li>Counting missing values</li>
<li>Nike vs Adidas pricing</li>
<li>Labeling price ranges</li>
<li>Average discount by brand</li>
<li>Correlation between revenue and reviews</li>
<li>Ratings and reviews by product description length</li>
<li>Reviews by month and brand</li>
<li>Footwear product performance</li>
<li>Clothing product performance</li>
</ol>
</section>
<section id="counting-missing-values" class="level2">
<h2 class="anchored" data-anchor-id="counting-missing-values">1. Counting missing values</h2>
<p>
Sports clothing and athleisure attire is a huge industry, worth approximately <a href="https://www.statista.com/statistics/254489/total-revenue-of-the-global-sports-apparel-market/">$193 billion in 2021</a> with a strong growth forecast over the next decade!
</p>
<p>
In this notebook, we play the role of a product analyst for an online sports clothing company. The company is specifically interested in how it can improve revenue. We will dive into product data such as pricing, reviews, descriptions, and ratings, as well as revenue and website traffic, to produce recommendations for its marketing and sales teams.
</p>
<p>
The database provided to us, <code>sports</code>, contains five tables, with <code>product_id</code> being the primary key for all of them:
</p>
<h3 id="info" class="anchored">
<code>info</code>
</h3>
<table>
<thead>
<tr>
<th>
column
</th>
<th>
data type
</th>
<th>
description
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>product_name</code>
</td>
<td>
<code>varchar</code>
</td>
<td>
Name of the product
</td>
</tr>
<tr>
<td>
<code>product_id</code>
</td>
<td>
<code>varchar</code>
</td>
<td>
Unique ID for product
</td>
</tr>
<tr>
<td>
<code>description</code>
</td>
<td>
<code>varchar</code>
</td>
<td>
Description of the product
</td>
</tr>
</tbody>
</table>
<h3 id="finance" class="anchored">
<code>finance</code>
</h3>
<table>
<thead>
<tr>
<th>
column
</th>
<th>
data type
</th>
<th>
description
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>product_id</code>
</td>
<td>
<code>varchar</code>
</td>
<td>
Unique ID for product
</td>
</tr>
<tr>
<td>
<code>listing_price</code>
</td>
<td>
<code>float</code>
</td>
<td>
Listing price for product
</td>
</tr>
<tr>
<td>
<code>sale_price</code>
</td>
<td>
<code>float</code>
</td>
<td>
Price of the product when on sale
</td>
</tr>
<tr>
<td>
<code>discount</code>
</td>
<td>
<code>float</code>
</td>
<td>
Discount, as a decimal, applied to the sale price
</td>
</tr>
<tr>
<td>
<code>revenue</code>
</td>
<td>
<code>float</code>
</td>
<td>
Amount of revenue generated by each product, in US dollars
</td>
</tr>
</tbody>
</table>
<h3 id="reviews" class="anchored">
<code>reviews</code>
</h3>
<table>
<thead>
<tr>
<th>
column
</th>
<th>
data type
</th>
<th>
description
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>product_name</code>
</td>
<td>
<code>varchar</code>
</td>
<td>
Name of the product
</td>
</tr>
<tr>
<td>
<code>product_id</code>
</td>
<td>
<code>varchar</code>
</td>
<td>
Unique ID for product
</td>
</tr>
<tr>
<td>
<code>rating</code>
</td>
<td>
<code>float</code>
</td>
<td>
Product rating, scored from <code>1.0</code> to <code>5.0</code>
</td>
</tr>
<tr>
<td>
<code>reviews</code>
</td>
<td>
<code>float</code>
</td>
<td>
Number of reviews for the product
</td>
</tr>
</tbody>
</table>
<h3 id="traffic" class="anchored">
<code>traffic</code>
</h3>
<table>
<thead>
<tr>
<th>
column
</th>
<th>
data type
</th>
<th>
description
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>product_id</code>
</td>
<td>
<code>varchar</code>
</td>
<td>
Unique ID for product
</td>
</tr>
<tr>
<td>
<code>last_visited</code>
</td>
<td>
<code>timestamp</code>
</td>
<td>
Date and time the product was last viewed on the website
</td>
</tr>
</tbody>
</table>
<h3 id="brands" class="anchored">
<code>brands</code>
</h3>
<table>
<thead>
<tr>
<th>
column
</th>
<th>
data type
</th>
<th>
description
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<code>product_id</code>
</td>
<td>
<code>varchar</code>
</td>
<td>
Unique ID for product
</td>
</tr>
<tr>
<td>
<code>brand</code>
</td>
<td>
<code>varchar</code>
</td>
<td>
Brand of the product
</td>
</tr>
</tbody>
</table>
<p>
We will be dealing with missing data as well as numeric, string, and timestamp data types to draw insights about the products in the online store. Let’s start by finding out how complete the data is.
</p>
<div id="25386437" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the names of your CSV files and corresponding table names</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>names <span class="op">=</span> [<span class="st">'finance'</span>, <span class="st">'info'</span>, <span class="st">'reviews'</span>, <span class="st">'traffic'</span>, <span class="st">'brands'</span>]</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create or open a single SQLite database</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">'consolidated.db'</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Load each CSV data into a DataFrame and write it to a SQL table in the single database</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name <span class="kw">in</span> names:</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(<span class="ss">f'</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    df.to_sql(name, conn, if_exists<span class="op">=</span><span class="st">'replace'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Close the database connection</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>conn.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="c21ab534" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext sql</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql sqlite:<span class="op">///</span>consolidated.db</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The sql extension is already loaded. To reload it, use:
  %reload_ext sql</code></pre>
</div>
</div>
<div id="9a9792c5" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>SELECT </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    COUNT(<span class="op">*</span>) AS total_rows,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    SUM(CASE WHEN i.description IS NULL THEN <span class="dv">0</span> ELSE <span class="dv">1</span> END) AS count_description,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    SUM(CASE WHEN f.listing_price IS NULL THEN <span class="dv">0</span> ELSE <span class="dv">1</span> END) AS count_listing_price,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    SUM(CASE WHEN t.last_visited IS NULL THEN <span class="dv">0</span> ELSE <span class="dv">1</span> END) AS count_last_visited</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>FROM info i</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>JOIN finance f ON i.product_id <span class="op">=</span> f.product_id</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>JOIN traffic t ON f.product_id <span class="op">=</span> t.product_id<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///consolidated.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">total_rows</th>
<th data-quarto-table-cell-role="th">count_description</th>
<th data-quarto-table-cell-role="th">count_listing_price</th>
<th data-quarto-table-cell-role="th">count_last_visited</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3179</td>
<td>3117</td>
<td>3120</td>
<td>2928</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="nike-vs-adidas-pricing" class="level2">
<h2 class="anchored" data-anchor-id="nike-vs-adidas-pricing">2. Nike vs Adidas pricing</h2>
<p>
We can see the database contains 3,179 products in total. Of the columns we previewed, only one — <code>last_visited</code> — is missing more than five percent of its values. Now let’s turn our attention to pricing.
</p>
<p>
How do the price points of Nike and Adidas products differ? Answering this question can help us build a picture of the company’s stock range and customer market. We will run a query to produce a distribution of the <code>listing_price</code> and the count for each price, grouped by <code>brand</code>.
</p>
<div id="f6c4070c" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>SELECT </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    b.brand,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    CAST(f.listing_price AS INTEGER),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    COUNT(<span class="op">*</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>FROM finance AS f</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>JOIN brands AS b</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>ON b.product_id <span class="op">=</span> f.product_id</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>WHERE f.listing_price <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>AND (b.brand <span class="op">=</span> <span class="st">'Adidas'</span> OR b.brand <span class="op">=</span> <span class="st">'Nike'</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>GROUP BY b.brand, f.listing_price</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>ORDER BY f.listing_price DESC<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///consolidated.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">brand</th>
<th data-quarto-table-cell-role="th">CAST(f.listing_price AS INTEGER)</th>
<th data-quarto-table-cell-role="th">COUNT(*)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Adidas</td>
<td>299</td>
<td>2</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>279</td>
<td>4</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>239</td>
<td>5</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>229</td>
<td>8</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>219</td>
<td>11</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>199</td>
<td>8</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>199</td>
<td>1</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>189</td>
<td>7</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>189</td>
<td>2</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>179</td>
<td>34</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>179</td>
<td>4</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>169</td>
<td>27</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>169</td>
<td>14</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>159</td>
<td>28</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>159</td>
<td>31</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>149</td>
<td>41</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>149</td>
<td>6</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>139</td>
<td>36</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>139</td>
<td>12</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>129</td>
<td>96</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>129</td>
<td>12</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>119</td>
<td>115</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>119</td>
<td>16</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>109</td>
<td>91</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>109</td>
<td>17</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>99</td>
<td>72</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>99</td>
<td>14</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>95</td>
<td>2</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>94</td>
<td>1</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>89</td>
<td>89</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>89</td>
<td>13</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>85</td>
<td>7</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>84</td>
<td>1</td>
</tr>
<tr class="even">
<td>Nike</td>
<td>84</td>
<td>5</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>79</td>
<td>322</td>
</tr>
<tr class="even">
<td>Nike</td>
<td>79</td>
<td>16</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>78</td>
<td>1</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>75</td>
<td>149</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>74</td>
<td>1</td>
</tr>
<tr class="even">
<td>Nike</td>
<td>74</td>
<td>7</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>69</td>
<td>87</td>
</tr>
<tr class="even">
<td>Nike</td>
<td>69</td>
<td>4</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>65</td>
<td>102</td>
</tr>
<tr class="even">
<td>Nike</td>
<td>64</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>62</td>
<td>1</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>59</td>
<td>211</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>59</td>
<td>2</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>55</td>
<td>174</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>54</td>
<td>2</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>52</td>
<td>43</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>49</td>
<td>183</td>
</tr>
<tr class="even">
<td>Nike</td>
<td>49</td>
<td>5</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>47</td>
<td>42</td>
</tr>
<tr class="even">
<td>Nike</td>
<td>47</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>45</td>
<td>163</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>44</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>44</td>
<td>3</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>42</td>
<td>51</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>39</td>
<td>81</td>
</tr>
<tr class="even">
<td>Nike</td>
<td>39</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>37</td>
<td>24</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>35</td>
<td>25</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>32</td>
<td>24</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>29</td>
<td>37</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>29</td>
<td>2</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>27</td>
<td>38</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>26</td>
<td>18</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>24</td>
<td>28</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>22</td>
<td>1</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>19</td>
<td>8</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>17</td>
<td>4</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>15</td>
<td>4</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>14</td>
<td>27</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>12</td>
<td>27</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>11</td>
<td>1</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>9</td>
<td>11</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>8</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="labeling-price-ranges" class="level2">
<h2 class="anchored" data-anchor-id="labeling-price-ranges">3. Labeling price ranges</h2>
<p>
It turns out there are 77 unique prices for the products in our database, which makes the output of our last query quite difficult to analyze.
</p>
<p>
Let’s build on our previous query by assigning labels to different price ranges, grouping by <code>brand</code> and <code>label</code>. We will also include the total <code>revenue</code> for each price range and <code>brand</code>.
</p>
<div id="b7444057" class="cell" data-dc="{&quot;key&quot;:&quot;27&quot;}" data-tags="[&quot;sample_code&quot;]" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>SELECT </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    b.brand,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    COUNT(<span class="op">*</span>),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    SUM(f.revenue) AS total_revenue,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    CASE </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        WHEN f.listing_price <span class="op">&lt;</span> <span class="dv">42</span> THEN <span class="st">'Budget'</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        WHEN f.listing_price <span class="op">&gt;=</span> <span class="dv">42</span> AND f.listing_price <span class="op">&lt;</span> <span class="dv">74</span> THEN <span class="st">'Average'</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        WHEN f.listing_price <span class="op">&gt;=</span> <span class="dv">74</span> AND f.listing_price <span class="op">&lt;</span> <span class="dv">129</span> THEN <span class="st">'Expensive'</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        ELSE <span class="st">'Elite'</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    END AS price_category</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>FROM finance AS f</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>JOIN brands AS b </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>ON b.product_id <span class="op">=</span> f.product_id</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>WHERE b.brand IS NOT NULL</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>GROUP BY b.brand, price_category</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>ORDER BY total_revenue DESC<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///consolidated.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">brand</th>
<th data-quarto-table-cell-role="th">COUNT(*)</th>
<th data-quarto-table-cell-role="th">total_revenue</th>
<th data-quarto-table-cell-role="th">price_category</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Adidas</td>
<td>849</td>
<td>4626980.07</td>
<td>Expensive</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>1060</td>
<td>3233661.06</td>
<td>Average</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>307</td>
<td>3014316.83</td>
<td>Elite</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>359</td>
<td>651661.12</td>
<td>Budget</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>357</td>
<td>595341.02</td>
<td>Budget</td>
</tr>
<tr class="even">
<td>Nike</td>
<td>82</td>
<td>128475.59</td>
<td>Elite</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>90</td>
<td>71843.15</td>
<td>Expensive</td>
</tr>
<tr class="even">
<td>Nike</td>
<td>16</td>
<td>6623.5</td>
<td>Average</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="average-discount-by-brand" class="level2">
<h2 class="anchored" data-anchor-id="average-discount-by-brand">4. Average discount by brand</h2>
<p>
Interestingly, grouping products by brand and price range allows us to see that Adidas items generate more total revenue regardless of price category! Specifically, <code>“Elite”</code> Adidas products priced $129 or more typically generate the highest revenue, so the company can potentially increase revenue by shifting their stock to have a larger proportion of these products!
</p>
<p>
Note we have been looking at <code>listing_price</code> so far. The <code>listing_price</code> may not be the price that the product is ultimately sold for. To understand <code>revenue</code> better, let’s take a look at the <code>discount</code>, which is the percent reduction in the <code>listing_price</code> when the product is actually sold. We would like to know whether there is a difference in the amount of <code>discount</code> offered between brands, as this could be influencing <code>revenue</code>.
</p>
<div id="7f0008b8" class="cell" data-dc="{&quot;key&quot;:&quot;38&quot;}" data-tags="[&quot;sample_code&quot;]" data-execution_count="6">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>SELECT </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    b.brand,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    AVG(f.discount) <span class="op">*</span> <span class="dv">100</span> AS average_discount</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>FROM finance AS f</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>INNER JOIN brands AS b </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>ON b.product_id <span class="op">=</span> f.product_id</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>GROUP BY brand</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>HAVING brand IS NOT NULL<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///consolidated.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">brand</th>
<th data-quarto-table-cell-role="th">average_discount</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Adidas</td>
<td>33.45242718446602</td>
</tr>
<tr class="even">
<td>Nike</td>
<td>0.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="correlation-between-revenue-and-reviews" class="level2">
<h2 class="anchored" data-anchor-id="correlation-between-revenue-and-reviews">5. Correlation between revenue and reviews</h2>
<p>
Strangely, no <code>discount</code> is offered on Nike products! In comparison, not only do Adidas products generate the most revenue, but these products are also heavily discounted!
</p>
<p>
To improve revenue further, the company could try to reduce the amount of discount offered on Adidas products, and monitor sales volume to see if it remains stable. Alternatively, it could try offering a small discount on Nike products. This would reduce average revenue for these products, but may increase revenue overall if there is an increase in the volume of Nike products sold.
</p>
<p>
Now explore whether relationships exist between the columns in our database. We will check the strength and direction of a correlation between <code>revenue</code> and <code>reviews</code>.
</p>
<div id="962273cb" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect to the SQLite database</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">'consolidated.db'</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch data</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT r.reviews, f.revenue</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="st">FROM finance AS f</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="st">JOIN reviews AS r ON r.product_id = f.product_id</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_sql(query, conn)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate correlation using pandas</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>correlation <span class="op">=</span> df[<span class="st">'reviews'</span>].corr(df[<span class="st">'revenue'</span>])</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Correlation between reviews and revenue:"</span>, correlation)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Close the database connection</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>conn.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Correlation between reviews and revenue: 0.6518512283481297</code></pre>
</div>
</div>
</section>
<section id="ratings-and-reviews-by-product-description-length" class="level2">
<h2 class="anchored" data-anchor-id="ratings-and-reviews-by-product-description-length">6. Ratings and reviews by product description length</h2>
<p>
Interestingly, there is a strong positive correlation between <code>revenue</code> and <code>reviews</code>. This means, potentially, if we can get more reviews on the company’s website, it may increase sales of those items with a larger number of reviews.
</p>
<p>
Perhaps the length of a product’s <code>description</code> might influence a product’s <code>rating</code> and <code>reviews</code> — if so, the company can produce content guidelines for listing products on their website and test if this influences <code>revenue</code>. Let’s check this out!
</p>
<div id="d68738b2" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>SELECT</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    (LENGTH(i.description) <span class="op">/</span> <span class="dv">100</span>) <span class="op">*</span> <span class="dv">100</span> AS description_length,  <span class="op">--</span> Truncate to nearest <span class="dv">100</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    ROUND(AVG(r.rating), <span class="dv">2</span>) AS average_rating  <span class="op">--</span> Calculate average <span class="kw">and</span> <span class="bu">round</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>FROM reviews r</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>JOIN info i ON r.product_id <span class="op">=</span> i.product_id</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>WHERE i.description IS NOT NULL</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>GROUP BY description_length</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>ORDER BY description_length<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///consolidated.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">description_length</th>
<th data-quarto-table-cell-role="th">average_rating</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1.87</td>
</tr>
<tr class="even">
<td>100</td>
<td>3.21</td>
</tr>
<tr class="odd">
<td>200</td>
<td>3.27</td>
</tr>
<tr class="even">
<td>300</td>
<td>3.29</td>
</tr>
<tr class="odd">
<td>400</td>
<td>3.32</td>
</tr>
<tr class="even">
<td>500</td>
<td>3.12</td>
</tr>
<tr class="odd">
<td>600</td>
<td>3.65</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="reviews-by-month-and-brand" class="level2">
<h2 class="anchored" data-anchor-id="reviews-by-month-and-brand">7. Reviews by month and brand</h2>
<p>
Unfortunately, there doesn’t appear to be a clear pattern between the length of a product’s <code>description</code> and its <code>rating</code>.
</p>
<p>
As we know a correlation exists between <code>reviews</code> and <code>revenue</code>, one approach the company could take is to run experiments with different sales processes encouraging more reviews from customers about their purchases, such as by offering a small discount on future purchases.
</p>
<p>
Let’s take a look at the volume of <code>reviews</code> by month to see if there are any trends or gaps we can look to exploit.
</p>
<div id="7618e292" class="cell" data-dc="{&quot;key&quot;:&quot;68&quot;}" data-tags="[&quot;sample_code&quot;]" data-execution_count="9">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>SELECT </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    b.brand,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    strftime(<span class="st">'%m'</span>, t.last_visited) AS month,  <span class="op">--</span> Extracts the month <span class="im">as</span> <span class="st">'MM'</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    COUNT(r.product_id) AS num_reviews</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>FROM reviews AS r</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>JOIN traffic AS t ON r.product_id <span class="op">=</span> t.product_id</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>JOIN brands AS b ON r.product_id <span class="op">=</span> b.product_id</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>WHERE b.brand IS NOT NULL AND t.last_visited IS NOT NULL</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>GROUP BY b.brand, strftime(<span class="st">'%m'</span>, t.last_visited)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>ORDER BY b.brand, month<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///consolidated.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">brand</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">num_reviews</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Adidas</td>
<td>01</td>
<td>253</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>02</td>
<td>272</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>03</td>
<td>269</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>04</td>
<td>180</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>05</td>
<td>172</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>06</td>
<td>159</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>07</td>
<td>170</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>08</td>
<td>189</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>09</td>
<td>181</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>10</td>
<td>192</td>
</tr>
<tr class="odd">
<td>Adidas</td>
<td>11</td>
<td>150</td>
</tr>
<tr class="even">
<td>Adidas</td>
<td>12</td>
<td>190</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>01</td>
<td>52</td>
</tr>
<tr class="even">
<td>Nike</td>
<td>02</td>
<td>52</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>03</td>
<td>55</td>
</tr>
<tr class="even">
<td>Nike</td>
<td>04</td>
<td>42</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>05</td>
<td>41</td>
</tr>
<tr class="even">
<td>Nike</td>
<td>06</td>
<td>43</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>07</td>
<td>37</td>
</tr>
<tr class="even">
<td>Nike</td>
<td>08</td>
<td>29</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>09</td>
<td>28</td>
</tr>
<tr class="even">
<td>Nike</td>
<td>10</td>
<td>47</td>
</tr>
<tr class="odd">
<td>Nike</td>
<td>11</td>
<td>38</td>
</tr>
<tr class="even">
<td>Nike</td>
<td>12</td>
<td>35</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="footwear-product-performance" class="level2">
<h2 class="anchored" data-anchor-id="footwear-product-performance">8. Footwear product performance</h2>
<p>
Looks like product reviews are highest in the first quarter of the calendar year, so there is scope to run experiments aiming to increase the volume of reviews in the other nine months!
</p>
<p>
So far, we have been primarily analyzing Adidas vs Nike products. Now, let’s switch our attention to the type of products being sold. As there are no labels for product type, we will create a Common Table Expression (CTE) that filters <code>description</code> for keywords, then use the results to find out how much of the company’s stock consists of footwear products and the median <code>revenue</code> generated by these items.
</p>
<div id="69ac48fb" class="cell" data-dc="{&quot;key&quot;:&quot;76&quot;}" data-tags="[&quot;sample_code&quot;]" data-execution_count="10">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>WITH footwear AS (</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    SELECT </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        i.description, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        f.revenue</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    FROM info AS i</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    INNER JOIN finance AS f ON i.product_id <span class="op">=</span> f.product_id</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    WHERE (LOWER(i.description) LIKE <span class="st">'</span><span class="sc">%s</span><span class="st">hoe%'</span> OR </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>           LOWER(i.description) LIKE <span class="st">'%trainer%'</span> OR </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>           LOWER(i.description) LIKE <span class="st">'</span><span class="sc">%f</span><span class="st">oot%'</span>) </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>          AND i.description IS NOT NULL</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>SELECT</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    COUNT(<span class="op">*</span>) AS num_footwear_products,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    (SELECT f.revenue</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>     FROM footwear f</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>     ORDER BY f.revenue</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>     LIMIT <span class="dv">1</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>     OFFSET (SELECT (COUNT(<span class="op">*</span>) <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> <span class="dv">2</span> FROM footwear)) AS median_footwear_revenue</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>FROM footwear<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///consolidated.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">num_footwear_products</th>
<th data-quarto-table-cell-role="th">median_footwear_revenue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2700</td>
<td>3118.36</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="clothing-product-performance" class="level2">
<h2 class="anchored" data-anchor-id="clothing-product-performance">9. Clothing product performance</h2>
<p>
Recall from the first task that we found there are 3,117 products without missing values for <code>description</code>. Of those, 2,700 are footwear products, which accounts for around 85% of the company’s stock. They also generate a median revenue of over $3000 dollars!
</p>
<p>
This is interesting, but we have no point of reference for whether footwear’s <code>median_revenue</code> is good or bad compared to other products. So, for our final task, let’s examine how this differs to clothing products. We will re-use <code>footwear</code>, adding a filter afterward to count the number of products and <code>median_revenue</code> of products that are not in <code>footwear</code>.
</p>
<div id="142ccbb2" class="cell" data-dc="{&quot;key&quot;:&quot;86&quot;}" data-tags="[&quot;sample_code&quot;]" data-execution_count="11">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>WITH footwear AS (</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    SELECT </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>        i.product_id</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    FROM info AS i</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    WHERE i.description IS NOT NULL</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>      AND (LOWER(i.description) LIKE <span class="st">'</span><span class="sc">%s</span><span class="st">hoe%'</span> OR </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>           LOWER(i.description) LIKE <span class="st">'%trainer%'</span> OR </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>           LOWER(i.description) LIKE <span class="st">'</span><span class="sc">%f</span><span class="st">oot%'</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>SELECT </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    COUNT(<span class="op">*</span>) AS num_clothing_products,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    (SELECT f.revenue</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>     FROM finance AS f</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>     JOIN info AS i ON i.product_id <span class="op">=</span> f.product_id</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>     WHERE i.product_id NOT IN (SELECT product_id FROM footwear)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>     ORDER BY f.revenue</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>     LIMIT <span class="dv">1</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>     OFFSET (SELECT COUNT(<span class="op">*</span>) <span class="op">/</span> <span class="dv">2</span> FROM finance AS f</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>             JOIN info AS i ON i.product_id <span class="op">=</span> f.product_id</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>             WHERE i.product_id NOT IN (SELECT product_id FROM footwear))) AS median_clothing_revenue</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>FROM info AS i</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>WHERE i.product_id NOT IN (SELECT product_id FROM footwear)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///consolidated.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">num_clothing_products</th>
<th data-quarto-table-cell-role="th">median_clothing_revenue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>479</td>
<td>388.37</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>